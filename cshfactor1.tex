\documentclass[csh.tex]{subfiles}
\begin{document}
\section{Cofibrations}
This section show that the cofibrations from definition \ref{cofibration} are part of an enriched factorization system (see definition \ref{enriched factorization system}) on all of $\ambient\s$ instead of just on the subcategory of complexes.

\begin{lemma} Cofibrations and acyclic fibrations form an enriched factorization system on $\ambient\s$. \label{factorization system 1} \end{lemma}

\begin{proof} Proposition \ref{factor1} shows that every morphism factors as a \emph{contractible morphism} (see definition \ref{contractible}) following a cofibration. Acyclic fibrations are examples of contractible morphisms (see lemma \ref{acyclic means contractible}). Lemma \ref{Reedy} shows that contractible morphisms are acyclic fibrations. Hence contractible morphisms and acyclic fibrations are the same class of morphism and this class form the right class of a factorization system with cofibrations on the left (see definition \ref{enriched factorization system}).
\end{proof}

\begin{definition} Let $\nno\disc\ri$ be the constant family functor $\ambient\s\to\ambient\s/\nno\disc$. 
A morphism $f\of X\to Y$ is \keyword{contractible} if $\nno\ri(f)$ has the $\ambient/\nno$-enriched right lifting property with respect to the \emph{family of cycle inclusions}, which is defined as follows.

The simplicial sets $\simplex_\nno$ and $\cycle_\nno$ satisfy:
\begin{align*}
\base(\simplex_\nno) &= \Ar(\simCat) \\
\base(\cycle_\nno) &= \set{\phi\of\Ar(\simCat)\middle|\exists i\of\nno.i\leq \cod(\phi),\forall j\of \dom(\phi).\phi(j)\neq i} \\
\dim(\phi) &= \dom(\phi) \\
\phi\cdot \xi &=\phi\circ\xi
\end{align*}
By these definitions $\cycle_\nno$ is a subobject of $\simplex_\nno$. The formula $\function{\phi}\tuplet{\dom(\phi),\cod(\phi)}$ defined morphisms of simplices $\cycle_\nno\to \nno\disc$ and $\simplex_\nno\to \nno\disc$ that commute with the inclusion, which is therefore a monomorphism of $\ambient\s/\nno\disc$. This inclusion is the family of cycle inclusions.
\end{definition}

\begin{lemma} Every acyclic fibration is a contractible morphism. \label{acyclic means contractible} \end{lemma}

\begin{proof}
Let $f\of X\to Y$ be an arbitrary acyclic fibration, let $k\of\cycle_\nno\to\simplex_\nno$ be the family of cycle inclusions and 
let $\hom_\nno\of(\ambient\s/\nno\disc\dual\times \ambient\s/\nno\disc)\to \ambient/\nno$ be the enrichment of $\ambient\s/\nno\disc$ over $\ambient\nno$.
The category $\ambient/\nno$ has an object that represents all lifting problems involving cycle inclusions and $f$.
\[ p\of P\to \nno = \set{\tuplet{a,b}\of \hom_\nno(\cycle_\nno,\nno\ri(X))\times \hom_\nno(\simplex_\nno,\nno\ri(Y)) \middle|f\circ a = b\circ k} \]

The simplicial sets $\simplex_P$ and $\cycle_P$ satisfy:
\begin{align*}
\base(\simplex_P) &= \set{ \tuplet{\phi,x}\of\Ar(\simCat)\times P | \cod(\phi) = p(x) } \\
\base(\cycle_P) &= \set{\tuplet{\phi,x}\of\base(\simplex_P)\middle|\exists i\of\nno.i\leq \cod(\phi),\forall j\of \dom(\phi).\phi(j)\neq i} \\
\dim\tuplet{\phi,x} &= \dom(\phi) \\
\tuplet{\phi,x}\cdot \xi &=\phi\circ\xi
\end{align*}

The inclusion $k_P\of\cycle_P\to\simplex_P$ is a cofibration for the following reasons. The simplex $\tuplet{\phi,x}\of\simplex_P$ is a face if $\phi$ is monic, outside of $\cycle_P$ if $\phi$ is epic, so $\phi = \id_[n]$ for some $n\of \nno$. This is a decidable property as required. 

For each $n\of\nno$ the members of the fibre $P[n]$ of $p$ over $n$ are pairs $\tuplet{a,b}$ where $a\of\cycle[n]\to X$ and $b\of \simplex[n]\to Y$ satisfy $f\circ a = b \circ k_n$. Here $\cycle[n]$ and $\simplex[n]$ are fibres over $n$ of the families. Define $a_P\of \cycle_P\to X$ and $b_P\of \cycle_P\to X$ as follows.
\begin{align*}
a_P\tuplet{\phi,\tuplet{a,b}} &= a(\phi)\\
b_P\tuplet{\phi,\tuplet{a,b}} &= b(\phi)
\end{align*}
This way $f\circ a_P = b_P\circ k_P$, and since $f$ is an acyclic fibration, there is a $c_P\of \simplex_P\to X$ such that $f\circ c_P = b_P$ and $c_P\circ k_P = a_P$. This is the key.

Back in $\ambient/\nno$, $c_P$ induces a morphism $p\to\hom_\nno(\simplex_\nno,\nno\ri(X))$, which is a section to the canonical morphism $\function c\tuplet{\nno\ri(f)\circ c,c\circ k}$ and hence a filler for $k$ against $\nno\ri(f)$. Therefore $f$ is contractible.
\end{proof}

\begin{proposition} Every morphism factors as a contractible morphism following a cofibration. \label{factor1} \end{proposition}

\begin{proof}
Let $\simCat^+$ be the subcategory of monomorphisms and $\simCat^-$ that of epimorphisms of $\simCat$ (see definition \ref{category of simplices}). For each morphism $\phi$ of $\simCat$ let $m(\phi)$ be the monic and $e(\phi)$ the epic factors.

The first step is to cover $Y$ with another simplicial set $LY$ where degeneracy is decidable. Define the simplicial set $LY$ as follows.
\begin{align*}
\base(LY) &= \set{\tuplet{\epsilon,y}\of \Ar(\simCat^-)\times Y\middle| \cod(\epsilon)=\dim(y)}\\
\dim(\tuplet{\epsilon,y}) &= \dom(\epsilon)\\
\tuplet{\epsilon,y}\cdot \phi &= \tuplet{e(\epsilon\circ \phi),y\cdot m(\epsilon\circ\phi)}
\end{align*}
A pair $\tuplet{\epsilon,y}$ is a face of $LY$ if and only if $\epsilon=\id$ and equality is a decidable property of morphisms in $\simCat$.
Let $l_Y\of LY\to Y$ satisfy $l_Y\tuplet{\epsilon,y}=y\cdot\epsilon$.

\hide{ $l_Y$ may be an equivalence, but not an acyclic fibration in a constructive way }

The second step glues simplices from $X$ and $LY$ together.
The pair $(f,l_Y)$ stands for the morphism $X+LY\to Y$ that satisfies $(f,l_Y)(x)=f(x)$ for $x\of X$ and $(f,l_Y)(y) = l_Y(y)$ for $y\of LY$.
Let $Z[n]\subseteq \product{i\of[n]}{(X[i]+LY[i])^{\simCat^+([i],[n])}}$ (where $\simCat^+([i],[n])$ is the object of monomorphisms $[i]\to [n]$) consist of elements $z$ which satisfy the following conditions for all $\alpha\of [j]\to [k]$ and $\beta\of [i]\to[j]$ in $\simCat^+$.
\begin{enumerate}
\item $(f,l_Y)(z(\alpha\circ\beta)) = (f,l_Y)(z(\alpha))\cdot\beta$;
\item if $z(\alpha)\of X$ then $z(\alpha\circ\beta)\of X$;
\item if $z(\alpha)=\tuplet{\epsilon,y}\of LY$ and $\epsilon\circ\beta$ is not monic, then $z(\alpha\circ\beta) = \tuplet{\epsilon',y'}\of LY$ and $\epsilon'$ factors through $\epsilon\circ\beta$.
\end{enumerate}
For $\phi\of[m]\to [n]$ and $z\of Z[n]$, let $z\cdot\phi$ satisfy the following equation for all $\alpha$ of $\simCat^+$.
\[ (z\cdot\phi)(\alpha) = z(m(\phi\circ\alpha))\cdot e(\phi\circ \alpha) \]
By these definitions, $Z=(\coproduct{n\of\nno}{Z[n]},\function{\tuplet{n,z}}n,\cdot)$ is a simplicial object.

Let $g\of X\to Z$ satisfy $g(x)(\alpha) = x\cdot\alpha$. It is a cofibration because a $z\of\base Z$ is nondegenerate and outside of the image of $g$ if and only if $z(\id_{[\dim(z)]}) = \tuplet{\id_{[\dim(z)]},y}$ for some $y\of Y[\dim(z)]$. The definition of $LY$ ensures that elements with this property are nondegenerate while condition 3 ensures that if $z(\id)$ is degenerate, then so is all of $z$.

Let $h\of Z\to Y$ satisfy $h(z) = (f,l_Y)(z(\id_{[\dim(z)]}))$. This morphism is contractible thanks to the following filler construction.
Let $k\of\cycle_\nno\to\simplex_\nno$ be the family of cycle inclusions and let $a\of \cycle_\nno\to Z$ and $b\of \simplex_\nno\to Y$ satisfy $h\circ a = b\circ k$. Since $k$ is essentially the the subobject of nonsurjective morphisms of $\simCat$ a filler $c$ can be defined as follows.
Let $c\of \simplex_\nno\to Z$ satisfy $c(\phi)(\mu) = \tuplet{\phi,b(\mu)}$ if $\phi$ is surjective and $c(\phi) = a(\phi)$ for $\phi$ in the image of $k$. By this definition $c\circ k = a$ and $h\circ c = b$.\end{proof}\hide{ Codomains of contractibles may have a distance function, that gives a lower bound to the number of compositions required to to reach it. I don't have time to work that out and check it right now.}

\begin{remark} The construction is the proof of lemma \ref{factor1} are related to Reedy model structures \citep{Reedy74}. In the ambient category $\ambient$ morphisms factor as split epimorphism following decidable monomorphisms thanks to coproducts. Cofibrations are lifted versions of decidable monomorphisms and contractible fibrations are lifted versions of split epimorphisms and they form a factorization system on $\ambient\s$ by a similar construction. Unfortunately, external induction is not strong enough to proof things in the internal language of $\ambient$.
\end{remark}

\begin{lemma} Contractible morphisms are acyclic fibrations.\label{Reedy}\end{lemma}

\begin{proof}
Suppose $c\of I\to J$ is a cofibration and $F$ is the family of faces outside the image of $c$.
The cofibration $c$ is the transfinite composition of the inclusions between the following chain of subobjects of $J$ for $n\of\nno$.
\begin{align*} 
J_n &= \set{c(i)|i\of I}\cup\set{ j\of J \middle| \exists f\of F_{<n}, \xi\of[\dim(f)]\to [\dim(j)].f\cdot \xi = j }\\
\textrm{where } F_{<n} &= \set{f\of F|\dim(f)<n}
\end{align*}
By this definition every $j\of J$ is a member of $J_{\dim(j)+1}$ because %yeah, why exactly? 

The simplicial sets $\simplex_F$ and $\cycle_F$ satisfy:
\begin{align*}
\base(\simplex_F) &= \set{ \tuplet{\phi,x}\of\Ar(\simCat)\times F | \cod(\phi) = \dim(x) } \\
\base(\cycle_F) &= \set{\tuplet{\phi,x}\of\base(\simplex_F)\middle|\exists i\of\nno.i\leq \cod(\phi),\forall j\of \dom(\phi).\phi(j)\neq i} \\
\dim\tuplet{\phi,x} &= \dom(\phi) \\
\tuplet{\phi,x}\cdot \xi &=\phi\circ\xi
\end{align*}
Now $c$ is a pushout of the inclusion $k_F\of\cycle_F\to\simplex_F$, $\function{\tuplet{\phi,x}}x\cdot \phi$ 

\hide{something about transfinite compositions is missing here.}


\end{proof}

\end{document}