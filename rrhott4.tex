\documentclass{amsart}
\usepackage{amssymb, amsmath, amsthm}
\usepackage[all]{xy}
\usepackage{cite}
\usepackage{url}
\usepackage{graphicx}

\title{Univalence in realizability toposes}
\author[W. P. Stekelenburg]{Wouter Pieter Stekelenburg}
\address{Faculty of Mathematics, Informatics and Mechanics\\
University of Warsaw\\
Banacha 2\\
02-097 Warszawa\\
Poland}
\email{w.p.stekelenburg@gmail.com}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem*{theorem*}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{corol}[theorem]{Corollary}


\theoremstyle{definition}
\newtheorem{defin}[theorem]{Definition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{axiom}[theorem]{Axiom}
\newtheorem{example}[theorem]{Example}


\newcommand\hide[1]{}
\newcommand\cat\mathcal
\newcommand\set[1]{\left\{#1\right\}}

\newcommand\id{\mathrm{id}}

\begin{document}
\maketitle

Realizability toposes have complete internal subcategories, which provide models for the univalence axioms of homotopy type theory in a suitably internalized version of the groupoid interpretation. This paper discusses how internal groupoids in a topos give a models for identity types and then show that there is a univalent universe of modests sets.


\section{Internal groupoids}
Hofmann and Streicher's \emph{groupoid interpretation of type theory} works with the internal groupoids of an arbitary elementary topos if we make a few adjustments to the limitations of the internal language. This section is about the category of internal groupoids of a topos, and the structure that makes the interpretation of type theory possible.

\newcommand\ri{^*}
This section is about internal groupoids in an extensive locally Cartesian closed category $\cat E$. Locally Cartesian closed implies that $\cat E$ has finite limits and that for each morphism $f:X\to Y$ the reindexing functor $f\ri:\cat E/Y\to\cat E/X$ has both adjoints.%Beck Chevalley?
Extensive means that the category has finite coproducts which are disjoint and stable under pullback. Disjoint means that the following square with the coporduct inclusions is a pullback:
\[\xymatrix{
0\ar[r]\ar[d] & X\ar[d]^(.4){\iota_0}\\
Y\ar[r]_(.4){\iota_1} & X+Y
}\]

\hide{
Toposes have these properties, but are also 

classifier. Elementary toposes automatically are exact, extensive and locally Cartesian closed. In fact, for each object $I$ of $\cat E$, the slice $\cat E/I$ is a topos. Each $f:I\to J$ induces a reindexing functor $f\ri:\cat E/J \to \cat E/I$ and this functor has both al left adjoint $\coprod_f$ and a right adjoint $\prod_f$, which means it preserves all limits.
\hide{misschien meteen over assemblies praten?}

Toposes are also Heyting categories, which means that set builder expressions like $\set{x\in X| \phi(x)}$ corresponds to subobjects of $X$. We assume that every topos is equipped with a map which chooses a specific monomorphism $Y\to X$ to represent each set builder expression. When we refer to $\set{x\in X| \phi(x)}$ as an object of $\cat E$ we implicitely apply this map.
}
 
\subsection{Raw material}\label{internal}
With the help of set builder notation and the conventions giving above, the definition of internal groupoids is similar to that of small groupoids in the topos of sets. Of course, those are just a special case.

An \emph{internal groupoid} is a tuple $(X_0,X_1,d_0,d_1,t)$ where $X_0, X_1$ are objects of $\cat E$, $d_0,d_1:X_1 \to X_0$, $r:X_0 \to X_1$ and $t:X_2 = \set{(f,g)\in X_1\times X_1| d_0(f) = d_1(g) } \to X_1$ is a morphism. These morphism satisfy the following equations.
\begin{align*}
d_0\circ r &= \id_{X_0}&
d_1\circ r &= \id_{X_0}\\
%d_0\circ t(f,g) &= d_0(g)&
%d_1\circ t(f,g) &= d_1(f)\\
t(r(d_1(g)),g) &=g&
t(f,r(d_0(f))) &=f
\end{align*}
Moreover, we following squares are pullback.
\[ \xymatrix{
X_2 \ar[r]^t\ar[d]_{(f_0,f_1)\mapsto f_i}\ar@{}[dr]|<\lrcorner & X_1 \ar[d]^{d_i}\\
X_1 \ar[r]_{d_i} & X_0
}\]
This means that for every pair of $f,g$ in $X_1$, if $d_0(f) = d_0(g)$ then there is a unique $h\in X_1$ such that $d_0(h) = d_1(f)$ and $t(h,f) = g$. Similarly, if $d_1(f) = d_1(g)$ there is a unique $h$ such that $d_1(h) = d_0(f)$ and $t(f,h) = g$.

The morphisms $d_0$ and $d_1$ correspond to the domain and codomain maps and $t$ to composition. The map $r$ ensure that every object has an identity morphism. The last conditions with the pullbacks ensures that every morphism is an isomorphism.

If $X = (X_0,X_1,d^X_0,d^X_1,t^X)$ and $Y = (Y_0,Y_1,d^Y_0,d^Y_1,t^Y)$ are internal groupoids, then an internal functor $F:X\to Y$ is a pair $(F_0,F_1)$ of morphisms: $F_i:X_i\to Y_i$ They commute with the domain and codomain maps.
\[ d^Y_i\circ F_1 = F_0 \circ d^Y_i \]
Therefore, they induce a map $F_2: X_2 \to Y_2$ which sends a pair $(f,g)$ in $X_2$ to $(F_1f,F_1g)$ in $Y_2$. The maps $F_0$, $F_1$ and $F_2$ also satisfy the following equations.
\[ r^Y\circ F_0 = F_1 \circ r^X \qquad t^Y\circ F_2 = F_1 \circ t^X\]

\newcommand\grpd{\mathsf{Grpd}}\newcommand\inv{^{-1}}
The composition of $F\circ G = (F_0\circ G_0,F_1\circ G_1)$ and the identity functor of $X$ is $(\id_{X_0},\id_{X_1})$. With this structure groupoids and functors form the category $\grpd(\cat E)$ of internal groupoids in $\cat E$.

The morphisms of the groupoids give $\grpd(\cat E)$ and extra dimension and an extra layer of morphisms. If $F=(F_0,F_1)$ and $G=(G_0,G_1)$ are functors $X\to Y$, then an \emph{internal natural transformation} $\eta:F\to G$ is a map $\eta:X_0 \to X_1$ which satisfies tho following equations.
\begin{align*}
d^Y_0\circ \eta &= f_0 \\
d^Y_1\circ \eta &= g_0 \\
t^Y\circ(\eta\circ d^X_0,f_1) &= t^Y\circ(g_1,\eta\circ d^X_1)
\end{align*}
The composition morphism $t^Y$ provides a composition of internal natural tranformations of functors $X\to Y$, and $r^Y\circ f_0 = f_1\circ r^X$ is an identity morphism of the functor $F$. Because every morphism has in inverse intenrally, every natrual transformation $\eta:F\to G$ has an inverse $\eta\inv:G\to F$ which exists externally.

Internal natural transformation between internal functors are natural isomorphisms and we take this for granted throughout this paper.

The natural transformation induce a notion of internal equivalence of groupoids. For each functor $F:X\to Y$ a \emph{homotopy inverse} is a functor $G:Y\to X$ and a pair of natural transformations $\alpha: F\circ G \to \id_Y$ and $\beta: G\circ F \to \id_X$. If a functor $F$ has a homotopy inverse, then it is a \emph{homotopy equivalence}.

Deformation retracts are special examples of homotopy equivalences. If $D:Y\to Y/F$ is a deformation of $F$, then $D_0$ is a natural transformation $\id_{Y}\to F\circ (D_1(F)\circ D)$ and $D_1(F)\circ D\circ F = D_1(F)\circ R(F) = \id_X$ so the identity is a natural transformation there.

\subsection{Cloven fibrations}
The interpretation of equality types requires a way to interpret families of groupoids. For this we use an internalized version of Grothendieck fibrations of categories, strengthened in order to be more stable and to work better with the internal logic of a topos. The construction is part of a stable algebraic weak factorization system (natural\dots see Garner).

For each functor $F:X\to Y$ the groupoid $Y/F$ is defined as follows. The objects $(Y/H)_i$ have the following formulas.
\begin{align*}
(Y/F)_0 &= \set{(x,y)\in Y_1\times X_0| d_1^Y(x)=F_0(x) }\\
(Y/F)_1 &= \set{(w,x,y,z)\in Y_1\times Y_1\times X_1 \times Y_1 \middle| \begin{array}{c} d_0(w) = d_0(w),\\ d_1(w)=d_0(f_1(z)),\\ d_1(x)=d_0(y),\\ d_1(y)=d_1(f_1(z)),\\ t_H(f_1(z),w) = t_H(y,x) \end{array}}\\
\end{align*}
The morphisms $d_i^{Y/F}$, $r^{Y/F}$ and $t^{Y/F}$ are defined as follows.
\begin{align*}
d_0^{Y/F}(w,x,y,z) &= (w,d^X_0(z))\\
d_1^{Y/F}(w,x,y,z) &= (y,d^X_1(z))\\
r^{Y/F}(x,y) &= (x,r^Y(d_0^Y(x)),x,r^Y(y))\\
t^{Y/F}((w,x,y,z),(y,x',y',z')) &= (w,t^Y(x',x),y',t^X(y',y))\\
\end{align*}

There are two obvious projection functors $D_0(F): Y/F \to Y$ and $D_1(X):Y/F\to X$, and identity arrows in the groupoids provide a third functor $R(F):X\to Y/F$ that sends objects to identities. Formally:
\begin{align*}
(D_0(F))_0(x,y) &= d^Y_0(x) \\
(D_0(F))_1(w,x,y,z) &= x \\
(D_1(F))_0(x,y) &= y \\
(D_1(F))_1(w,x,y,z) &= y \\
R(F)_0(x) &= (r^Y(F_0(x)),x) \\
R(F)_1(x) &= (r^Y(F_0(d_0^X(x))),F_1(x),r^Y(F_0(d_1^X(x))), x)
\end{align*}
Now $D_0(F)R(F) = F$ and $D_1(F)R(F) = \id_{X}$.

Any four functors $F:W\to X$, $G:W\to Y$, $H:X\to Z$, $K:Y\to Z$ such that $H\circ F = K\circ G$ induce a functor $H/G:X/F \to Z/K$.
\begin{align*} (H/G)_0(x,y) &= (H_1(x),G_0(y))\\ (H/G)_1(w,x,y,z) &= (H_1(w),H_1(x),G_1(y),H_1(z)) \end{align*}
This construction preserves composition and identities and is therefore a functor. The mappings $F\mapsto R(F)$ and $F\mapsto D_0(F)$ are natrual tansformatios to and from the functor defines by $F \mapsto Y/F$. They form two endofunctor functors of the arrow category $\grpd(\cat E)^\to$. The endofunctor $R$ is part over a comonad and $D_0$ is part of a monad. The functors of the factorisation system are functors which have a coalgebra or algebra structure on them.

\begin{defin} Let $F:X\to Y$ be a functor of groupoids. A \emph{cleavage} of $F$ is a functor $K:Y/F \to X$ such that $K\circ R(F)=\id_X$ and $F\circ K = D_0(F)$. If $F$ has a cleavage, then $F$ is a \emph{cloven fibration}. A \emph{deformation} of $F$ is a functor $D:Y\to Y/F$ %D?
such that $DF = R(F)$ and $D_0(F)D = \id_Y$. If $F$ has a deformation, then $F$ is a \emph{deformation retract}.
\[\xymatrix{
X \ar[r]^\id\ar[d]_{R(F)} & X \ar[d]^F \\
Y/F \ar[r]_{D_0(F)}\ar[ur]^K & Y
}\qquad
\xymatrix{
X \ar[r]^{R(F)}\ar[d]_{F} & Y/F \ar[d]^{D_0(F)} \\
Y \ar[r]_\id\ar[ur]^D & Y
}
\]
\end{defin}

\begin{theorem} Deformation retracts and cloven fibrations form a weak factorisation system. \end{theorem}

\begin{proof} I will show this by first showing that deformation retracts have the left lifting property with respect to cloven fibration, and then showing that for any functor $F:X\to Y$, $R(F)$ is a deformation retract and $D_0(F)$ is a cloven fibration.

Let $F:X\to Y$ have a deformation $D:Y\to Y/F$, let $F':X'\to Y'$ have cleavage $K:Y'/F'\to X'$, let $A:X\to X'$ and $B:Y\to Y'$ satisfy $BF = F'A$.
\[\xymatrix{
X \ar[d]_F \ar[r]^A & X'\ar[d]^{X'} \\
Y\ar[r]_B \ar[ur]^E & Y'
}\]
The functor $B/A: Y/F \to Y'/F'$ satisfies $B/A \circ R(F) = R(F')\circ A$ and $D_0(F')\circ B/A = B\circ D_0(F)$. Let $E = C\circ B/A \circ D$. Now $EF =  A$ and $F'E = B$ as the following diagram shows.
\[\xymatrix{
X \ar[rr]^A \ar[dd]_F \ar[dr]^{R(F)} && X'\ar[d]_{R(F')} \ar[r]^{\id_{X'}} & X' \ar[dd]^{F'}\\
& Y/F \ar[r]^{B/A}\ar[d]^{D_0(F)} & Y'/F' \ar[ur]_K \ar[dr]_{D_0(F')} \\
Y \ar[r]_{\id_Y} \ar[ur]^D & Y \ar[rr]_B && Y'
}\]

For each functor $F$, the deformation $D:Y/F \to (Y/F)/R(F)$ of $R(F)$ is defined as follows.
\begin{align*}
D_0(x,y) &= (x,x,r^X(y),r^Y(F_0(y))) \\
D_1(w,x,y,z) &= \left(\begin{array}{cc}(w,x,y,z),& D_0(w,d_0(y)),\\ (r(d_0(y)),F_1(y),y,r(d_1(y))),& D_0(z,d_1(y))\end{array}\right)\\
\end{align*}\hide{ Dit is bijna niet te doen: zestien elementen zijn ook met een hoop overlap te veel }

The cleavage $K: Y/D_0(F) \to Y/F$ of $D_0(F)$ is defined as follows.
\begin{align*} 
C_0(x,(y,z)) &= (t^Y(y,x), z) \\
C_1(w,x,(w',x',y',z'),z) &= (t^Y(w',w), x, y',t^Y(z',z))
\end{align*}
\end{proof}

An interesting property of this factorisation system is the following \emph{stability}.

\begin{lemma}[Stability] Let $F:X\to Z$ be a fibration with cleavage $K: Z/F \to X$. Let $G:I\to J$ be a deformation retract with deformation $D:Z\to Z/G$. Then the pullback of $G$ along $F$ is a deformation retract. \end{lemma}\hide{pullbacks van functoren\dots}

\hide{Dit is een veel makkelijker manier om te bewijzen dat fibraties onder producten gesloten zijn. Het moet daarom werken!}

\begin{proof} Let $(X\times_Z Y)_i = \set{(x,y)\in X_i\times Y_i| F_i(x_i) = G_i(y_i)}$ for $i=0,1$, so that the pullback of $G$ along $F$ is the projection functor $\Pi^0:X\times_Z Y \to X$.

For each $x\in X_0$ we find a $y\in Y_0$ and a morphism $x \to x'$ such that $Fx'= Gy$ by applying $K$ to the following commutative square.
\[ \xymatrix{
F(x) \ar[r]^{D(F(x))}\ar[d]_{r^Z(F(x))} & Gy\ar[d]^{D(F(x))^{-1}} \\
F(x) \ar[r]_{r^Z(F(x))} & F(x)
}\]
This mapping induces a functor $D':X \to X\times_ZY/\Pi_0$ which satisfies $D_0(\Pi)\circ D' = \id_X$. The deformation $D$ satisfies $D(G(y)) = r^Z(G(y)):Gy \to Gy$. If $x = \Pi^0(x,y)$, then $D(F(x)) = D(G(y)) = r^Z(G(y)) = r^Z(F(x))$. Hence $D'\circ \Pi^0$ equals $R(\Pi^0)$. Therefore $D'$ is a deformation of $\Pi^0$.
\end{proof}


\newcommand\fib{\mathsf{Fib}}
\subsection{Fibrations over a base}
In order to get a model of dependent type theory we need a class of dependent types for each groupoids. The cloven fibrations provide not just a class of types, but a category.

For each internal groupoid $I$ let $\fib(I)$ be the category whose object are cloven fibrations and whose morphisms are commutative triangles. Pullback along a functor $F:I\to J$ induces a functor $F\ri:\fib(J) \to \fib(I)$. Given two functors $F:I\to J$ and $G:J\to K$, there is a unique natural isomorphism $F\ri\circ G\ri \to (G\circ F)\ri$, but this functor does not have to be an identity. This means that $\fib$ is a pseudofunctor $\grpd(\cat E) \to \mathsf{Cat}$.

\begin{lemma} Let $F,G:I\to J$ be an internal functor. A natural transformation $\eta: F\to G$ induces a natural homotopy equivalence $G\ri \to F\ri$. \label{isotohe}\end{lemma}

\begin{proof} Let $\Phi:X\to J$ be a fibration with cleavage $K^\Phi:J/\Phi\to X$. The pullback can now be described as follows. The groupoid $F\ri X$ is just the fibred product $I\times_J X$, and $F\ri(\Phi)$ is its projection to $I$. A similar description holds for $G\ri X$ and $F\ri X$. The cleavage $K^\Phi$ induces a functor $A:G\ri X\to F\ri X$ which commutes with $F\ri\Phi$ and $G\ri\Phi$. 
\[ A(i,x) = (i, K^\Phi(\eta(i),x)) \]
The inverse $\eta\inv$ induces a similar functor $B:G\ri X\to F\ri X$ in the oppositie direction. Its also give us these commutative squares.
\[ \xymatrix{
Fi \ar[d]_{\eta(i)} \ar[r]^\id& Fi\ar[d]^\id \\
Gi \ar[r]_{\eta\inv(i)} & Fi
}\qquad
\xymatrix{
Gi \ar[d]_{\eta\inv(i)} \ar[r]^\id & Gi\ar[d]^\id \\
Fi \ar[r]_{\eta(i)} & Gi
}
\]
For all $(x,i)\in F\ri X_0$ the cleavage $K^\Phi$ turns the first square into an (iso)morphism $K^{\Phi}(\eta(i),K^{\Phi}(\eta\inv(i),x)) \to x$. Thus we get a natural transformation $A\circ B \to \id_{F\ri X}$. For $(x,i)\in G\ri X_0$ the cleavage $K^\Phi$ turns the second square into an (iso)morphism $K^{\Phi}(\eta\inv(i),K^{\Phi}(\eta(i),x)) \to x$. With the natural tranformation $B\circ A \to \id_{G\ri X}$ we have a homotopy equivalence $G\ri X\to F\ri X$ which commutes with $F\ri \Phi$ and $G\ri \Phi$ and hence a natural homotopy equivalence between $F\ri$ and $G\ri$.
\end{proof}

This notion of natural homotopy equivalence induces a weak form of equivalence between categories of the from $\fib(I)$ and $\fib(J)$: if there are functors $\Phi:\fib(I) \to \fib(J)$ and $\Psi:\fib(J) \to \fib(I)$ such that $\Phi\circ \Psi$ is naturally homotopy equivalent to $\id_{\fib(I)}$ and $\Psi\circ \Phi$ is naturally homotopy equivalent to $\id_{\fib(J)}$, then $\fib(I)$ and $\fib(J)$ are \emph{biequivalent}. Lemma \ref{isotohe} has the following consequence.

\begin{corol} If $I$ and $J$ are homotopy equivalent, then $\fib(I)$ and $\fib(J)$ are biequivalent. \end{corol}

\begin{proof} Apply lemma \ref{isotohe} to the natural tranformations which are part of the homotopy equivalence. \end{proof}

\subsection{Products along fibrations}
This subsection show that if $F:I\to J$ is a fibration, then $F\ri$ has a right adjoint. Using the resulting depedent products, we can then build an interpretation of intensional type theory.

\begin{lemma} For each groupoid, the category $\fib(I)$ is Cartesian closed. \end{lemma}

\begin{proof}
The category $\grpd(\cat E)$ has finite limits and fibrations are closed under pullback because they are the right class of a factorization system. Equalizers are just equalizers and products in $\fib (I)$ are pullbacks.

The exponentials are defined fibrewise. The underlying category $\cat E$ is a topos, and has fibrewise exponentials. Hence if $\Phi:X\to I$ and $\Psi:Y\to I$ are objects of $\fib(I)$, there are fibred exponentials $(Y_0)^{X_0}_I$, $(Y_1)^{X_1}_I$, $(Y_1)^{X_0}_I$. Using finite limits, we can construct any equationally define subset of a product of these. This is enough to internalize the definitions of internal groupoids and natural transformations of subsection \ref{internal}. In this way we can construct a fibred exponential $(\Phi\Rightarrow \Psi)$. 

The objects of $(\Phi\Rightarrow \Psi)$ objects are pairs $(i,H)$ where $i\in I_0$ and $H$ is a functor $X_i \to Y_i$. Its morphisms are pairs $(m,H^0,H^1,\eta)$ where $m\in I_1$, $H^i$ are functors in $X_{d_i(m)} \to Y_{d_i(m)}$ and $\eta$ is a natural transformation between functors which can be described as $x\mapsto K^\Psi(m,H^1(x))$ and $x\mapsto H^0(K^\Phi(m,x))$.
\[\xymatrix{ 
X_{d_1(m)}\ar[d]_{H^1} \ar[rr]^{x\mapsto K^\Phi(m,x)} &\ar@{}[d]|\eta & X_{d_0(m)} \ar[d]^{H^0} \\
Y_{d_1(m)}\ar[rr]_{y\mapsto K^\Psi(m,y)} && Y_{d_0(m)}
}\]

A cleavage of $(\Phi\Rightarrow \Psi)$ is constructed as follows. Let $m:i_0\to i_1$ be a morphism of $I$ and let $H:X_{i_1}\to Y_{i_1}$. Now $K^{\Phi\Rightarrow \Psi}(m,H)$ is the functor defined as follows.
\[ x\mapsto K^\Psi(m\inv,H(K^\Phi(m,x))) \]
\hide{aangeven waarom dit een exponential is?}
\hide{nu vrijwel zeker dat cleavages inbegrepen moeten worden. }
\end{proof}

\begin{lemma} For each fibration $F:I\to J$, $F\ri:\fib(J) \to \fib(I)$ has a right adjoint. \end{lemma}

\begin{proof} Let $\Phi$ be an object of $\fib(I)$. The dependent product $\prod_F(\Phi)$ of $\Phi$ along $F$ comes form the pullback of the functor $\id_J \to F^F$ which point to the identity functor, along the induced morphism  $\Phi^F: (F\circ \Phi)^F \to F^F$.
\[ \xymatrix{
\prod_F(\Phi)\ar[r]\ar[d]\ar@{}[dr]|<\lrcorner & (F\circ \Phi)^F\ar[d]^{\Phi^F}\\
\id_J \ar[r] & F^F
}\]

The category $\fib(I)$ is isomorphic to the subcategory of $\fib(J)/F$ whose members are fibrations, and a similar remark holds for $\fib(J)$ versus $\fib(J)/\id_J$. This makes it is easy to see that $\prod_F$ is a right adjoint of $F\ri$.
\[\xymatrix{
F\times \Psi \ar[r] \ar[d]_{F\ri\Psi} & F\circ \Phi\ar[d]^\Phi \\
F\ar[r]_\id & F
}\qquad\xymatrix{
\Psi \ar[r]\ar[d]_\Psi& \prod_F(\Phi)\ar[r]\ar[d]\ar@{}[dr]|<\lrcorner & (F\circ \Phi)^F\ar[d]^{\Phi^F}\\
\id_J \ar[r]_\id &\id_J \ar[r] & F^F
}\]
\end{proof}







\newcommand\db[1]{{[\![} #1 {]\!]}}
\newcommand\of{\mathord:}
\newcommand\dom{\mathrm{dom}}

\subsection{The type category of groupoids}
In order to establish that groupoids and fibrations admit an interpretation of type theory, we will mention that they form a \emph{type category} as defined by Pitts.

\begin{itemize}
\item The category of contexts is $\grpd(\cat E)$.
\item The collection of types over a context $\Gamma$ is $\fib(\Gamma)_0$.
\item Let $T\in \fib(\Gamma)_0$. The extended context $\Gamma;T = \dom T$ and the \emph{projection} $\Gamma; T\to \Gamma$ is $T$ itself.
\item For each $F:\Gamma \to \Delta$ the substitution $T[F]$ is defined as the pullback $F\ri T$.
\end{itemize}

For the interpretation of the rest of type theory, we take advantage of the rich structure $\fib$ already has. The category $\fib(\Gamma)$ is Cartesian closed and has finite coproducts. This structure allows us to easily interpret finite product and discrete sum types, as well as functor types.

The identity types are interpreted through the factorisation of the diagonal functors. For $T:X\to \Gamma$ there is a fibred product $T\times_\Gamma T:X\times_\Gamma X \to \Gamma$ and a diagonal functor $\delta: X\to X\times_\Gamma X$. The identity type 
\[ \id(T) = D_0(\delta):(X\times_\Gamma X)/\delta\to \Gamma;T;T[T] = (X\times_\Gamma X) \]

For the dependent products and coproducts, we use the following trick. Each functor $F:I \to J$ splits as a cloven fibration $D_0(F):J/F\to J$ following a deformation retract $R(F):I\to J/F$. The deformation retract is a homotopy equivalence, and induces a biequivalence between $\fib(I)$ and $\fib(J/F)$. For the cloven fibration $D_0(F)\ri:\fib(I) \to \fib(J/F)$ has left and right adjoints. The dependent products and coproducts of a type $T$ in $\fib(I)_0$ along an arbitrary functor $F$ are intrepreted as the depedent products and coproducts of the pullbakc of $T$ along $D_1(F):J/F\to J$. This means that they satisfy their universal properties only up to homotopy equivalence. This doesn't matter as in equivalence of terms is interpretated as the existsence of a natural transformation between the interpretations of those terms.

\section{Modest sets}%werken aan de titel
Every realizability topos $\cat R$ has a class of discrete arrows, which form a complete fibred subcategory of the codomain fibration $\cat R/\cat R \to\cat R$. The subcategory of \emph{separated objects} in $\cat R$ has a generic discrete arrow. This section goes through the theory of realizability toposes and their discrete objects. We will turn the generic discrete arrow into a universe in the next section.

\subsection{General Realizability Toposes}
Let $\cat S$ be an arbitrary elementary topos. In order to build a realizability topos, we will need an object of realizers $A$, together with a suitable notion of computable partial morphism. The realizability topos implicitely assigns subobjects of $A$ to the propositions of its internal language. The following structure allows valid propositions to correspond to inhabited (or globally supported) subobjects of $A$.

\newcommand\partar\rightharpoonup
\begin{defin}[Partial combinatory algebras] A partial combinatory algebra is a tuple $(A,\cdot,K,S)$ where $\cdot: A\times A \partar A$ is a partial map, and $K, S\subseteq A$ satsify:
\begin{itemize}
\item $K$ and $S$ are inhabited.
\item For all $k\in K$, $x,y\in A$, $k\cdot x$ is defined and $(k\cdot x)\cdot y = x$.
\item For all $s\in S$, $x,y,z\in A$, $s\cdot x$ is defined, $(s\cdot x)\cdot y$ is defined, and if $(x\cdot z)\cdot (y\cdot z)$ is defined, then $((s\cdot x)\cdot y)\cdot z = (x\cdot z)\cdot (y\cdot z)$
\end{itemize}
\end{defin}

The operator $\cdot:A\times A\partar A$ \emph{is} the family of all partial computable arrows, with the first variable acting as an index. In order to get arbtrary-ary functiones, we use the operator $\cdot$ repeatedly. So $\phi_0 = \id_A:A\to A$ is the familie of all $0$-ary functions, and the family of all $n+1$-ary functions $\phi_{n+1}: A^n\times A \partar A$ is defined by $\phi_{n+1}(\vec x,y) = \phi_n(\vec x)\cdot y$ for all $n$ in $\mathbb N$.

Since $A$ may not have any global section, we generally work with inhabited families of partial arrows $U\times A\partar A$ rather than with global partials arrows $A\partar A$.

\newcommand\pow{\Omega^}
\newcommand\rmodels{\stackrel{\mathrel{\bf r}}\Rightarrow}
\newcommand\requiv{\stackrel{\mathrel{\bf r}}\Leftrightarrow}
\begin{defin} For $f_1,\dotsc, f_n$ and $g:X\to \pow A$ let $f_1(x),\dotsc,f_1(x)\rmodels_{x\in X}g(x)$ mean that there is an inhabited family of partial computable functions $I\times A^n \to A$ such that $t$ restricts to a total function $I\times (\prod_{i=1}^n f_i(x)) \to g(x)$. Use $f(x)\requiv_{x\in X}g(x)$ if $f(x)\rmodels_{x\in X} g(x)$ and $g(x)\rmodels_{x\in X} f(x)$.
\end{defin}

With this information we can build the realizability topos, using $\pow A$-valued equivalence relations as objects and equivalences classes of $\pow A$-valued functional relations as morphisms.

\newcommand\rt{\mathsf{RT}}
\begin{defin} A \emph{$\pow A$-valued equivalence relation} is a pair $(X,e_X)$ where $X$ is an object of $\cat S$ and $e_X:X\times X\to \pow A$ satisfies:
\begin{align*}
e_X(x,y) &\rmodels_{(x,y)\in X\times X} e_X(y,x)\\
e_X(x,y), e_X(z,x) &\rmodels_{(x,y,z)\in X\times X\times X} e_X(z,y)
\end{align*}

A \emph{$\pow A$-valued functional relation} $(X,e_X)\to (Y,e_Y)$ is an element $f\in T(X\times Y)$ which satisfies:
\begin{align*}
f(x,y),f(x,y')&\rmodels_{(x,y,y')\in X\times Y\times Y} e_Y(y,y')\\
e_X(x,x'),f(x,y),e_Y(y,y')&\rmodels_{(x,x',y,y')\in X\times X\times Y\times Y} f(x',y')\\
e_X(x,x)&\requiv_{x \in X} \bigcup_{y\in Y} f(x,y)\\
\end{align*}

Two functional relations $f$ and $g:(X,e_X) \to (Y,e_Y)$ are \emph{equivalent} if: 
\[ f(x,y)\requiv_{(x,y)\in X\times Y} g(x,y) \]
\end{defin}

Equivalence relations and functional relation from a topos $\rt(\cat S,A)$. It may be hard to see that this is a category, let alone a topos. For proofs see\dots

\hide{
\subsection{Assemblies}
%waarom dit!? waarom nu!? 

\newcommand\asm{\mathsf{Asm}}
An \emph{assembly} is a pair $(X,r_X)$ where $X$ in an object of $\cat S$ and $r_X$ is a morphism $X\to \pow A$ for which $r_X(x)$ is inhabited. A morphism $(X,r_X) \to (Y,r_Y)$ is a morphism $f:X\to Y$ such that $r_X(x)\rmodels_{x\in X} r_Y(f(x))$. Together these form the category of assemblies $\asm(\cat S,A)$.

There is a functor $J:\asm(\cat S,A) \to\rt(\cat S,A)$. For each assembly $(X,r_X)$, $J(X,r_X) = (X,\bigcup_{\delta_X}(r_X))$ where $\bigcup_{\delta_X}(r_X)$ is the fibrewise join along the diagonal map $\delta_X:X\to X\times X$, i.e. $\bigcup_{\delta_X}(r_X)(x,y) = \bigcup\set{r_X(z)|(x,y)=\delta_X(z)}$. For each morphism $f:(X,r_X)\to(Y,r_Y)$, $Jf = \bigcup_{(\id_X,f)}(r_Y\circ f)$. This functor is fully faithful, which makes $\asm(\cat S,A)$ a full subcategory of $\rt(\cat S,A)$.

There is a functor $\nabla: \cat S \to \asm(\cat S,A)$. For each object $X$, $\nabla X = (X, x\mapsto A:X\to \pow A)$. The functor $\nabla$ mapst each morphism to itself, adn is a full and faithful functor. Therefore $\cat S$ is a full subcategory of both $\asm(\cat S,A)$ and $\rt(\cat S,A)$.
}

\subsection{Geometric inclusion}
There is a geometric inclusion of $\cat S$ into the realizability topos $\rt(\cat S,A)$.

For each object $X$ and each morphism $f$ of $\cat S$ the functor $\nabla:\cat S \to\rt(\cat S,A)$ is defined as follows.
\begin{align*}
\nabla X &= (X, (x,y)\mapsto \set{a\in A|x=y})\\
\nabla f &= f
\end{align*}

The functor $\nabla$ has a left adjoint left inverse $\Gamma$ which is defined as follows. For objects $X=(|X|,e_X)$, $(|Y|,e_Y)$ and for functional relation $F:X\to Y$
\begin{align*}
\Gamma X &= |X|/\set{(x,y)\in |X|\times |X|\ | \exists a\in A. a\in e_X(x,y)}\\
\Gamma F &= \xi \mapsto \set{y\in |Y|\ | \exists a\in A,x\in \xi. a\in F(x,y) }
\end{align*}

The unit $\eta_X:X\to \nabla\Gamma X$ and the counit $\epsilon_Y:\Gamma \nabla Y \to Y$, which is an isomorphism, satisfy the following equations.
\begin{align*}
\eta_X(x) &= \set{y\in |X|\ |\exists a\in A. a\in e_X(x,y)}\\
\epsilon_Y(\set y) &= y
\end{align*}




\subsection{Discrete arrows}
Hyland, Rosolini etc. discribes the complete internal full subcategory of discrete object in the effective topos. The generalization to other realizability toposes is straightforward. The object $I = \nabla(1+1)$ is not isomorphic to $1+1$ although it has only two global sections $0:1\to I$ and $1:1\to I$. We can treat it as a kind of path object, even though composition of these paths is not well defined.

\begin{defin}
A \emph{connected epimorphism} is an epimorphism $e:X\to Y$ for which the following diagram is a pushout.
\[\xymatrix{
X^I_Y\times I \ar[d]_{\pi_0}\ar[r]^{\epsilon} & X \ar[d]^e\\
X^I_Y\ar[r]_{e^I_Y} & Y
}\]
Here $X_Y^I$ is defined by the following pullback, where $Y^!$ is the transpose of $\pi_0:Y\times I \to Y$.
\[ \xymatrix{
X_Y^I \ar[r]\ar[d]\ar@{}[dr]|<\lrcorner & X^I \ar[d]^{e^I} \\
Y \ar[r]_{Y^!} & Y^I
}\]
Equivalently, \[ X_Y^I=\set{(h,y):X^I\times Y| \forall i\in I.f(h(i)) = y}\]
The map $\epsilon$ above takes $(h,i)\in X_Y^I\times I$ to $h(i)\in Y$. 

\begin{example} A morphism in $\rt(\cat S,A)$ is \emph{prone} if it is prone relative to $\Gamma:\rt(\cat S,A)\to\cat S$ in the sense of the elephant.%cite
The geometric morphism $\cat S \to\rt(\cat S,A)$ induces a Lawvere Tierney topology and prone morphisms are precisely families of sheaves for this topology. Meanwhile the unit $\eta_{1+1}:1+1\to I$ is a \emph{local isomorphism}. Hence if $f:X\to Y$ is prone then $X^I_Y\simeq X\times_Y X$. For this reason, all prone epimorphisms are connected.%???
\end{example}


A \emph{discrete arrow} is an arrow $f:X\to Y$ for which the diagonal map $(X^!,f):X\to X^I_Y$ is an isomorphism.
\end{defin}

These morphism form a factorisation system on every realizability topos, with the factorisation of a morphism $f:X\to Y$ determined with a pushout as follows.
\[\xymatrix{
X^I_Y\times I \ar[d]_{\pi_0}\ar[r]^{\epsilon} & X\ar[d]_{C(f)}\ar[r]^\id &X \ar[d]^f\\
X^I_Y\ar@/_/[rr]_{f^I_Y}\ar[r] & \bullet\ar[r]^{D(f)} \ar@{}[ul]|<\ulcorner & Y
}\]

\begin{lemma} For each $f:X\to Y$, $C(f)$ is connected, and $D(f)$ is discrete. \end{lemma}

\begin{proof} Let $Z$ be the codomain of $C(f)$ and the domain of $D(f)$. The morphism $C(f)$ is connected if the following diagram is pullback:
\[\xymatrix{
X^I_Z\times I \ar[d]_{\pi_0}\ar[r]^{\epsilon} & X \ar[d]^{C(f)}\\
X^I_Z\ar[r]_{{C(f)}^I_Z} & Z
}\]
Here, $X^I_Z = \set{(h,z):X^I\times Y| \forall i\in I. C(f)(h(i)) = y }$. 

If $C(f)(h(i)) = C(f)(h(0))$ then clearly $f(h(i))=f(h(0))$ so $X^I_Z \subseteq X^I_Y$. If $f(h(i))=f(h(0))$ then $C(f)(h(i)) = C(f)(h(0))$ because $h(i)$ and $h(0)$ are path connected elements of a fibre of $f$. Therefore $X^I_Z = X^I_Y$, making the diagram above equivalent to the pushout that defines $C(f)$. Hence $C(f)$ is connected.

%o nee hè
The morphism $D(f):Z\to Y$ is discrete if $(Z^!,D(f)):Z\to Z^I_Y$ is an isomorphism. It is easy to see that it is a split monomorphisms because there is a left inverse: $(h,y)\mapsto h(0)$. To see that this an epimorphism we use the fact that the functor $X\mapsto X^I$ preserves regular epimorphisms. \hide{gewoon uitwerken ergens.} 
So $C(f)^I_Y$ is a regular epimorphism $X^I_Y\to Z^I_Y$. The map $(h,y)\mapsto C(f)(h(0)): X^I_Y \to Z$ is a regular epimorphism for trivial reasons. Now $C(f)^I_Y(h) = C(f)\circ h$ is a constant function because all point in $I$ are connected. That means $C(f)\circ h = (Z^!,D(f))((C(f)(h(0))))$. This proves $(Z^!,D(f))$ is a regular epimorphism and hence an isomorphism.
\end{proof}

\newcommand\Disc{\mathsf{Disc}}
For every object $X$ of $\rt(\cat S,A)$ there is a category $\Disc(X)$ of discrete arrows with codomain $X$ with commutative triangles as morphisms. Every morphism $f:X\to Y$ induces a functor $f\ri:\Disc(Y)\to \Disc(X)$ by pullbacks. The category $\Disc(X)$ is a reflective subcategory of the topos $\rt(\cat S,A)/X$ because of the factorization system. It therefore has all finite limits and colimits.\hide{reflector is not lex} The left class is generated by morphisms of the form $\pi_0:X\times I \to X$ and this class of morphisms is stable under pullbacks. Because of this, discrete objects are closed under dependent products. For these reasons, discrete arrows form a complete fibred subcategory of the codomain fibration.

\newcommand\genpa{{\mathring A}}
\newcommand\gendisc{{\bf\Phi}}
\subsection{Generic discrete}
A \emph{discrete object} in $\rt(\cat S,A)$ is an object $D$ for which the arrow $!:D\to 1$ is discrete. There is a special discrete object $\genpa$ such that discrete objects coincide with quotients of subobjects of $\genpa$. Since $\rt(\cat S,A)$ is a topos, there is an object $Q$ of \emph{partial equivalence relations}, i.e. symmetric and transitive relations, of $\genpa$ together with a discrete arrow $\gendisc$ such that the fibre $Q'_R$ is precesily the subquotient $\genpa/R$. The geometric embedding of $\cat S\to\rt(\cat S,A)$ induce a class of separated objects: an object $X$ is separated if the unit $\eta_X:X\to\nabla\Gamma X$ is a monomorphism. Every discrete arrow whose codomain is separated is a pullback of the discrete arrow $\gendisc$.
The means that if $Y$ is separated, then any discrete arrow $f:X\to Y$ is a family of quotients of subobjects of $\genpa$. 

The object $\genpa$ is defined as follows.
\[ \genpa= (A,(a,b)\mapsto \set a\cap \set b) \]
Here $A$ is the underlying object of the partial combinatory algebra. The object $\genpa$ is weakly generic, relative to the functor $\Gamma:\rt(\cat S,A) \to\cat S$.

\begin{theorem}[Weak genericity] For each object $X$ there is an object $Y$ and a pair of morphisms $p:Y\to \genpa$ and $e:Y\to X$ such that $p$ is prone (relative to $\Gamma$) and $e$ is a regular epimorphism. \end{theorem}

\begin{proof} For the full prove see%thesis

Let $X= (|X|,e_X)$. Define $Y$ as the following pair:
\[ Y = (A\times |X|, ((a,x), (b,y))\mapsto \set{c\in A|x=y, a=b=c\in e_X(x,x) } )\]
The projections $A\times |X|\to A$ and $A\times|X|\to|X|$ induce the required morphisms $p:Y\to \genpa$ and $e:Y\to X$.
\end{proof}

\begin{corol} Discrete objects are quotient of prone subobjects of $\genpa$. \end{corol}

\begin{proof} Suppose $X$ is a discrete object, $e:Y\to X$ is a regular epimorphism and $p:Y\to \genpa$ is a prone morphism. The prone morphism $p$ factors as a prone monomorphism $M(p):Z\to \genpa$ following a prone epimorphism $E(p):Y\to Z$, which is connected and hence orthogonal to $!:X\to 1$. Hence there is a $g:Z\to X$ such that $g\circ E(p) = e$. This means $g$ is an epimorphism too, and that the prone `subobject' $Z$ of $\genpa$ covers $X$.
\[ \xymatrix{
Y\ar[d]_{E(p)} \ar[rr]^e && X\ar[d] \\
Z \ar[r]_{M(p)}\ar[urr]^g & \genpa\ar[r] & 1
}\]

We now know that discrete objects are quotients of certain subobjects of $\genpa$. That alle quotients of subobjects of $\genpa$ are discrete follows form the following observations.
\begin{enumerate}
\item The object $\genpa$ is discrete. This requires wroking out the definition of $\genpa^I$ etc.
\item Monomorphisms are discrete, hence subobjects of discrete objects are discrete.
\item If $X$ is discrete and $e:X\to Y$ is a regular epimorphism, then so is $e^I:X^I\to Y^I$ because $I$ is internally projective. The split monic $X^!:X\to X^I$ is an isomorphism, and $Y^!\circ e = e^I\circ X^!$, forcing the split monic $Y^!$ to be an epimorphism and hence an isomorphism too.
\end{enumerate}

\end{proof}


The bundle of discrete objects is defined as follows. The object $Q$ consist of the binary relation $r\in \pow{\genpa\times\genpa}$ which are symmetric and transitive, the \emph{partial equivalence relations}. The object $Q'$ consist of pairs $(r,\xi)\in \pow{\genpa\times\genpa}\times\pow\genpa$ where $r$ is a partial equivalence and $\xi$ is one of its equivalence classes. The bundle $\gendisc: Q'\to Q$ is simply the projection to equivalences.

For each discrete object $D$ there is a global section $\chi:1\to Q$ such that $!:D\to 1$ is the pullback of $\gendisc$. The same can be said of some other discrete arrows, because the weak genericity theorem generalizes to some slice categories of $\rt(\cat S,A)$.

\begin{lemma}[Weak Genericity over $\nabla$] For each object $X$ of $\cat S$ and each morphism $f:Y\to \nabla X$ there is a object $Z$ and a pair of morphism $e:Z\to Y$ and $p:Z\to X\times\genpa$ such that $e$ is a regular epimorphism and $p$ is prone.\end{lemma}

\begin{proof} The object $Y$ has an object $Z$ together with morphism $e:Z\to Y$ and $p:Z\to \genpa$ such that $e$ is a regular epimorphism and $p$ is prone. We just need to show that $(f\circ e,p):Z\to \nabla X\times \genpa$ is prone.

The projection $\pi_1:\nabla X\times\genpa\to \genpa$ is prone, and so is $p = \pi_1\circ(f\circ e,p)$. 
Suppose $h:W\to \nabla X\times \genpa$ has the property that $\Gamma h = \Gamma (f\circ e,p) \circ k$ for some $k:\Gamma W\to \Gamma Z$. Because $p$ is prone, there is a unique $k':W\to Z$ such that $\Gamma k'=k$ and $p\circ k' = \pi_1\circ h$. Now $\pi_1\circ (f\circ e,p)\circ k' = \pi_1\circ h$ and $\Gamma((f\circ e,p)\circ k') = \Gamma(f\circ e,p)\circ k = \Gamma h$, so $(f\circ e,p)\circ k' = h$ because $\pi_1$ is prone. But this means that $h$ has a unique factorisation through $(f\circ e,p)$ which means that $h$ is prone.%def prone moet ergens.

\[\xymatrix{
& W\ar@{.>}[dl]_{k'} \ar[d]^h \ar[dr]^{\pi_1\circ h} \\
Z \ar[r]^{(f\circ e,p)}\ar@/_/[rr]_{p} & \nabla X\times \genpa\ar[r]^{\pi_1} & \genpa
}\]

%De projectie is prone omdat $\nabla X$ een schoof is.
\end{proof}

An object $X$ is \emph{separated} if the unit $\eta_X:X\to\nabla\Gamma X$ is monic.

\begin{theorem}[Generic discrete] For each separated $Y$ and each discrete $f:X\to Y$ there is a morphism $\chi:Y\to Q$ such that $f$ the the pullback of $\gendisc$ along $\chi$. \end{theorem}

\begin{proof} Monomorphisms are discrete. The discrete $\eta_Y\circ f$ has a $\chi:\nabla \Gamma X\to Q$ such that $\eta_Y\circ f$ is the pullback of $\gendisc$ along $\chi$. But $f$ is the pullback of $\eta_Y\circ f$ along $\eta Y$, and hence the pullbakc of $\gendisc$ along $\chi\circ \eta_Y$
\newcommand\pbc{\ar@{}[dr]|<\lrcorner}%pullbackcorner
\[ \xymatrix{
X\ar[d]_f \ar[r]^\id\pbc & X \ar[d]^f \ar[r]\pbc & Q'\ar[dd]^\gendisc\\
Y\ar[r]^\id \ar[d]_\id\pbc & Y\ar[d]^{\eta_Y} & \\
Y \ar[r]_{\eta_Y} & \nabla\Gamma Y \ar[r]_\chi & Q
}\]
\end{proof}

\newcommand\genmod{\mathrm{\rotatebox[origin=c]{90}{3}}}
\subsection{Separated objects and modest sets}
The generic discrete arrow is actually a generic family of subquotients of $\genpa$. These families of subquotients are closed under many dependent products, but not all of them, even though discrete arrows are. No problem does occurs if we only look at discrete arrows between separated objects.

The geometric inclusion $\cat S\to\rt(\cat S,A)$ induces a local operator $j:\Omega \to \Omega$. The separated objects are simply the $j$-separated object for this operator. That measn that $j(x=y)$ implies $x=y$ for these objects.

A \emph{modest set} is a separated discrete object. There is a generic family of modest sets whose domain and codomain are separated. Let $P$ be the object of partial equivalence relations in $\nabla \Omega^{\genpa\times \genpa}$ and let $P'$ be the object of pairs $(r,\xi)\in \Omega^\genpa\times\Omega^{\genpa\times\genpa}$ where $r$ is a partial equivalence relation and $\xi$ in an equivalenceklass of $r$. Let $\genmod:P'\to P$ be the projection $(r,\xi)\mapsto r$. Both $P$ and $P'$ are separated and $\genmod$ is discrete. Now every discrete morphism betwen separated object is a pullback of $\genmod$.


In the next section, we put these things together to extend our model of type theory.

\section{Univalence}
We turn to the category of internal groupoids in the subcategory of separated objects. The trivial groupoid structure turns modest sets into a collection of small types, which has a univalent universe.

\subsection{Orthogonality}
A family of sets indexed over a groupoid is the same thing as a faithful functor over the groupoid. Let $G$ be a groupoid, and let $F:G^{op}\to\mathsf{Set}$ be the indexed family of sets. The Grothendieck construction gives a groupoid $G'$ which has pairs $(i\in G,x\in G_i)$ as object; a morphism $(i,x)\to (j,y)$ is a morphism $h:i\to j$ such that $x=Fh(y)$.

A \emph{modest functor} is faithful and discrete on objects. Such functors are right orthogonal to full functors which are prone epimorphic on objects. This causes modest functors to be closed under finite limits. Because full and prone epimorphism functors are stable under pullback, modest fibrations are closed under depedent products along fibrations.

Thus we get our theorem:
\begin{theorem} Modest sets are a model for homotopy type theory. \end{theorem}




\hide{
Eindsectie met bespreking van mogelijke localisaties/generalizaties

Boeiende eigenschappen van het model

Rosolini's topos nog ergens noemen?}

%iets met modest




\hide{Het is moeilijk om te beslissen wat wel te vertellen en wat niet. Ik wil dat ergens in het midden laten, maar waar is dat?}


\hide{waar will we nu eidnelijk heen? generic modest arrow!}

%Families of subquotients are not closed under all dependent products, however.%cite













\end{document}



This section is about the following lemma, which explains why there is a generic discrete arrow in some sense.

\begin{lemma} For each object $Y$ of $\cat S$ each discrete arrow $f:X\to \nabla Y$ is a quotient of a subarrow of $\pi_0:Y\times \genpa\to Y$. \end{lemma}

\begin{proof} The object $\genpa$ is defined as the following pair, where $A$ is the partial combinatory algebra.
\[ \genpa= (A,(a,b)\mapsto \set a\cap \set b) \]

Let $X=(|X|,e_X)$ and consider the following object.
\[ X_p =  \]

The projections $A\times |X|\to A$ and $A\times |X|\to |X|$ induce morphisms $p:X_p \to \genpa$ and $q:X_p \to X$. The morphism $p$ is prone, and the morphism $q$ is a regular epimorphism. Moreover, the epimorphic part $E(f\circ q,p)$ of $(f\circ q,p):X \to \genpa\times\nabla Y$ is also prone and therefore connected.
\[ \xymatrix{
X_p\ar[d]_{E(f\circ q,p)} \ar[rr]^{q} && X \ar[d]^f \\
\bullet \ar[r]_{M(f\circ q,p)}\ar@{.>}[urr]^g &\nabla Y\times\genpa\ar[r]_{\pi_0} & \nabla Y
}\]
The vertical arrow $g$ exists because $E(f\circ q,p)$ and $f$ are orthogonal, and is an epimorphim because $g\circ E(f\circ p, q)$ is. The morphism $M(f\circ p,q)$ is the monic part of $(f\circ p,q)$. Together these arrows show that $f$ is a quotient of a subobject of $\pi_0$.
\end{proof}

Since $\rt(\cat S,A)/\nabla Y$ is a topos we now get of lot of constructiction for free. There is an object $Q$ of partial equivalence relations of $\genpa$, together with a discrete arrow $\gendisc$ such that de fibre over the relation $R$ is the discrete object $\A/R$.%quotienten???
Every discrete arrow $f:X\to \nabla Y$ is the pullback of $\gendisc$ along some morphism $\nabla Y \to Q$. 

When the unit $\eta_Z:Z\to \nabla \Gamma Z$ is a monomorphism, it is also a discrete arrow. %separated objects.







\end{document}

% er is een generieke modest arrow.

%A \emph{modest arrow} is a discrete arrow whose fibres are assemblies. Any discrete arrow between assemblies is modest. If $f:X\to Y$ is discrete, $Z$ is an assembly and $e:Z\to Y$ is a regular epimorphism, then $f$ is modest if the pullback of $f$ along $e$ is--this is the case if and only if de fibred product $X\times_YZ$ is an assembly.%goede definitie?

\hide{%ja ongeveer... maar waar wil ik echt heen?
\subsection{Weak genericity}
The left adjoint $\Gamma:\rt(\cat S, A) \to\cat S$ is a Grothendieck fibration. A \emph{generic object} for this fibration would be an object $G$ such that for each object $X$ there is a map $f:X\to G$ such that the naturalness square with the unit is pullback.
\[\xymatrix{
X\ar[r]^f\ar[d]_\eta \ar@{}[dr]|<\lrcorner & G \ar[d]^\eta \\
\nabla\Gamma X \ar[r]_{\nabla\Gamma f} & \nabla \Gamma Y
}\]

Such a generic object does not exist vor the whole category of assemblies, but there are object which generate interesting subcategories.

\begin{itemize}
\item The object $(\pow A, (U,V) \mapsto \set{a\in U|U=V } )$ generates all the separated object for the topology which the 
\item The object $(A,a\mapsto \set a)$
\end{itemize}
}


\hide{
Er is geen weak genericity in slices over willekeruige objecten, we moeten ons beperken tot assemblies. De fibratie over assmblies heeft echter wel degelijk een generiek object, namelijk de zwak complete versie van het object van alle equivalenbtierelaties. 

Intussen spelen prone epi's een steeds kleinere rol, en herhalen we steeds meer van het artikel van Hyland etc.

Zijn discrete objecten geen interne catgeorie? Er moet dan iets fout gaan met het object van pijlen. Een paar pijlen tussen een paar objecten is niet noodzakelijk $\neg\neg$ van elkaar te scheiden. Een vergelijkbaar probleem doet zich voor met de interne schoof: vezelsgewijs geen assemblie, dus in het geheel ook niet. En daarmee basta.

}




\hide{


- completeness
- alles een \neg\neg-reflectie van \A
- prone epi = connected epi
- 


}






We can now use groupoids to interpret type theory. Such an interpretation is a series of mappings: 
\begin{itemize}
\item from contexts to groupoids;
\item from types to fibrations;
\item from elements to sections of fibrations.
\end{itemize}

The type theory presented here the internal type theory of this model, which means that the groupoids and functor themselve serve as atomic types and terms. Other expressions are build from those. 

The classes of families of types and of contexts are formed by mutual recursion. A context $\Gamma$ is interpreted as a groupoid $\db\Gamma$. A family of types $T$ over a context $\Gamma$ is interpretated as a fibration $\db T_\Gamma:\dom\db T_\Gamma\to \db\Gamma$.

A context is generated from groupoids and fibrations by the following rules.
\begin{enumerate}
\item for each groupoid $I$ and each variable $x$, $x\of I$ is a context. Interpretation simply erases the variable: $\db{x\of I}=I$
\item for each type $T$ over $\Gamma$ and $\Gamma$, and each variable $y$ which does not already occur in $\Gamma$, $\Gamma;y\of T$ is a context. The interpertation $\db{\Gamma, y\of T} = \dom\db T_\Gamma$.
\end{enumerate}

There are more constructions of types available. The following are for a fixed context $\Gamma$.
\begin{enumerate}
\item Each fibration $F:X\to \db \Gamma$ is a type dependent on $\Gamma$.
\item There is a terminal type $1$, and $\db 1_\Gamma = \id_{\db\Gamma}:\db\Gamma \to \db \Gamma$. 
\item There is an initial type $0$ and $\db 0_\Gamma$ is the unique map $!:0\to \db \Gamma$, where $0$ is the initial groupoid.
\item For each pair of types $T,U$ dependent on $\Gamma$, $T\times U$ is a type and $\db{T\times U}_\Gamma$ is the fibred product of $\db T_\Gamma$ and $\db U_\Gamma$.
\item For each pair of types $T,U$ dependent on $\Gamma$, $T+U$ is a type and $\db{T+U}$ is the factorisation of $\db{T}$ and $\db{U}$ through the coproduct of their domains: $(\db{T},\db{U}): \dom\db T+\dom\db U \to \db\Gamma$.
\item For each pair of types $T,U$ dependent on $\Gamma$, $T\to U$ is a type and $\db{T\to U}_\Gamma=(\db{T}_\Gamma \Rightarrow \db{U}_\Gamma)$.
\item For each type $T$ dependent on $\Gamma$ there is a type $T^\to$ dependent on $\Gamma; y\of T\times T$. It is interpretd as $D_0(\Delta): (X\times_{\db \Gamma} X)/\Delta \to X\times_{\db \Gamma} X$ where $X = \dom T_\gamma$ and $\Delta$ is the (fibred) diagonal $X\to X\times_{\db \Gamma} X$.
\end{enumerate} %wisselwerking: context bevatten typen!

The next set works with a fibration $F:X\to \db\Gamma$.
\begin{enumerate}
\item For each fibration $F:X\to \db\Gamma$ and each type $T$ over $\db \Gamma$, $\Delta_F(T)$ is a a type over $\Gamma, y\of F$ and $\db{\Delta_F(T)}_{\Gamma; y\of F} = F\ri\db T_F$.%is dit wel genoeg?
\item For each fibration $F:X\to \db\Gamma$ and each type $T$ over $\db{\Gamma;y\of F}$, $\Sigma_{y\of F} T$ is a type over $\Gamma$, and $\db{\Sigma_{y\of F} T}_\Gamma = F\circ \db T_{\Gamma;y\of F}$.
\item For each fibration $F:X\to \db\Gamma$ and each type $T$ over $\db{\Gamma;y\of F}$, $\Pi_{y\of F} T$ is a type over $\Gamma$, and $\db{\Pi_{y\of F} T}_\Gamma = \prod_F(\db{T}_{\Gamma,y\of F})$.
\end{enumerate}%tot nu toe geen duidelijk gebruik gemaakt van de variabelen. Waarom hoeven de cofibraties niet?

\newcommand\pair[2]{\langle #1,#2\rangle}
A term $t$ of type $T$ over context $\Gamma$ is interpreted as a section of $\db T_\Gamma$, i.e. a functor $t:\db\Gamma \to \dom\db T_\Gamma$ such that $\db T_\Gamma\circ F = \id_{\db\Gamma}$. There formation is type dependent.
\begin{enumerate}
\item Each section $f$ of $\db T_\Gamma$ is a term of type $T$.
\item There is a term $*$ of type $1$ and its interpretation is $\db*_\Gamma = \id_{\db \Gamma}$.
\item 
\item If $T,U$ are types over $\Gamma$, $t$ is a term of type $T$ over $\Gamma$ and $u$ is a term of type $U$ then $\pair tu$ is a term of type $T\times U$. 
\end{enumerate}


%??? ik weet nog niet wlke rol substituties spelen e.d. Dit is frustrerend.
% het is een goede eigenschap van een model/ thoery als hij invariant is onder substituties, maar het speelt verder niet echt een rol.
% een term is soms eerder een boom van morfismes dan een enkel morfisme. Daar moeten we iets aan doen.




\hide{Hott boek geeft:
- exponentials
- dependent products
- binary products
- depedent coporducts
- binary coproducts
- identity types.
}



\hide{Beck Chevalley!?}




\hide{homotopy types want groupoids met secties hebben een modelstructuur\dots}

\hide{denk aan een variant van setbuilder: \set{i:I| \Phi(i) } }


\section{Modest sets}
\hide{vallen we door de mand met assemblies}



\end{document}