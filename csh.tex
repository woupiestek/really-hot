% LaTeX 2e document, TAC style, 36 pp, Xy-pic ver ?, MikTeX version ?

\documentclass{tac}
\usepackage{subfiles}
\usepackage{amssymb, amsmath}
\usepackage[backend=bibtex,citestyle=authoryear-icomp]{biblatex}
\usepackage[all]{xy}
\usepackage{url}

\title{Constructive Simplicial Homotopy}
\author{Wouter Pieter Stekelenburg}\copyrightyear{2015}
\address{Faculty of Mathematics, Informatics and Mechanics\\
University of Warsaw\\
Banacha 2\\
02-097 Warszawa\\
Poland}
\eaddress{w.p.stekelenburg@gmail.com}
\keywords{realizability, simplicial homotopy, Kan complexes}
\amsclass{03D80, 18G30, 18G55}

\newcommand\hide[1]{}
\newcommand\cat\mathcal
\newcommand\set[1]{\left\{#1\right\}}
\mathrmdef{id}
\mathrmdef{dom}
\mathrmdef{cod}
\newcommand\ri{^*}
\newcommand\N{\mathbb N}
\mathbfdef[nno]{N}
\newcommand\dual{^{\mathrm{op}}}
\mathbfdef[simCat]\Delta
\newcommand\s{^{\simCat\dual}}
\mathssbxdef{Asm}
\newcommand\bang{!}
\newcommand\of{:}
\newcommand\simplex\Delta
\newcommand\cycle{\partial\Delta}
\newcommand\horn\Lambda
\newcommand\f{_f}
\newcommand\tuplet[1]{\left\langle #1 \right\rangle}
\newcommand\true{\mathtt{true}}
\newcommand\false{\mathtt{false}}
\newcommand\bool{\mathtt{bool}}
\mathrmdef{nat}
\mathssbxdef{Ar}
\mathssbxdef{Ob}
\newcommand\pp{\mathbin\diamond}
\newcommand\norm[1]{\Vert #1 \Vert}
\newcommand\ka\kappa
\newcommand\la\lambda
\mathrmdef{face}
\mathrmdef{colim}
\newcommand\ex{_{\textrm{ex}}}
\newcommand\citep[1]{[\cite{#1}]}
\mathrmdef{dim}
\newcommand\base{\mathbf{U}}
\mathssbxdef[sub]{Sub}
\newcommand\ambient{\mathfrak A}
\mathrmdef{uni}
\newcommand\disc{_{\rm disc}}
\mathrmdef{filler}

\newcommand\keyword[1]{\emph{#1}\label{#1}}


\addbibresource{realizability}

\begin{document}

\begin{abstract} The paper show how to develop simplicial homotopy inside realizability categories like the category of assemblies, where the small object argument and minimal fibrations are unavailable. This way simplicial assemblies are a suitable model for homotopy type theory.\end{abstract}

\hide{
Three papers:
-simplicial homotopy
-complete categories [how they are preserved]
-the realizability model of HOTT [how to get a fibrant object out of a category]

Idee: reverse the order. definitions--theorem--lemmas. That way the purpose of the lemmas is set up from the start.
}

\maketitle

\hide{
Thorough investigation of the background. If we have an ELCCC then the poset-reflection is a Heyting algebra. The reindexing morphisms between the poset reflections are Heyting algebra morphisms and its adjoints remain adjoints.

}

\subfile{cshintro}

\subfile{cshmodel}

\section{Cofibrations}%class functors not mentioned in the sections below--"characteristic functors"

\begin{definition} An \emph{internal factorization system} on a category consists of two classes of morphisms $L$ and $R$, with the following properties.
\begin{itemize}
\item A morphism $l$ belongs to $L$ if an only if it has the left lifting property with respect all to members of $R$.
\item The class $R$ has the dual property.
\item Every morphism factors as a member of $R$ following a member of $L$.
\end{itemize}
\end{definition}

This section defines \emph{acyclic fibrations} and \emph{cofibrations} and shows that they form an \emph{internal factorization system} on $\ambient\s$.

\subsection{fibrations}
\hide{ 

Idea: define Kan fibrations, define cofibrations, demonstrate the lifting properties. Move on happily.

New idea: go by factorization system.

1. The lifting properties of cofibrations
2. Factorization property

}
Both fibrations and acyclic fibrations are defined the same way: they have the right lifting property with respect to a specific family of morphisms.

\hide{ Add def. of sieve over $\simCat$
Wrong: I was calling it a sieve because I was thinking of the category of elements of $\simplex[n]$
$\ambient\s$ defined?
Member functions for internal simplicial objects?
 }
\begin{definition} For each $n\in\N$, the $n$-simplex $\simplex[n]$ is the internal simplicial set where $\base{\simplex[n]}$ is the object of all morphisms $\phi$ in $\simCat$ such that $\cod(\phi) = n$, $\dim(\phi) = \dom(\phi)$ and $\phi\cdot \xi = \phi\circ \xi$.

The \emph{cycle} $\cycle[n]$ is the subobject of non surjective functions of $\simplex[n]$. The $\dim$ and $\cdot$ are the same, and the bases are related as follows:
\[ \base{\cycle[n]} = \set{\phi\of\base{\simplex[n]}| \exists i\of[n].\forall j\of \dom(\phi).\phi(i)\neq j } \]

Similarly, for each $k\of[n]$ the \emph{horn} $\horn_k[n]$ is the sieve of the non decreasing maps $[m]\to [n]$ that are not onto the set $[n]-\set{k}$.
\[ \base{\horn_k[n]} = \set{\phi\of\base{\simplex[n]}| \exists i\of[n]-\set k.\forall j\of \dom(\phi).\phi(i)\neq j } \]

\end{definition}

These subobjects are definable in the internal language of $\ambient$ because being surjective is a decidable property of morphisms $[m]\to[n]$.

\begin{definition} Cycles and horns form families of morphisms indexed over $\nno$ and over $\set{(n,k)\in\nno\times\nno| k\leq n }$ respectively.
\begin{itemize}
\item A \emph{Kan fibration} is an injective morphism relative to the family of all horn inclusions.
\item An \emph{acyclic Kan fibration} is an injective morphism relative to the family of cycle inclusions.
\item A \emph{Kan complex} or \emph{Kan fibrant object} is a simplicial object $X$ for which the unique morphism $\bang_X\of X\to 1$ is a fibration.
\item A \emph{Kan complex} $X$ is \emph{contractible} if $\bang_X\of X\to 1$ is acyclic.
\end{itemize}\label{Kan}

The category of Kan complexes and morphisms of simplicial object is $\ambient\s\f$.
\end{definition}
This paper usually leaves out `Kan' and simply talk about fibrations and complexes.

\subsection{Cofibrations}
This subsection proves that morphisms in $\ambient\s$ factor as acyclic fibrations following cofibrations. 

\begin{definition} A $y\of Y[n]$ is called an \emph{$n$-simplex} of $Y$. An $n$-simplex is \emph{degenerate} if there is an $s\of [n]\to [n]$ different from $\id_{[n]}$ such that $Y(s)(y)=y$. If there are no such $s$ and $x$, then $y$ is \emph{nondegenerate}. A nondegenerate simplex is called a \emph{face}. 

A subobject $W\of X$ is decidable, if there is a morphism $X\to\bool$ such that $W$ is the pullback of one of the morphisms $1\to\bool$. A monomorphism $f\of X\to Y$ is a \emph{cofibration} if the subobject $S$ of all faces outside of the image of $f$ is decidable.
\end{definition}

\begin{lemma} Acyclic fibrations and cofibrations form a weak factorizations system.
\end{lemma}

\begin{proof} Proposition \ref{factor1} shows that every morphisms factors as an acyclic fibration following a cofibration. Lemma \ref{Reedy} shows that cofibrations have the required lifting property. Finally, proposition \ref{cofibration characterization} shows that every morphisms that has the right lifting property with respect to every cofibration.
\end{proof}


\subsubsection{Lifting}
The class of morphisms that has the right lifting property with respect to all fibrations, is closed under various constructions, notably compositions, finitary coproducts and pushouts. They are also closed under transfinite compositions of cochains \hide{lemma...}, which are defined as follows.

\begin{definition} The successor morphism $s\of\nno\to\nno$ induces an endofunctor $s\ri$ of $\ambient/\nno$. A \emph{chain} is a morphism a morphism $f\of s\ri(X)\to X$ in $\ambient/\nno$.  A morphism of chains $(X,f)\to(Y,g)$ is a morphism $h\of X\to Y$ such that $h\circ f = g\circ s\ri(h)$.

Dually, a morphism $f\of X\to s\ri(X)$ is a \emph{cochain} and a \emph{cochain morphism} commutes with cochains in the dual way.

For every object $Y$ of $\ambient$ there is a constant family $\nno\ri(Y)$ and for these constant families $s\ri(Y)\simeq Y$. The isomorphism turn constant families into trivial algebras. The \emph{transfinite composition} is a universal morphism of $s\ri$-algebras $h\of \nno\ri Y\to (X,f)$, i.e. for every other morphism $k\of \nno\ri Z\to (X,f)$ there is a morphism $l\of Z\to Y$ such that $h\circ s\ri(l)=k$.

The dual notion for a coalgebra $X\to s\ri(X)$ is also called the transfinite composition of the coalgebra.
\end{definition}\hide{Every isomorphism-algebra is a constant family.}

\begin{lemma} Every cofibration has the left lifting property with respect to all acyclic fibrations. \label{Reedy}\end{lemma}

\begin{proof} By definition every cofibration is the transfinite composition of pushouts of coproducts of cycle inclusions.

Suppose $f\of X\to Y$ is a free cofibration and $S$ is the family of faces outside the image of $f$. For each $i\of\nno$ let $Y_i$ be the union of $X$ with all faces of $Y$ of dimension strictly smaller than $i$. In particular $Y_0=X$.

Every simplex of $Y$ is in $Y_i$ for some $i$. If a simplex $y\of\base Y$ is degenerate, then one can search the monomorphisms $[n]\to\dim y$ in $\simCat$ for the greatest $\mu$ such that $y\cdot\mu$ is a face. For this reason, the inclusion $Y_i\to\nno\ri Y$ is a transfinite composition.

For each $i\of\nno$ let $S_i$ be the object of $n$-dimensional faces in $S$. Each $s\of S_i$ induces a monomorphism $s'\of\simplex[i]\to Y_{i+1}$. Since $Y_{i}$ has all simplices of dimension $i-1$, the intersection of $Y_i$ and $s'$ is $\cycle[i]$. Thus the inclusion $Y_i\to Y_{i+1}$ is the push out of $S_{i+1}$ copies of $\cycle[i]\to\simplex[i]$. 

Cofibrations have the left lifting property by lemma \ref{saturation} below.
\end{proof}


\begin{lemma} The class of morphisms $L$ that has the left lifting property with respect to fibrations is closed under pushouts, coproducts indexed over arbitrary object of $\ambient$ and transfinite compositions. \label{saturation}
\end{lemma}

\begin{proof}
In each case the construction induces an operation on the split epimorphism in the diagram of the lifting property. 
In the case of the pushouts, the construction is a pullback, which preserves split epimorphisms.
Fibred exponentials also preserve split epimorphisms. Finally infinite compositions of split epimorphisms are split.
\end{proof}


\begin{proposition} Every morphism factors as an acyclic fibration following a cofibration. \label{factor1} \end{proposition}

\begin{proof} The construction is based on the fact that $\simCat$ is a \emph{Reedy category}. \hide{cite!} Let $\simCat^+$ be the full subcategory of monomorphisms and $\simCat^-$ that of epimorphisms. For each morphism $\phi$ of $\simCat$ let $m(\phi)$ be the monic and $e(\phi)$ the epic factors again.

The first step is to cover $Y$ with another simplicial set $LY$ where degeneracy is decidable.
Let $LY[n] = \Sigma i\of[n]. Y[i]\times\simCat^-(n,i)$ and for $\phi\of [m]\to [n]$ of $\simCat$ and $\tuplet{\epsilon,y}\of LY[n]$ let the following equation hold.
\[\tuplet{\epsilon,y}\cdot \phi=\tuplet{e(\epsilon\circ \phi),y\cdot m(\epsilon\circ\phi)}\]
Let $l_Y\of LY\to Y$ satisfy $l_Y\tuplet{\epsilon,y}=y\cdot\epsilon$.

The second step glues simplices of $X$ and $LY$ together into new ones. Define $d\of X+LY\to\nno$ as follows. %For $x\of X$, $d(x)=\dim(x)$, for $\tuplet{\epsilon,y}\of LY$, $d\tuplet{\epsilon,y} = \cod(\epsilon)$. 
The pair $(f,l_Y)$stand for the morphism $X+LY\to Y$ that satisfies $(f,l_Y)(x)=f(x)$ for $x\of X$ and $(f,l_Y)(y) = l_Y(y)$ for $y\of LY$. Let $Z[n]\subseteq \Pi i\in[n].(X[i]+LY[i])^{\simCat^+(i,n)}$ consist of elements $z$ which satisfy the following conditions for all $\alpha\of [j]\to [k]$ and $\beta\of [i]\to[j]$ in $\simCat^+$.
\begin{enumerate}
\item $(f,l_Y)(z(\alpha\circ\beta)) = (f,l_Y)(z(\alpha))\cdot\beta$;
\item if $z(\alpha)\of X$ then $z(\alpha\circ\beta)\of X$;
\item if $z(\alpha)=\tuplet{\epsilon,y}\of LY$ and $\epsilon\circ\beta$ is not monic, then $z(\alpha\circ\beta)\of LY$ and $z(\alpha\circ\beta)_0$ factors through $\epsilon\circ\beta$.
\end{enumerate}
For $\phi\of[m]\to [n]$, and $z\of Z[n]$, let $z\cdot\phi$ satisfy the following equation for all $\alpha$ of $\simCat^+$.
\[ (z\cdot\phi)(\alpha) = z(m(\phi\circ\alpha))\cdot e(\phi\circ \alpha) \]
By these definitions, $Z$ is a simplicial object.

There is a morphism $g\of X\to Z$ which satisfies $g(x)(\alpha) = x\cdot\alpha$. It is a cofibration because a simplex $z$ is nondegenerate and outside of the image of $g$ if and only if $z(\id_{[\dim(z)]}) = \tuplet{\id_{[\dim(z)]},y}$ for some simplex $y\of Y[\dim(z)]$. The definition of $LY$ ensures that ensures that elements with this property are nondegenerate while condition 3 ensures that if $z(\id)$ is degenerate, then so is all of $z$.

There is a morphism $h\of Z\to Y$ which satisfies $h(z) = (f,l_Y)(z(\id_{[\dim(z)]}))$. This is an acyclic fibration thanks to the following filler operator. Let $a\of \cycle[n]\to Z$ and $b\of \simplex[n]\to Y$ satisfy $h\circ a = b\circ k$ where $k\of\cycle[n]\to\simplex[n]$ is the cycle inclusion. Let $c\of \simplex[n]\to Z$ satisfy $c(\phi)(\mu) = \tuplet{\phi,b(\mu)}$ if $\phi$ is an epimorphism and $c(\phi)(\mu) = a(\phi)(\mu)$ otherwise. Now $c\circ k = a$ and $h\circ c = b$.
\end{proof}

\hide{ In acyclic cofibrations the codomain may have a distance function, that gives an upper bound to the number of compositions required to to reach it. I don't have time to work that out and check it right now.
}

The factorization in the proof above turns the implication in lemma \ref{Reedy} into an equivalence.

\begin{proposition} A morphism has the left lifting property with respect to all acyclic fibrations if and only if it is a cofibration. \label{cofibration characterization} \end{proposition}

\begin{proof} Lemma \ref{Reedy} shows the `if' direction. For `only if' factor $f\of X\to Y$ as in the proof of lemma \ref{factor1} to get a free cofibration $g\of X\to Z$ and an acyclic fibration $h\of Z\to Y$. Because $\id_Y\circ f = h\circ g$ there is a $k\of Y\to Z$ such that $h\circ k = \id_Y$ and $k\circ f = g$ by the global lifting property. 
\[
\xymatrix{
X\ar[d]_f \ar[r]^g & Z\ar[d]^h\\
Y\ar[r]_\id \ar[ur]^k & Y
}
\]
A simplex $y$ of $Y$ is a face outside of the image of $f$ if $k(y)$ is a face outside of the image of $h$, and since the latter is decidable, the former is too.\end{proof}

\section{Acyclic cofibrations}
This section does not have a factorization of arbitrary morphisms into fibrations and acyclic cofibrations. Instead it shows that there is a factorization system in the subcategory of fibrant objects, where acyclic cofibrations are a kind of homotopy equivalence.

\begin{definition} In the subcategory $\ambient\s\f$ of $\ambient\s$ a cofibration $f\of X\to Y$ is \emph{acyclic} if there is a $g\of Y\to X$ such that $g\circ f = \id_X$ and an $h\of \simplex[1]\times Y\to Y$ such that $h\circ k = (\id_Y,f\circ g)$ if $k\of 1+1\to\simplex[1]$ is the cycle inclusion and 
$h\circ (\id_{\simplex[1]}\times f) = f\circ\pi_1$.
\[\xymatrix{
Y+Y\ar[d]_{k\times \id} \ar[dr]^{(\id,f\circ g)}\\
\simplex[1]\times Y \ar[r]_(.6)h & Y\\
\simplex[1]\times X \ar[r]_(.6){\pi_1}\ar[u]^{\id\times f} & X\ar[u]_f\\
}\]\label{acyclic cofibration}
\end{definition}

\begin{theorem} Acyclic cofibrations and fibrations form a weak factorization system for $\ambient\s\f$. \end{theorem}

\begin{proof} Lemma \ref{acyclic have lifting} shows that acyclic cofibrations have the lifting property with respect to all fibrations. Lemma \ref{lifting is acyclic} shows the converse. Proposition \ref{factor2} shows that every morphism factors as a fibration following a cofibration. 
\end{proof}

The proposition and the lemmas in this proof rely on a special property of cycle and horn inclusions (lemma \ref{triple lift}) which the next section explains.

\subsection{Triple lifting property}

\begin{lemma} Let $f\of A\to B$ and $g\of C\to D$ be cofibrations and let $h\of X\to Y$ be a fibration. Let $a\of A\times D\to X$, $b\of B\times C\to X$ and $c\of B \times D\to Y$ satisfy $a\circ(\id_A\times g) = b\circ(f\times \id_C)$, $h\circ a=c\circ(f\times \id_D)$ and $h\circ b=c\circ(\id_B\times g)$. If one of $f$, $g$ or $h$ is acyclic, then there is a $d\of B\times D\to X$ such that $d\circ(f\times\id_D)=a$, $d\circ(\id_B\times g)=b$ and $h\circ d = c$.
\[\xy
(0,20)*+{A\times C}="AC",(25,20)*+{B\times C}="BC",(40,20)*+{X}="X",
(0,0)*+{A\times D}="AD",(25,0)*+{B\times D}="BD",(40,0)*+{Y}="Y"
\ar^{f\times\id} "AC";"BC"
\ar_{\id\times g} "AC";"AD"
\ar_{f\times\id} "AD";"BD"
\ar^{a} "AD";"X"
\ar|(.6){\id\times g} "BC";"BD"
\ar^(.6){b} "BC";"X"
\ar@{.>}_{d} "BD";"X"
\ar_(.6){c} "BD";"Y"
\ar^{h} "X";"Y"
\endxy\]
\label{triple lift}
\end{lemma}

\begin{proof} The general case reduces to the cases where $f$ and $g$ are cycle or horn inclusions, because the lemma is equivalent to the statement that the following maps are (acyclic) fibrations. 
\begin{align*}
\tuplet{f\to h}&=\tuplet{h^{\id_B},\id_X^f}\of X^B \to Y^B\times_{Y^A} X^A\\
\tuplet{g\to h}&=\tuplet{h^{\id_D},\id_X^g}\of X^D \to Y^D\times_{Y^C} X^C
\end{align*}
In the case where $h$ is an acyclic fibration the morphism $\tuplet{g\to h}$ is an acyclic cofibration if is has the lifting property for the family of cycle inclusions $k_i\of \cycle[i]\to\simplex[i]$ for $i\of\nno$, and in turn $\tuplet{k_n\to h}$ are acyclic cofibrations if the triple lifting property holds in the cases where $a=k_i$ and $b=k_j$ for all $i,j\of\nno$. For the cases where $f$ or $g$ are acyclic the same reduction takes us to products of cycle and horn inclusions.

In the cases where $f$ and $g$ are horn or cycle inclusions it is easy to prove that their pushout products $g\pp f$ are compositions of pushouts of sums of horns and cycles and therefore have the left lifting properties with respect to (acyclic) fibrations. 
\[\xy
(0,10)*+{W\times Y}="left",(20,10)*+{\bullet}="middle",(10,20)*+{X\times Y}="top",(10,0)*+{W\times Z}="bottom",(40,10)*+{X\times Z}="right"
\ar^(.4){f\times \id} "left";"top" \ar_{\id\times g} "left";"bottom" \ar "top";"middle" \ar "bottom";"middle"
\ar@{.>}|(.3){g\pp f} "middle";"right" \ar^{\id\times g} "top";"right" \ar_{f\times\id} "bottom";"right"
\endxy\]
Therefore the lemma holds for every pair of cofibrations $f$, $g$ as long as one of $f$, $g$ and $h$ is acyclic.
\end{proof}

\subsection{Factorization system}
\begin{lemma} Acyclic cofibrations have the left lifting property with respect to all fibrations. \label{acyclic have lifting}\end{lemma}

\begin{proof} Let $f\of X\to Y$ be an acyclic cofibration, with inverse $g\of Y\to X$ and homotopy $h\of\simplex[1]\times Y\to Y$. Let $k\of A\to B$ be a fibration and let $a\of X\to A$ and $b\of Y\to B$ satisfy $k\circ a=b\circ f$. The composition $a\circ g\of Y\to A$ is a filler up to homotopy, which can be transported along the homotopy $h$ to become a proper filler. Let $d_0$ be the first horn inclusion $1\to \simplex[1]$. By lemma \ref{triple lift}, there is a $d\of \simplex[1]\times Y\to A$ such that $k\circ c=b\circ h$, $c\circ (\id_{\simplex[1]}\times f)= a\circ \pi_1$ and $c\circ (d_0\times \id_Y) = a\circ g$.
Lemma \ref{triple lift} applies because the following equations hold.

\begin{align*} 
	(a\circ \pi_1)\circ (\simplex(\delta^1_1)\times\id_X) &= a = (a\circ g)\circ f\\
	(b\circ h)\circ (\simplex(\delta^1_1)\times\id_Y) &= b\circ f\circ g = k\circ (a\circ g)\\
	(b\circ h)\circ (\id_{\simplex[1]}\times f) &= b\circ f\circ \pi_1 = k\circ (a\circ \pi_1)
\end{align*}
\[\xymatrix{
X\ar[d]_f \ar[rr]^(.4){d_0\times \id} && \simplex[1]\times X \ar[d]|(.6){\id\times f}\ar[r]^(.6){a\circ \pi_1} & A\ar[d]^k\\
Y \ar[rr]_(.4){d_0\times \id}\ar[urrr]^(.3){a\circ g} && \simplex[1]\times Y\ar[r]_(.6){b\circ h}\ar@{.>}[ur]_c & B
}\]

Let $d_1$ be the other horn inclusion $1\to \simplex[1]$. Let $e=c\circ(d_1\times \id_Y)$, so $k\circ e=b\circ h\circ (d_1\times \id_Y) = b$ and $e\circ f = c\circ (\id_{\simplex[1]}\times f)\circ (d_1\times \id_X) = a$. Then $e$ is a filler for $b\circ f=k\circ a$. By generalization $f$ is an acyclic cofibration.
\end{proof}

\begin{lemma} In $\ambient\s\f$ every morphism that has the left lifting property with respect to all fibrations is an acyclic cofibration. \label{lifting is acyclic} \end{lemma}

\begin{proof} An acyclic fibration is a fibration, because the right lifting property for cycle inclusions induces the right lifting property for horn inclusion. Therefore lemma \ref{cofibration characterization} tells us that every acyclic cofibration is a cofibration.

Let $f\of X\to Y$ be a morphism with the left lifting property for all fibrations in $\ambient\s\f$. There is a morphism $g\of Y\to X$ such that $g\circ f = \id_X$ because $X$ is fibrant. 
\[ \xymatrix{
X\ar[d]_f \ar[r]^\id & X\ar[d]^\bang\\
Y\ar[r]_\bang \ar@{.>}[ur]_h & 1
}\]
There is a morphism $h\of \simplex[1]\times Y\to Y$ such that $h\circ k = (\id_Y,f\circ g)$ if $k\of 1+1\to\simplex[1]$ is the cycle inclusion and $h\circ (\id_{\simplex[1]}\times f) = f\circ\pi_1$ because $Y$ is fibrant and because of lemma \ref{triple lift}.
\[ \xymatrix{
X+X\ar[d]_{f+f}\ar[r]^{k\times\id} & \simplex[1]\times X \ar[r]^(.6){f\circ \pi_0}\ar[d] & Y\ar[d]^\bang\\
Y+Y\ar[r]_{k\times\id} \ar[urr]^(.3){(\id,g)} & \simplex[1]\times Y \ar[r]_\bang\ar@{.>}[ur]_h & 1
}\]
Therefore $f$ is an acyclic cofibration by definition \ref{acyclic cofibration}.
\end{proof}

\begin{proposition} Every morphism $f\of X\to Y$ between Kan complexes factors as a fibration following an acyclic cofibration. \label{factor2} \end{proposition}

\begin{proof} There is a simple factorization $f = p_0\circ r$ where $p_0\of Y/f\to Y$ and $r\of X\to Y/f$, where 
\begin{align*}
Y/f &= \set{(x,p)\of X\times Y^{\simplex[1]}| f(x) = p(*\mapsto 1) }\\
p_0\tuplet{x,p} &= p(*\mapsto 0)\\
r(x) &= \tuplet{x,*\mapsto f(x)}
\end{align*}

The morphism $r$ is not necessarily a cofibration, but factors as an acyclic fibration $g\of W\to Y/f$ following an cofibration $h\of X\to W$ by proposition \ref{factor1}. The morphism $h$ is an acyclic cofibration and the composition $p_0\circ g$ is a fibration for the following reasons.


%h is ac
There is a morphism $p_1\of Y/f\to X$ that satisfies $p_1\tuplet{x,p}=x$. Let $h'=p_1\circ h$, so $h'\circ h = \id_X$.
There is a homotopy $\phi$ between $\id_{W}$ and $h\circ h'$ by lemma \ref{triple lift} and the following equations. %introduce triple lift more gently
\begin{align*}
(\id_W,h\circ h')\circ(h+h)&=(h,h)= (h\circ\pi_1)\circ (c\times \id_X)\\
h'\circ h\circ \pi_1&=\pi_1=(h'\circ\pi_1)\circ(\id_{\simplex[1]}\times h)\\
h'\circ(\id_W,h\circ h')&=(h',h')= (h'\circ\pi_1)\circ (c\times \id_W)
\end{align*}
\[\xymatrix{
X+X\ar[d]_{c\times \id}\ar[r]^{h+h} & W+W\ar[d]_(.3){c\times \id}\ar[r]^(.6){(\id,h\circ h')} & W\ar[d]^{h'}\\
\simplex[1]\times X\ar[r]_{\id\times h} \ar[urr]^(.3){h\circ\pi_1}  & \simplex[1]\times W\ar[r]_(.6){h'\circ\pi_1} \ar@{.>}[ur]_\phi & X
}\]
Because $\phi\circ(\id_{\simplex[1]\times h}) = h\circ \pi_1$, the cofibration $h$ is acyclic by definition \ref{acyclic cofibration}. 

%p_0\circ g is fib
Since fibrations are closed under composition and since $g$ is an acyclic fibration, $p_0\circ g$ is a fibration if $p_0$ is. 

Let $d\of A\to B$ be an acyclic cofibration and let $a\of A\to Y/f$ and $b\of B\to Y$ satisfy $p_0\circ a = b\circ d$. There is a morphism $c_0\of B\to X$ such that $c_0\circ d = p_1\circ a$ because $X$ is fibrant. Let $e_0$ be one of the horn inclusions $1\to \simplex[1]$. There is a morphism $c_1\of\simplex[1]\times B\to Y$ such that $c_1\circ{(\id_{\simplex[1]}\times d)}$ is the transpose of $p_0\circ a$ and $c_0\circ (e_0\times \id_B) = f\circ c_1$ because $Y$ is fibrant and because of lemma \ref{triple lift}.
\[\xy
(0,20)*+{A}="AC",(25,20)*+{\simplex[1]\times A}="BC",(50,20)*+{Y}="Y",
(0,0)*+{B}="AD",(25,0)*+{\simplex[1]\times B}="BD",(50,0)*+{1}="one"
\ar^(.4){e_0\times\id} "AC";"BC"
\ar_{d} "AC";"AD"
\ar_(.4){e_0\times\id} "AD";"BD"
\ar^(.3){f\circ c_0} "AD";"Y"
\ar|(.3){\id\times d} "BC";"BD"
\ar^(.6){a^t} "BC";"Y"
\ar@{.>}_{c_1} "BD";"Y"
\ar_(.6){\bang} "BD";"one"
\ar^{\bang} "Y";"one"
\endxy\]
The transpose $c_1^t\of B\to Y^{\simplex[1]}$ of $c_1$ and $c_0$ together factor as a morphism $c\of B \to Y/f$ which is a filler for $p_0\circ a = b\circ d$. By generalization, $p_0$ is a fibration.
\end{proof}



\section{Model structure}
For a definition of model categories see [\cite{Hovey99, GJSHT}]. The simplicial homotopy of Kan complexes is valid in the internal ELCCC $\ambient$ in the following sense.%give the definition here

\begin{definition} In $\ambient\s\f$ a weak equivalence is a compositions of an acyclic fibration following an acyclic cofibration. \end{definition}

%maybe we need to ague that we+f = af and we+c=ac
%maybe that simplifies the proofs below

\begin{theorem}[Model category]
With fibrations, weak equivalences and cofibrations defined as above $\ambient\s\f$ is a model category.
\label{model category}
\end{theorem}

\begin{proof}
Lemma \ref{factor1} shows that cofibrations and acyclic fibrations form a weak factorization system, considering that they satisfy a lifting property by definition \ref{Kan}. Lemma \ref{factor2} tells the same thing about fibrations and acyclic cofibrations. Lemma \ref{toot} below demonstrates that if two of $f$, $g$ and $f\circ g$ are weak equivalences, then all three are. These three requirements define a model structure.
\end{proof}

\begin{lemma}[2-out-of-3] Let $f\of X\to Y$ and $g\of Y\to Z$ be morphisms of $\ambient\s\f$. If any two of $f,g$ or $g\circ f$ are weak equivalences, then all three are. \label{toot}\end{lemma}

\begin{proof} Weak equivalences are closed under composition by lemma \ref{composition of weak equivalences}.

Let $g$ and $g\circ f$ be arbitrary weak equivalences. The morphism $f$ factors as an acyclic fibration $h\of W\to Y$ following a cofibration $k\of X\to W$ by proposition \ref{factor2}. Because weak equivalences are closed under composition, $g\circ h$ is a weak equivalence. The morphism $k$ is acyclic for the following reasons. Factor both $g\circ f$ and $g\circ h$ as acyclic fibrations following acyclic cofibrations, so $g\circ f = a\circ b$ and $g\circ h = c\circ d$. The lifting properties induce a morphism $l$ such that $l\circ b = d\circ k$ and $c\circ l = a$. Lemma \ref{shared retract 2} says that $l$ is a weak equivalence because $a$ and $c$ are acyclic fibrations. 
Because of closure under composition, the morphism $l\circ b = d\circ k$ is both a weak equivalence and a cofibration and hence an acyclic cofibration. Since $d$ and $d\circ k$ are an acyclic cofibrations, so is $k$ by lemma \ref{left cancellation}.
\[\xymatrix{
X\ar[r]_k\ar@/^2ex/[rr]^f\ar[d]_b & W\ar[r]_h\ar[d]^d & Y\ar[d]^g \\
\bullet\ar@/_2ex/[rr]_a\ar@{.>}[r]^l & \bullet\ar[r]^c & Z
}\]
Since $f = h\circ k$, $f$ is a weak equivalence.

The case where $f$ and $g\circ f$ are weak equivalences is dual to the case above and the reasoning is the same. Acyclic cofibrations satisfy lemma \ref{shared retract} where acyclic fibrations satisfy lemma \ref{shared retract 2}. Acyclic fibrations satisfy lemma \ref{right cancellation} where acyclic cofibrations satisfy lemma \ref{left cancellation}.

This means that weak equivalences indeed satisfy 2-out-of-3.
\end{proof}

\begin{lemma} Weak equivalences are closed under composition. \label{composition of weak equivalences}\end{lemma}

\begin{proof} Compositions of acyclic fibrations are acyclic fibrations and the same holds for acyclic cofibrations. \hide{last part is no longer obvious}
All compositions of weak equivalences are weak equivalences if $g\circ f$ factors as an acyclic fibration following an acyclic cofibration, whenever $g$ is an acyclic cofibration and $f$ is an acyclic fibration.

%transport of acyclics
By proposition \ref{factor1} $g\circ f=h\circ k$ for some acyclic fibration $h\of W\to Z$ and a cofibration $k\of X\to W$. Let $g'$ be the left inverse of $g$. Since $f \circ \id = g'\circ g\circ f= (g'\circ h)\circ k$ there is a morphism $k'$ such that $f\circ k' = g'\circ h$ and $k'\circ k = \id$, so $k$ has its own left inverse.
\[\xymatrix{
X\ar[d]_f \ar[r]_{k} \ar@/^2ex/[rr]^{\id} & W\ar[d]^h \ar[r]_{k'} & X\ar[d]^f\\
Y \ar[r]^{g} \ar@/_2ex/[rr]_{\id} & Z \ar[r]^{g'} & Y
}\]

Let $\phi$ be a homotopy between $\id_Z$ and $g\circ g'$ such that $\phi\circ (\id\times g)=g\circ\pi_1$.

There is a homotopy $\chi$ between $\id_W$ and $k\circ k'$ because of lemma \ref{triple lift}.
\begin{align*}
(\id, k\circ k')\circ (k+k) &= (k,k) = k\circ \pi_1\circ(c\times\id_X)\\
h\circ (k \circ \pi_1) &= (\phi\circ (\id_W\times h))\circ (\id_{\simplex[1]} \times k)\\
h\circ (\id, k\circ k') &= (\phi\circ (\id_W\times h))\circ (c\times \id_W)
\end{align*}
\[\xymatrix{
X+X\ar[d]_{c\times \id}\ar[r]^{k+k} & W+W\ar[d]_(.3){c\times \id}\ar[r]^(.6){(\id,k\circ k')} & W\ar[d]^h\\
\simplex[1]\times X\ar[r]_{\id\times k} \ar[urr]^(.3){k\circ \pi_1}  & \simplex[1]\times W\ar[r]_(.6){\phi\circ (\id\times h)} \ar@{.>}[ur]_\chi & Z
}\]
Because the homotopy satisfies $\chi\circ(\id_{\simplex[1]}\times k) = k\circ \pi_1$, definition \ref{acyclic cofibration} makes $k$ an acyclic cofibration.

\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $g$ and $g\circ f$ are acyclic cofibrations, then $f$ is an acyclic cofibration \label{left cancellation} \end{lemma}

\begin{proof} Let $k\of A\to B$ be a fibration and let $a\of X\to A$ and $b\of Y\to B$ satisfy $k\circ a=b\circ f$. Because $B$ is fibrant, there is a $b'\of Z\to B$ such that $b'\circ g = b$. Lifting properties also imply that there is an $a'\of Z\to A$ such that $a'\circ g\circ f = a$ and $k\circ a'= b'$. So $b'\circ g$ is a filler for $k\circ a=b\circ f$. By abstraction, there is a filler operator that lifts $f$ against all fibrations, and that makes it n acyclic cofibration.
\[\xy
(0,28)*+{X}="x",(14\halfrootthree,21)*+{A}="a",(0,14)*+{Y}="y",(14\halfrootthree,7)*+{B}="b",(0,0)*+{Z}="z"
\ar^a "x";"a" \ar_f "x";"y" \ar^k "a";"b" \ar|(.33)b "y";"b" \ar_g "y";"z"
\ar@{.>}_{b'} "z";"b" \ar@{.>}|(.67){a'} "z";"a"
\endxy\]
\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $f$ and $g\circ f$ are acyclic cofibrations, then $g$ is an acyclic fibration. \label{right cancellation}\end{lemma}

\begin{proof} This is the dual of of lemma \ref{left cancellation} and dual reasoning gives $g$ the right lifting property for all cofibrations. That makes $g$ an acyclic fibration. \hide{Next assume that $f$ and $g\circ f$ are acyclic fibrations. Let $k\of\cycle[n]\to\simplex[n]$ be the cycle inclusion. Let $a\of\cycle[n]\to Y$ and $b\of\simplex[n]\to Y$ satisfy $b\circ k = g \circ a$. Because $\cycle[n]$ is cofibrant, there is an $a'\of \cycle[n]\to X$ such that $f\circ a' = a$ and hence $(g\circ f)\circ a' = b\circ c$. There is a filler $b'\of\simplex[n]\to X$ for this commutative square. The morphism $f\circ b'$ is a filler for the square $b\circ k = g \circ a$. This proves $g$ is an acyclic fibration.

\[\xy
(14\halfrootthree,28)*+{X}="x", (0,21)*+{\cycle[n]}="v", (14\halfrootthree,14)*+{Y}="y", (0,7)*+{\simplex[n]}="w", (14\halfrootthree,0)*+{Z}="z"
\ar@{.>}^{a'} "v";"x" \ar|(.67)a "v";"y" \ar_k "v";"w"
\ar@{.>}|(.33){b'} "w";"x" \ar_b "w";"z"
\ar "x";"y" \ar "y";"z"
\endxy\]}
\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $g$ and $g\circ f$ are acyclic fibrations, then $f$ is a weak equivalence.\label{shared retract 2} \end{lemma}

\begin{proof} By proposition \ref{factor1}, $f$ factors as an acyclic fibration $h\of W\to Y$ following a cofibration $k\of X\to W$. Because $(g\circ f)\circ \id = (g\circ h)\circ k$ and $g\circ f$ is an acyclic fibration, $k$ has a left inverse $k'\of X\to W$ which satisfies $g\circ f\circ k' = g\circ h$. 
\[\xymatrix{
X\ar[d]_k \ar[r]^\id & X\ar[d]^{g\circ f}\\
W\ar[r]_{g\circ h} \ar@{.>}[ur]^{k'} & Z
}\]

Let $c\of 1+1\to\simplex[1]$ be the same cycle as above. There is homotopy $\phi$ between $\id_W$ and $k\circ k'$ because of lemma \ref{triple lift} and the following equations.
\begin{align*}
(\id,k\circ k')\circ(k+k) &= (k,k) = (k\circ\pi_1)\circ (c\times\id_X)\\
(g\circ h)\circ (k\circ \pi_1) &= (g\circ h\circ \pi_1)\circ(\id\times k)\\
(g\circ h)\circ (\id,k\circ k') &= (g\circ h\circ \pi_1)\circ(c\times\id_W)
\end{align*}
\[\xymatrix{
X+X \ar[d]_{c\times \id}\ar[r]^{k+k} & W+W\ar[d]_(.3){c\times\id}\ar[r]^(.6){(\id,k\circ k')} & W\ar[d]^{g\circ h}\\
\simplex[1]\times X \ar[r]_{\id\times k}\ar[urr]^(.3){k\circ\pi_1}& \simplex[1]\times W\ar[r]_{g\circ h\circ \pi_1}\ar@{.>}[ur]_\phi & Z
}\]
Because $\phi\circ (\id_{\simplex[1]}\times k)=k\circ \pi_1$, definition \ref{acyclic cofibration} says that $k$ is an acyclic cofibration. Therefore $f$ is a weak equivalence.\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $f$ and $g\circ f$ are acyclic cofibrations, then $g$ is a weak equivalence.\label{shared retract} \end{lemma}

\begin{proof} \hide{The morphism $g$ factors as a fibration $h\of W\to Z$ following an acyclic cofibration $k\of Y\to W$ by lemma \ref{factor2}. Lifting properties give $h$ a right inverse $h'$.
\[\xymatrix{
X\ar[r]^{k\circ f}\ar[d]_{g\circ f} & W\ar[d]^h\\
Z\ar[r]_\id \ar[ur]^{h'} & Z
}\]
Lemma \ref{triple lift} provides a homotopy $\phi$ between $\id_W$ and $h'\circ h$, because the following equations hold.
\begin{align*}
(\id,h'\circ h)\circ(k\circ f+k\circ f)&= (k\circ f,k\circ f) = (k\circ f\circ \pi_1)\circ(c\times \id_Y)\\
h\circ(k\circ f\circ\pi_1) &= g\circ f\circ\pi_1 = (h\circ\pi_1)\circ(\id_{\simplex[1]}\times (k\circ f))\\
h\circ(\id_W,h'\circ h) &= (h,h) = (h\circ\pi_1)\circ(c\times\id_W)
\end{align*}

\[\xymatrix{
X+X\ar[r]^{k\circ f+k\circ f}\ar[d]_{c\times \id} & W+W\ar[r]^(.6){(\id,h'\circ h)}\ar[d]_(.3){c\times\id} & W\ar[d]^h\\
\simplex[1]\times X\ar[r]_{\id\times (k\circ f)}\ar[urr]^(.3){k\circ f\circ\pi_1} & \simplex[1]\times W\ar[r]_(.6){h\circ \pi_1}\ar@{.>}[ur]_{\phi} & Y
}\]}

This lemma is dual to lemma \ref{shared retract 2}. The morphism $g$ factors as a fibration $h\of W\to Z$ following an acyclic cofibration $k\of Y\to W$ by lemma \ref{factor2}. The dual of the proof of lemma \ref{shared retract 2} doesn't show that $h$ is an acyclic fibration directly, but it does show that $h$ has a right inverse $h'\of Z\to W$ and that there is a homotopy $\phi\of\simplex[1]\times W\to W$ between $\id_W$ and $h'\circ h$.

Let $a\of I\to J$ be an arbitrary cofibration and let $i\of I\to W$ and $j\of J\to Z$ satisfy $j\circ a=h\circ i$. Lemma \ref{triple lift} deforms $h'\circ j$ into a filler. Let $c_i$ be the morphisms $1\to \simplex[0]$.
\begin{align*}
\phi\circ(\id\times i)\circ (c_1\times \id) &= h'\circ h\circ i = h'\circ j\circ a \\
h\circ h' \circ j &= j = j\circ \pi_1\circ(c_1\times\id) \\
j\circ \pi_1\circ (\id\times a) &= j\circ a\circ \pi_1 = h\circ i \circ \pi_1\\
h\circ \phi\circ(\id\times i) &= h \circ \pi_1 \circ (\id\times i) = h\circ i \circ \pi_1
\end{align*}

\[\xymatrix{
I\ar[r]^{a}\ar[d]_{c_1\times \id} & J\ar[r]^(.6){h'\circ j}\ar[d]_(.3){c_1\times\id} & W\ar[d]^h\\
\simplex[1]\times I\ar[r]_{\id\times a}\ar[urr]^(.3){\phi\circ(\id\times i)} & \simplex[1]\times J\ar[r]_(.6){j\circ \pi_1}\ar@{.>}[ur]_{\psi} & Z
}\]
The filler is $\psi\circ c_0$. By generalization, $h$ is an acyclic fibration and $f$ is a weak equivalence.
\end{proof}



\subfile{cshdescent}

\section{Closing}

\subsection*{Acknowledgments} 
I am grateful to the Warsaw Center of Mathematics and Computer Science for the opportunity to write this paper. I am also grateful for discussions with Marek Zawadowski and the seminars on simplicial homotopy theory he organized during my stay at Warsaw University. Richard Garner, Peter LeFanu Lumsdaine and Thomas Streicher made invaluable comments on early drafts of this paper.



\printbibliography

\end{document}

