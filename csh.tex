% LaTeX 2e document, TAC style, 36 pp, Xy-pic ver ?, MikTeX version ?

\documentclass{tac}
\usepackage{subfiles}
\usepackage{amssymb, amsmath}
\usepackage[backend=bibtex,citestyle=authoryear-icomp]{biblatex}
\usepackage[all]{xy}
%\usepackage{cite}
\usepackage{url}
%\usepackage{graphicx}

%\renewcommand*\ttdefault{pcr}

\title{Weakly Predicative Simplicial Homotopy}
\author{Wouter Pieter Stekelenburg}\copyrightyear{2015}
\address{Faculty of Mathematics, Informatics and Mechanics\\
University of Warsaw\\
Banacha 2\\
02-097 Warszawa\\
Poland}
\eaddress{w.p.stekelenburg@gmail.com}
\keywords{realizability, simplicial homotopy, Kan complexes}
\amsclass{03D80, 18G30, 18G55}

\newcommand\hide[1]{}
\newcommand\cat\mathcal
\newcommand\set[1]{\left\{#1\right\}}
\mathrmdef{id}
\mathrmdef{dom}
\mathrmdef{cod}
\newcommand\ri{^*}
\newcommand\N{\mathbb N}
\mathbfdef[nno]{N}
\newcommand\dual{^{\mathrm{op}}}
\newcommand\disc{_{\mathrm{disc}}}
\mathbfdef[simCat]\Delta
\newcommand\s{^{\simCat\dual}}
\mathbfdef[pow]{P}
\mathssbxdef{Asm}
\newcommand\bang{!}
\newcommand\of{:}
\newcommand\simplex\Delta
\newcommand\cycle{\partial\Delta}
\newcommand\horn\Lambda
\newcommand\f{_f}
\newcommand\db[1]{{[\![}#1{]\!]}}
\newcommand\gen\gamma
\newcommand\dsum{\Sigma_}
\newcommand\dprod{\Pi_}
\newcommand\tuplet[1]{\left\langle #1 \right\rangle}
\newcommand\true{\mathtt{true}}
\newcommand\false{\mathtt{false}}
\newcommand\bool{\mathtt{bool}}
\newcommand\ttif{\mathtt{if}}
\mathssbxdef{cof}
\mathrmdef{nat}
\mathssbxdef{Ar}
\mathssbxdef{Ob}
\mathssbxdef{Core}
\mathssbxdef[LDMC]{II}
\newcommand\pe[1]{^{\diamond #1}}
\newcommand\pp{\mathbin\diamond}
\newcommand\norm[1]{\Vert #1 \Vert}
\newcommand\ka\kappa
\newcommand\la\lambda
\newcommand\depprod{\Pi_}
\newcommand\depsum{\Sigma_}
\mathrmdef{face}
\mathrmdef{colim}
\newcommand\U{U}
\newcommand\A{M}
\newcommand\W{W}
\newcommand\di{_*}
\mathrmdef{hcg}
\newcommand\ex{_{\textrm{ex}}}
\newcommand\citep[1]{[\cite{#1}]}
\mathrmdef{dim}
\newcommand\base{\mathbf{U}}
\mathssbxdef{Func}
\mathssbxdef[igen]{gen}
\newcommand\ambient{\mathfrak A}

\newcommand\keyword[1]{\emph{#1}\label{#1}}


\addbibresource{realizability}

\begin{document}

\begin{abstract} The paper show how to develop simplicial homotopy inside realizability categories like the category of assemblies, where the small object argument and minimal fibrations are unavailable. This way simplicial assemblies are a suitable model for homotopy type theory.\end{abstract}

\hide{
Three papers:
-simplicial homotopy
-complete categories [how they are preserved]
-the realizability model of HOTT [how to get  fibrant object out of a category]

Idee: reverse the order. definitions--theorem--lemmas. That way the purpose of the lemmas is set up from the start.
}

\hide{
2 dimensional case: 
* cofibration has decidable inclusion+decidability of degeneracy in the complement
* fibration has lifting operator
* weak equivalence is (probably) homotopy equivalence.
}

\maketitle

\hide{
Thorough investigation of the background. If we have an ELCCC then the poset-reflection is a Heyting algebra. The reindexing morphisms between the poset reflections are Heyting algebra morphisms and its adjoints remain adjoints.

}

\section{Introduction}
This paper grew out of an attempt to build a \emph{recursive realizability} model for \emph{homotopy type theory}. The intention is to interpret types as the homotopy types of the simplicial objects in the \emph{category of assemblies}. What makes this challenging, is that this category lacks some of the structure of the category of sets that \emph{classical homotopy theory} is build on. In the internal logic the principle of the excluded middle and the axiom of choice are false. The category of assemblies is not exact and lacks infinite limits and colimits. While there are \emph{generic monomorphisms}, they are not subobject classifiers. I deal with these issues in the following ways.
\begin{enumerate}
\item I look at simplicial objects of suitable internal categories. The advantage is that a realizer for being a simplicial object is available for any construction we need to make in the proofs.
\item I limit the class of cofibrations. In classical simplicial homotopy theory every monomorphism is a cofibration. In this paper's version, we demand that certain properties of the monomorphism are decidable.
\item The class of fibration also changes. Fibration come equipped with a \emph{fill operator} that realizes.
\item I build the homotopy category out of the fibrant objects only. The small object argument that supplies fibrant replacements in classical homotopy requires infinite colimits that are unavailable.
\end{enumerate}
Out of interest in using the constructions in other contexts than the category of assemblies, this paper works with a generic \emph{extensive locally Cartesian closed category} with a \emph{natural number object} instead of the category of assemblies itself.

\subsection{Related literature}
Simplicial homotopy is the homotopy of simplicial sets. It is equivalent to the homotopy of CW complexes which are a category of topological spaces \citep{Hovey99,GJSHT}.

\section{Preliminaries}
This section surveys the categorical logic required to understand the rest of this paper.

\subsection{Set up}
The ambient category $\ambient$ where everything happens is a \emph{$\Pi$-pretopos}. $\Pi$-pretoposes are Heyting categories. Hence they have a first order intuitionist internal logic.

The intended model is the ex/lex completion of category of assemblies defined in \citep{MR1097022,MR1023803,MR2479466}. This completion is not the famous \emph{effective topos}, but it is another realizability topos. Here we avoid the higher order aspects by sticking to the usual exactness properties.

\begin{enumerate}
\item The category $\ambient$ is \emph{locally Cartesian closed}. This means that for each object $X$ of $\ambient$ each slice $\ambient/X$ is Cartesian closed.
\item The category $\ambient$ is \emph{extensive}, which means that is has finite coproducts and that $\ambient/(X+Y)$ is equivalent to $(\ambient/X)\times(\ambient/Y)$ for each pair of objects $X$ and $Y$ of $\ambient$.
\item The category $\ambient$ is exact in the sense of Bar.
\item The category $\ambient$ is has a \emph{natural number object} $\nno$.
\end{enumerate}

\subsection{Notation} The codomain, domain and identity operators are called $\cod$, $\dom$ and $\id$ and $[n]$ refers to the initial segment of the natural number object. When not talking about numbers, $0$, $1$, $+$ and $\times$ refer to initial and terminal objects and binary coproduct and product operators. The unique map to the terminal object is $\bang$ and projection maps from products to factors are $\pi_i$ for $i\in \N$.

Every object $I$ of the $\ambient$ has an internal discrete category $I\disc$. For this category $\Ob(I\disc)=\Ar(I\disc)=I$ and $\cod=\dom=\id=\id(I)$.

The \emph{set} of natural numbers is $\N$, and since it is a set, $i\in \N$ indicates membership. The natural number object of $\ambient$ is $\nno$, and $i\of\nno$ means that $i$ is a morphism whose codomain is $\nno$.

Let $\cat C$ be an internal category. Its object of objects is $\Ob(\cat C)$ and its object of arrows is $\Ar(\cat C)$, so in this case $\cod$ and $\dom$ are morphisms $\Ar(\cat C)\to\Ob(\cat C)$ and $\id\of\Ob(\cat C)\to\Ar(\cat C)$. Let $\cat D$ be another internal category. The internal category of functors $\cat C\to\cat D$ is $\Func(\cat C,\cat D)$ or $\cat D^{\cat C}$.

\subsection{Dependent types}
Dependent type theory describe the constructions of objects and morphisms that are available in a locally Cartesian closed category.

The atomic sentences of a type theory are type assignments $t\of T$ and equations $t=u$. Types are interpreted as objects of a category $\cat C$, while terms are interpreted as global sections. A proposition $t\of T$ is valid if the interpretation $\db t$ of $t$ is a global section of the interpretation $\db T$ of $T$ in $\cat C$. A proposition $t=u\of T$ is valid if $\db u=\db t$. 

The rules explain the interpretation of closed types and terms. This interpretation extend to dependent types an terms--i.e.\ types and terms that contain free variables--in the following manner. For each type $T_0$ a type $T_1$ that depends on $T_0$ is interpreted as an object of $\cat C/\db{T_0}$. A term $t_1\of T_1$ that depends on $T_0$ is a section of $\db{T_1}$. A further type $T_2$ that depends on both $T_0$ and $T_1$ is interpreted as an object $\db{T_2}\of(\cat C/\db{T_0})/\db{T_1}$ and a term $t_2\of T_2$ as a global section.
\hide{\[\xymatrix{
& \bullet\ar[dl]^{\db{T_2}}\ar[d]\\ 
\bullet\ar[r]_{\db{T_1}}\ar@/^/[ur]^{\db{t_2}} & \db{T_0}
}\]}
\[\xy
(0,12)*+{\bullet} = "top left",(24,12)*+{\bullet} = "top right",(12,0)*+{\db{T_0}} = "bottom"
\ar "top right";"bottom" \ar_{\db{T_1}} "top left";"bottom" 
\ar@/^/@{->}^{\db{T_2}} "top right";"top left"
\ar@/^/@{->}^{\db{t_2}} "top left";"top right"
\endxy\]
So types and terms dependent on $T_0$ and $T_1$ are interpreted as the objects and global sections of the double slice category $(\cat C/\db{T_0})/\db{T_1}$.

We deal with higher numbers of free variables by repetition. A context $\Gamma$ is a list $x_0\of T_0,x_1\of T_1,x_2\of T_2,\dots$ of type assignment to variables in which each type depends on the ones before it. The types that depend on the context are objects of the repeated slice category $\cat C/\db{T_0}/\db{T_1}/\db{T_2}/\dotsm$ and the terms are interpreted as its objects. 

The purpose of the variables is to clarify the dependencies. There are functors $\db T\ri\of\cat C\to \cat C/\db T$ which sends each object $X$ to the projection $\pi_0\of(\db T\times X)\to \db T$. By default the context dependent interpretation $\db{x\of T\vdash U}$ of a type $U$ equal $\db T\ri(\db U)$ (and assume that $\db U$ is an object of $\cat C$) unless $U$ explicitly depends on $T$. The same convention applies to terms.

\subsection{Dependent sums and products}
This subsection discusses two constructions of types that this paper uses regularly.

%dependent sums

For each object $X$, $\dsum X\of\cat C/X\to \cat C$ is the functor that sends each morphism $f\of Y\to X$ to its domain $Y$.

Dependent sum type look like $\Sigma x\of T.U$. The elements are pairs $\tuplet{x,y}$ such that $x\of T$ and $y\of U$. For arbitrary terms $t\of(\Sigma x\of T)$, $\pi_0(t)$ and $\pi_1(t)$ represent two values in the tuple $t$. The context dependent interpretation satisfies:
\[ \db{\Gamma\vdash\Sigma x\of T.U} = \dsum {\db T}(\db{\Gamma,x\of T\vdash U}) \]
The unit and counit induces a families of morphisms between the following families of objects.
\begin{align*}
\db{\Gamma\vdash t\of T}\times\db{\Gamma\vdash u\of U[t/x]} &\to \db{\Gamma\vdash \tuplet{t, u}\of(\Sigma x\of T.U)}\\
\db{\Gamma\vdash t\of (\Sigma x\of T.V)}&\to \db{\Gamma\vdash \pi_1(t) \of V}
\end{align*}
Here $u[t/x]$ is the result of replacing every free occurrence of $x$ in $u$ with $t$; the type $V$ cannot contain $x$ as a free variable. Unit and co-units satisfy equations that ensure that $\pi_0\tuplet{t,u}=t$ and $\pi_1\tuplet{t,u}=u$ are valid for all terms $t$ and $u$.

Let $\cat C$ be finitely complete and Cartesian closed. The functor $\dprod X\of\cat C/X\to \cat C$ sends each morphism $f\of Y\to X$ is the object $\set{g\of X\to Y| f\circ g = \id_X }$ of sections of $f$. It is the right adjoint of $X\ri$.

Product types look like $\Pi x\of T.U$. The elements are $\lambda$-terms $\lambda x\of T.u$, such that $u[t/x]\of U[t/x]$ whenever $t\of T$. A $\lambda$-term $\lambda x\of T.u$ and a term $t\of T$ have an \emph{application} $(\lambda x\of T.u)(t)$. The context dependent interpretation satisfies:
\[ \db{\Gamma\vdash\Pi x\of T.U} = \dprod {\db T}(\db{\Gamma,x\of T\vdash U}) \]
The unit and the counit induce the following families of morphism:
\begin{align*}
\db{\Gamma\vdash t\of T}\times\db{\Gamma\vdash u\of(\Pi y\of T.U)}&\to\db{\Gamma\vdash u(t)\of U[u/y]}\\
\db{\Gamma\vdash u\of V}&\to\db{\Gamma\vdash (\lambda x\of T.u)\of(\Pi x\of T.V)}
\end{align*}
Here $V$ cannot depend on $x$. Unit and co-units satisfy equations that ensure that $(\lambda x\of T.u)(t) = u[t/x]$ and $(\lambda x\of T.u(x))=u$.

Extensiveness means that $\cat C$ has coproducts, that $\cat C/0$ is equivalent to the terminal category and that $\cat C/(X+Y)\cong (\cat C/X)\times(\cat C/Y)$. In the presence of dependent coproducts, a type $\bool$ that stands for the object $1+1$ and a way to introduce types and terms that dependent on $\bool$ suffice to add all binary coproducts.
\[ \db{\Gamma\vdash t\of T}\times\db{\Gamma\vdash u\of U}\to\db{\Gamma,b\of\bool\vdash \ttif(b,t,u)\of\ttif(b,T,U)} \]
The constants $\true$ and $\false$ denote the two global section of $1+1$. The function $\ttif$ is interpreted to satisfy the following equations.
\[ \ttif(\true,t,u)=t\qquad\ttif(\false,t,u) = u\]


\section{Internal simplicial homotopy}
This section develops the homotopy theory of Kan complexes internally in $\ambient$.

\begin{proposition} Every $\Pi$-pretopos with natural number object has an internal category of simplices.\end{proposition}

\begin{proof} A natural number object allows the definition of predicates by recursion, so the order relation of $\nno$ is a recursive function $\mathord\leq\of\nno\times \nno \to \bool$. This is all we need to define the internal category of simplices.
\begin{align*}
[n] &= \set{x\of\nno\middle| x\leq n}\\
\simCat([m],[n]) &= \set{f\of[m]\to[n]\middle|\forall x,y\of [m].x\leq y\to f(x)\leq f(y)}
\end{align*}
Universal quantification over $[m]$ reduces to a finite conjunction because $[m]$ is a finite object, which is why it is allowed above. 
\end{proof}

\subsection{Internal simplicial objects}%under consideration as replacement for internal categories.
As a replacement for the usual simplicial sets, we use the following structure in $\ambient$. These are essentially discrete opfibrations over $\simCat$.

\begin{definition} An \emph{internal simplicial object} $X=(\base X,\dim,\cdot)$ is an object $\base X$ together with a morphism $\dim\of \base X\to\nno$ and an operator $\cdot$, whose domain is the following object.
\[ \set{\tuplet{x,\xi}\of \base X\times\Ar(\simCat)\middle| \dim (x)=\dom(\xi)} \]
The codomain of $\cdot$ is $\base X$. The operator $\cdot$ satisfies $(x\cdot\alpha)\cdot\beta=x\cdot(\alpha\circ\beta)$ and $x\cdot\id_{[\dim x]}=x$.  

A morphism of internal simplicial objects $X\to Y$ is a morphism $\base X\to \base Y$ that commutes with $\dim$ and $\cdot$. I.e. $f(x\cdot \xi)=f(x)\cdot\xi$ and $\dim(f(x))=\dim(x)$.

The category of internal simplicial objects and morphisms of $\ambient$ is $\ambient\s$. For each object $I$ of $\ambient$, $(\ambient/I)\s$ is the internal category if simplicial objects of $\ambient/I$.
\end{definition}\hide{ Is it feasible to rewrite the whole paper with these?}

In a simplicial object $X$, $\base X$ is the object of simplices, $\dim$ is the dimension of each simplex. The operator $\cdot$ records how simplices of different dimensions fit together. 

\begin{remark} When $\ambient$ has infinite colimits, any functor $\simCat\dual\to\ambient$ induces an internal simplicial object. The intended model does not have infinite colimits, however. The internal simplicial objects are a strict subcategory of the external ones in that case. That is also what gives this approach an advantage over earlier ones in the literature.%cite
\end{remark}

\hide{
\subsection{Families}
\begin{defin}
For each object $I$ of $\ambient$ the category $\ambient/I\s$ of simplicial objects in the slice $\ambient/I$ is an \emph{$I$-indexed families of simplicial objects}. 
\end{defin}

Is there anything to prove here?

Other thought: maybe treat the equivalence of $\ambient\s/J$ with $\ambient^{EJ}\s$ here, with $EJ$ the category of elements of the simplicial set $J$.

}

\subsection{Filler operators} %may need a new name
Kan fibrations are morphisms of simplicial sets that have the lifting property relative to the family of horn inclusions. This subsection focuses on the lifting properties.

\begin{definition} For each pair of internal simplicial objects $X$, $Y$ let $\nat(X,Y)$ be the object of morphisms between them.

A morphism $f\of X\to Y$ of simplicial object has the \emph{right lifting property} with respect to a morphism $g\of I\to J$--and $g$ has the \emph{left} lifting property with respect to $f$--if the morphism $\tuplet{f_!,g\ri} = \tuplet{\nat(\id_J,f),\nat(g,\id_X))}$ 
which is the factorization of the span $\nat(\id_J,f)$, $\nat(g,\id_X)$ through the pullback cone of $\nat(\id_I,f)$ and $\nat(g,\id_Y)$
is a \emph{split} epimorphism.
\[\xy
(34,20)*+{\nat(I,X)}="top",(0,10)*+{\nat(J,X)}="left",(24,10)*+{\bullet}="middle",(44,10)*+{\nat(I,Y)}="right",(34,0)*+{\nat(J,Y)}="bottom"
\ar^{\nat(g,\id_X)} "left";"top" \ar@{.>}|(.6){\tuplet{f_!,g\ri}} "left";"middle" \ar_{\nat(\id_J,f)} "left";"bottom" \ar "middle";"bottom"
\ar "middle";"top" \ar^(.6){\nat(\id_I,f)} "top";"right" \ar_(.6){\nat(g,\id_Y)} "bottom";"right"
\endxy\]
A section of $\tuplet{f_\bang,g\ri}$ is a \emph{filler operator}.\label{lifting}
\end{definition}

A morphism can have a lifting property relative to a family or class of morphisms.

\hide{
Explain $I\ri\of\ambient\s\to (\ambient\s)^{I\disc}$ somewhere. It should be an internal simplicial object of the slice category. i.e. $(\ambient/I)\s$. 
}
\begin{definition}[Injective] An $I$-indexed-family of morphisms in $\ambient\s$ a morphism $a\of D\to E$ in $(\ambient\s)^{I\disc}$. Let $I\ri\of\ambient\s\to (\ambient\s)^{I\disc}$ be the diagonal functor. A morphism $f\of X\to Y$ is \emph{$a$-injective} if $I\ri f$ has the right lifting property with respect to $a$.
\end{definition}


\section{Cofibrations}%class functors not mentioned in the sections below--"characteristic functors"

\begin{definition} An \emph{internal factorization system} on a category consists of two classes of morphisms $L$ and $R$, with the properties that a morphism $l$ belongs to $L$ if an only if it has the left lifting property with respect all to members of $R$, $R$ has the dual property, and such that every morphism factors as a member of $R$ following a member of $L$.\end{definition}

This section defines \emph{(acyclic) fibrations} and \emph{cofibrations} and shows that they form an \emph{internal factorization system} on $\ambient\s$.

\subsection{fibrations}
\hide{ 

Idea: define Kan fibrations, define cofibrations, demonstrate the lifting properties. Move on happily.

New idea: go by factorization system.

1. The lifting properties of cofibrations
2. Factorization property

}
Both fibrations and acyclic fibrations are defined the same way: they have the right lifting property with respect to a specific family of morphisms.

\hide{ Add def. of sieve over $\simCat$
Wrong: I was calling it a sieve because I was thinking of the category of elements of $\simplex[n]$
$\ambient\s$ defined?
Member functions for internal simplicial objects?
 }
\begin{definition} For each $n\in\N$, the $n$-simplex $\simplex[n]$ is the internal simplicial set where $\base{\simplex[n]}$ is the object of all morphisms $\phi$ in $\simCat$ such that $\cod(\phi) = n$, $\dim(\phi) = \dom(\phi)$ and $\phi\cdot \xi = \phi\circ \xi$.

The \emph{cycle} $\cycle[n]$ is the subobject of non surjective functions of $\simplex[n]$. The $\dim$ and $\cdot$ are the same, and the bases are related as follows:
\[ \base{\cycle[n]} = \set{\phi\of\base{\simplex[n]}| \exists i\of[n].\forall j\of \dom(\phi).\phi(i)\neq j } \]

Similarly, for each $k\of[n]$ the \emph{horn} $\horn_k[n]$ is the sieve of the non decreasing maps $[m]\to [n]$ that are not onto the set $[n]-\set{k}$.
\[ \base{\horn_k[n]} = \set{\phi\of\base{\simplex[n]}| \exists i\of[n]-\set k.\forall j\of \dom(\phi).\phi(i)\neq j } \]

\end{definition}

These subobjects are definable in the internal language of $\ambient$ because being surjective is a decidable property of morphisms $[m]\to[n]$.

\begin{definition} Cycles and horns form families of morphisms indexed over $\nno$ and over $\set{(n,k)\in\nno\times\nno| k\leq n }$ respectively.
\begin{itemize}
\item A \emph{Kan fibration} is an injective morphism relative to the family of all horn inclusions.
\item An \emph{acyclic Kan fibration} is an injective morphism relative to the family of cycle inclusions.
\item A \emph{Kan complex} or \emph{Kan fibrant object} is a simplicial object $X$ for which the unique morphism $\bang_X\of X\to 1$ is a fibration.
\item A \emph{Kan complex} $X$ is \emph{contractible} if $\bang_X\of X\to 1$ is acyclic.
\end{itemize}\label{Kan}

The category of Kan complexes and morphisms of simplicial object is $\ambient\s\f$.
\end{definition}
This paper usually leaves out `Kan' and simply talk about fibrations and complexes.

\subsection{Cofibrations}
This subsection proves that morphisms in $\ambient\s$ factor as acyclic fibrations following cofibrations. 

\begin{definition} A $y\of Y[n]$ is called an \emph{$n$-simplex} of $Y$. An $n$-simplex is \emph{degenerate} if there is an $s\of [n]\to [n]$ different from $\id_{[n]}$ such that $Y(s)(y)=y$. If there are no such $s$ and $x$, then $y$ is \emph{nondegenerate}. A nondegenerate simplex is called a \emph{face}. 

A subobject $W\of X$ is decidable, if there is a morphism $X\to\bool$ such that $W$ is the pullback of one of the morphisms $1\to\bool$. A monomorphism $f\of X\to Y$ is a \emph{cofibration} if the subobject $S$ of all faces outside of the image of $f$ is decidable. \label{cofibration}
\end{definition}

\begin{lemma} Acyclic fibrations and cofibrations form a weak factorizations system.
\end{lemma}

\begin{proof} Proposition \ref{factor1} shows that every morphisms factors as an acyclic fibration following a cofibration. Lemma \ref{Reedy} shows that cofibrations have the required lifting property. Finally, proposition \ref{cofibration characterization} shows that every morphisms that has the right lifting property with respect to every cofibration.
\end{proof}


\subsubsection{Lifting}
The class of morphisms that has the right lifting property with respect to all fibrations, is closed under various constructions, notably compositions, finitary coproducts and pushouts. They are also closed under transfinite compositions of cochains \hide{lemma...}, which are defined as follows.

\begin{definition} The successor morphism $s\of\nno\to\nno$ induces an endofunctor $s\ri$ of $\ambient/\nno$. A \emph{chain} is a morphism a morphism $f\of s\ri(X)\to X$ in $\ambient/\nno$.  A morphism of chains $(X,f)\to(Y,g)$ is a morphism $h\of X\to Y$ such that $h\circ f = g\circ s\ri(h)$.

Dually, a morphism $f\of X\to s\ri(X)$ is a \emph{cochain} and a \emph{cochain morphism} commutes with cochains in the dual way.

For every object $Y$ of $\ambient$ there is a constant family $\nno\ri(Y)$ and for these constant families $s\ri(Y)\simeq Y$. The isomorphism turn constant families into trivial algebras. The \emph{transfinite composition} is a universal morphism of $s\ri$-algebras $h\of \nno\ri Y\to (X,f)$, i.e. for every other morphism $k\of \nno\ri Z\to (X,f)$ there is a morphism $l\of Z\to Y$ such that $h\circ s\ri(l)=k$.

The dual notion for a coalgebra $X\to s\ri(X)$ is also called the transfinite composition of the coalgebra.
\end{definition}\hide{Every isomorphism-algebra is a constant family.}

\begin{lemma} Every cofibration has the left lifting property with respect to all acyclic fibrations. \label{Reedy}\end{lemma}

\begin{proof} By definition every cofibration is the transfinite composition of pushouts of coproducts of cycle inclusions.

Suppose $f\of X\to Y$ is a free cofibration and $S$ is the family of faces outside the image of $f$. For each $i\of\nno$ let $Y_i$ be the union of $X$ with all faces of $Y$ of dimension strictly smaller than $i$. In particular $Y_0=X$.

Every simplex of $Y$ is in $Y_i$ for some $i$. If a simplex $y\of\base Y$ is degenerate, then one can search the monomorphisms $[n]\to\dim y$ in $\simCat$ for the greatest $\mu$ such that $y\cdot\mu$ is a face. For this reason, the inclusion $Y_i\to\nno\ri Y$ is a transfinite composition.

For each $i\of\nno$ let $S_i$ be the object of $n$-dimensional faces in $S$. Each $s\of S_i$ induces a monomorphism $s'\of\simplex[i]\to Y_{i+1}$. Since $Y_{i}$ has all simplices of dimension $i-1$, the intersection of $Y_i$ and $s'$ is $\cycle[i]$. Thus the inclusion $Y_i\to Y_{i+1}$ is the push out of $S_{i+1}$ copies of $\cycle[i]\to\simplex[i]$. 

Cofibrations have the left lifting property by lemma \ref{saturation} below.
\end{proof}


\begin{lemma} The class of morphisms $L$ that has the left lifting property with respect to fibrations is closed under pushouts, coproducts indexed over arbitrary object of $\ambient$ and transfinite compositions. \label{saturation}
\end{lemma}

\begin{proof}
In each case the construction induces an operation on the split epimorphism in the diagram of the lifting property. 
In the case of the pushouts, the construction is a pullback, which preserves split epimorphisms.
Fibred exponentials also preserve split epimorphisms. Finally infinite compositions of split epimorphisms are split.
\end{proof}


\begin{proposition} Every morphism factors as an acyclic fibration following a cofibration. \label{factor1} \end{proposition}

\begin{proof} The construction is based on the fact that $\simCat$ is a \emph{Reedy category}. \hide{cite!} Let $\simCat^+$ be the full subcategory of monomorphisms and $\simCat^-$ that of epimorphisms. For each morphism $\phi$ of $\simCat$ let $m(\phi)$ be the monic and $e(\phi)$ the epic factors again.

The first step is to cover $Y$ with another simplicial set $LY$ where degeneracy is decidable.
Let $LY[n] = \Sigma i\of[n]. Y[i]\times\simCat^-(n,i)$ and for $\phi\of [m]\to [n]$ of $\simCat$ and $\tuplet{\epsilon,y}\of LY[n]$ let the following equation hold.
\[\tuplet{\epsilon,y}\cdot \phi=\tuplet{e(\epsilon\circ \phi),y\cdot m(\epsilon\circ\phi)}\]
Let $l_Y\of LY\to Y$ satisfy $l_Y\tuplet{\epsilon,y}=y\cdot\epsilon$.

The second step glues simplices of $X$ and $LY$ together into new ones. Define $d\of X+LY\to\nno$ as follows. %For $x\of X$, $d(x)=\dim(x)$, for $\tuplet{\epsilon,y}\of LY$, $d\tuplet{\epsilon,y} = \cod(\epsilon)$. 
The pair $(f,l_Y)$stand for the morphism $X+LY\to Y$ that satisfies $(f,l_Y)(x)=f(x)$ for $x\of X$ and $(f,l_Y)(y) = l_Y(y)$ for $y\of LY$. Let $Z[n]\subseteq \Pi i\in[n].(X[i]+LY[i])^{\simCat^+(i,n)}$ consist of elements $z$ which satisfy the following conditions for all $\alpha\of [j]\to [k]$ and $\beta\of [i]\to[j]$ in $\simCat^+$.
\begin{enumerate}
\item $(f,l_Y)(z(\alpha\circ\beta)) = (f,l_Y)(z(\alpha))\cdot\beta$;
\item if $z(\alpha)\of X$ then $z(\alpha\circ\beta)\of X$;
\item if $z(\alpha)=\tuplet{\epsilon,y}\of LY$ and $\epsilon\circ\beta$ is not monic, then $z(\alpha\circ\beta)\of LY$ and $z(\alpha\circ\beta)_0$ factors through $\epsilon\circ\beta$.
\end{enumerate}
For $\phi\of[m]\to [n]$, and $z\of Z[n]$, let $z\cdot\phi$ satisfy the following equation for all $\alpha$ of $\simCat^+$.
\[ (z\cdot\phi)(\alpha) = z(m(\phi\circ\alpha))\cdot e(\phi\circ \alpha) \]
By these definitions, $Z$ is a simplicial object.

There is a morphism $g\of X\to Z$ which satisfies $g(x)(\alpha) = x\cdot\alpha$. It is a cofibration because a simplex $z$ is nondegenerate and outside of the image of $g$ if and only if $z(\id_{[\dim(z)]}) = \tuplet{\id_{[\dim(z)]},y}$ for some simplex $y\of Y[\dim(z)]$. The definition of $LY$ ensures that ensures that elements with this property are nondegenerate while condition 3 ensures that if $z(\id)$ is degenerate, then so is all of $z$.

There is a morphism $h\of Z\to Y$ which satisfies $h(z) = (f,l_Y)(z(\id_{[\dim(z)]}))$. This is an acyclic fibration thanks to the following filler operator. Let $a\of \cycle[n]\to Z$ and $b\of \simplex[n]\to Y$ satisfy $h\circ a = b\circ k$ where $k\of\cycle[n]\to\simplex[n]$ is the cycle inclusion. Let $c\of \simplex[n]\to Z$ satisfy $c(\phi)(\mu) = \tuplet{\phi,b(\mu)}$ if $\phi$ is an epimorphism and $c(\phi)(\mu) = a(\phi)(\mu)$ otherwise. Now $c\circ k = a$ and $h\circ c = b$.
\end{proof}

\hide{ In acyclic cofibrations the codomain may have a distance function, that gives an upper bound to the number of compositions required to to reach it. I don't have time to work that out and check it right now.
}

The factorization in the proof above turns the implication in lemma \ref{Reedy} into an equivalence.

\begin{proposition} A morphism has the left lifting property with respect to all acyclic fibrations if and only if it is a cofibration. \label{cofibration characterization} \end{proposition}

\begin{proof} Lemma \ref{Reedy} shows the `if' direction. For `only if' factor $f\of X\to Y$ as in the proof of lemma \ref{factor1} to get a free cofibration $g\of X\to Z$ and an acyclic fibration $h\of Z\to Y$. Because $\id_Y\circ f = h\circ g$ there is a $k\of Y\to Z$ such that $h\circ k = \id_Y$ and $k\circ f = g$ by the global lifting property. 
\[
\xymatrix{
X\ar[d]_f \ar[r]^g & Z\ar[d]^h\\
Y\ar[r]_\id \ar[ur]^k & Y
}
\]
A simplex $y$ of $Y$ is a face outside of the image of $f$ if $k(y)$ is a face outside of the image of $h$, and since the latter is decidable, the former is too.\end{proof}

\section{Acyclic cofibrations}
This section does not have a factorization of arbitrary morphisms into fibrations and acyclic cofibrations. Instead it shows that there is a factorization system in the subcategory of fibrant objects, where acyclic cofibrations are a kind of homotopy equivalence.

\begin{definition} In the subcategory $\ambient\s\f$ of $\ambient\s$ a cofibration $f\of X\to Y$ is \emph{acyclic} if there is a $g\of Y\to X$ such that $g\circ f = \id_X$ and an $h\of \simplex[1]\times Y\to Y$ such that $h\circ k = (\id_Y,f\circ g)$ if $k\of 1+1\to\simplex[1]$ is the cycle inclusion and 
$h\circ (\id_{\simplex[1]}\times f) = f\circ\pi_1$.
\[\xymatrix{
Y+Y\ar[d]_{k\times \id} \ar[dr]^{(\id,f\circ g)}\\
\simplex[1]\times Y \ar[r]_(.6)h & Y\\
\simplex[1]\times X \ar[r]_(.6){\pi_1}\ar[u]^{\id\times f} & X\ar[u]_f\\
}\]\label{acyclic cofibration}
\end{definition}

\begin{theorem} Acyclic cofibrations and fibrations form a weak factorization system for $\ambient\s\f$. \end{theorem}

\begin{proof} Lemma \ref{acyclic have lifting} shows that acyclic cofibrations have the lifting property with respect to all fibrations. Lemma \ref{lifting is acyclic} shows the converse. Proposition \ref{factor2} shows that every morphism factors as a fibration following a cofibration. 
\end{proof}

The proposition and the lemmas in this proof rely on a special property of cycle and horn inclusions (lemma \ref{triple lift}) which the next section explains.

\subsection{Triple lifting property}

\begin{lemma} Let $f\of A\to B$ and $g\of C\to D$ be cofibrations and let $h\of X\to Y$ be a fibration. Let $a\of A\times D\to X$, $b\of B\times C\to X$ and $c\of B \times D\to Y$ satisfy $a\circ(\id_A\times g) = b\circ(f\times \id_C)$, $h\circ a=c\circ(f\times \id_D)$ and $h\circ b=c\circ(\id_B\times g)$. If one of $f$, $g$ or $h$ is acyclic, then there is a $d\of B\times D\to X$ such that $d\circ(f\times\id_D)=a$, $d\circ(\id_B\times g)=b$ and $h\circ d = c$.
\[\xy
(0,20)*+{A\times C}="AC",(25,20)*+{B\times C}="BC",(40,20)*+{X}="X",
(0,0)*+{A\times D}="AD",(25,0)*+{B\times D}="BD",(40,0)*+{Y}="Y"
\ar^{f\times\id} "AC";"BC"
\ar_{\id\times g} "AC";"AD"
\ar_{f\times\id} "AD";"BD"
\ar^{a} "AD";"X"
\ar|(.6){\id\times g} "BC";"BD"
\ar^(.6){b} "BC";"X"
\ar@{.>}_{d} "BD";"X"
\ar_(.6){c} "BD";"Y"
\ar^{h} "X";"Y"
\endxy\]
\label{triple lift}
\end{lemma}

\begin{proof} The general case reduces to the cases where $f$ and $g$ are cycle or horn inclusions, because the lemma is equivalent to the statement that the following maps are (acyclic) fibrations. 
\begin{align*}
\tuplet{f\to h}&=\tuplet{h^{\id_B},\id_X^f}\of X^B \to Y^B\times_{Y^A} X^A\\
\tuplet{g\to h}&=\tuplet{h^{\id_D},\id_X^g}\of X^D \to Y^D\times_{Y^C} X^C
\end{align*}
In the case where $h$ is an acyclic fibration the morphism $\tuplet{g\to h}$ is an acyclic cofibration if is has the lifting property for the family of cycle inclusions $k_i\of \cycle[i]\to\simplex[i]$ for $i\of\nno$, and in turn $\tuplet{k_n\to h}$ are acyclic cofibrations if the triple lifting property holds in the cases where $a=k_i$ and $b=k_j$ for all $i,j\of\nno$. For the cases where $f$ or $g$ are acyclic the same reduction takes us to products of cycle and horn inclusions.

In the cases where $f$ and $g$ are horn or cycle inclusions it is easy to prove that their pushout products $g\pp f$ are compositions of pushouts of sums of horns and cycles and therefore have the left lifting properties with respect to (acyclic) fibrations. 
\[\xy
(0,10)*+{W\times Y}="left",(20,10)*+{\bullet}="middle",(10,20)*+{X\times Y}="top",(10,0)*+{W\times Z}="bottom",(40,10)*+{X\times Z}="right"
\ar^(.4){f\times \id} "left";"top" \ar_{\id\times g} "left";"bottom" \ar "top";"middle" \ar "bottom";"middle"
\ar@{.>}|(.3){g\pp f} "middle";"right" \ar^{\id\times g} "top";"right" \ar_{f\times\id} "bottom";"right"
\endxy\]
Therefore the lemma holds for every pair of cofibrations $f$, $g$ as long as one of $f$, $g$ and $h$ is acyclic.
\end{proof}

\subsection{Factorization system}
\begin{lemma} Acyclic cofibrations have the left lifting property with respect to all fibrations. \label{acyclic have lifting}\end{lemma}

\begin{proof} Let $f\of X\to Y$ be an acyclic cofibration, with inverse $g\of Y\to X$ and homotopy $h\of\simplex[1]\times Y\to Y$. Let $k\of A\to B$ be a fibration and let $a\of X\to A$ and $b\of Y\to B$ satisfy $k\circ a=b\circ f$. The composition $a\circ g\of Y\to A$ is a filler up to homotopy, which can be transported along the homotopy $h$ to become a proper filler. Let $d_0$ be the first horn inclusion $1\to \simplex[1]$. By lemma \ref{triple lift}, there is a $d\of \simplex[1]\times Y\to A$ such that $k\circ c=b\circ h$, $c\circ (\id_{\simplex[1]}\times f)= a\circ \pi_1$ and $c\circ (d_0\times \id_Y) = a\circ g$.
Lemma \ref{triple lift} applies because the following equations hold.

\begin{align*} 
	(a\circ \pi_1)\circ (\simplex(\delta^1_1)\times\id_X) &= a = (a\circ g)\circ f\\
	(b\circ h)\circ (\simplex(\delta^1_1)\times\id_Y) &= b\circ f\circ g = k\circ (a\circ g)\\
	(b\circ h)\circ (\id_{\simplex[1]}\times f) &= b\circ f\circ \pi_1 = k\circ (a\circ \pi_1)
\end{align*}
\[\xymatrix{
X\ar[d]_f \ar[rr]^(.4){d_0\times \id} && \simplex[1]\times X \ar[d]|(.6){\id\times f}\ar[r]^(.6){a\circ \pi_1} & A\ar[d]^k\\
Y \ar[rr]_(.4){d_0\times \id}\ar[urrr]^(.3){a\circ g} && \simplex[1]\times Y\ar[r]_(.6){b\circ h}\ar@{.>}[ur]_c & B
}\]

Let $d_1$ be the other horn inclusion $1\to \simplex[1]$. Let $e=c\circ(d_1\times \id_Y)$, so $k\circ e=b\circ h\circ (d_1\times \id_Y) = b$ and $e\circ f = c\circ (\id_{\simplex[1]}\times f)\circ (d_1\times \id_X) = a$. Then $e$ is a filler for $b\circ f=k\circ a$. By generalization $f$ is an acyclic cofibration.
\end{proof}

\begin{lemma} In $\ambient\s\f$ every morphism that has the left lifting property with respect to all fibrations is an acyclic cofibration. \label{lifting is acyclic} \end{lemma}

\begin{proof} An acyclic fibration is a fibration, because the right lifting property for cycle inclusions induces the right lifting property for horn inclusion. Therefore lemma \ref{cofibration characterization} tells us that every acyclic cofibration is a cofibration.

Let $f\of X\to Y$ be a morphism with the left lifting property for all fibrations in $\ambient\s\f$. There is a morphism $g\of Y\to X$ such that $g\circ f = \id_X$ because $X$ is fibrant. 
\[ \xymatrix{
X\ar[d]_f \ar[r]^\id & X\ar[d]^\bang\\
Y\ar[r]_\bang \ar@{.>}[ur]_h & 1
}\]
There is a morphism $h\of \simplex[1]\times Y\to Y$ such that $h\circ k = (\id_Y,f\circ g)$ if $k\of 1+1\to\simplex[1]$ is the cycle inclusion and $h\circ (\id_{\simplex[1]}\times f) = f\circ\pi_1$ because $Y$ is fibrant and because of lemma \ref{triple lift}.
\[ \xymatrix{
X+X\ar[d]_{f+f}\ar[r]^{k\times\id} & \simplex[1]\times X \ar[r]^(.6){f\circ \pi_0}\ar[d] & Y\ar[d]^\bang\\
Y+Y\ar[r]_{k\times\id} \ar[urr]^(.3){(\id,g)} & \simplex[1]\times Y \ar[r]_\bang\ar@{.>}[ur]_h & 1
}\]
Therefore $f$ is an acyclic cofibration by definition \ref{acyclic cofibration}.
\end{proof}

\begin{proposition} Every morphism $f\of X\to Y$ between Kan complexes factors as a fibration following an acyclic cofibration. \label{factor2} \end{proposition}

\begin{proof} There is a simple factorization $f = p_0\circ r$ where $p_0\of Y/f\to Y$ and $r\of X\to Y/f$, where 
\begin{align*}
Y/f &= \set{(x,p)\of X\times Y^{\simplex[1]}| f(x) = p(*\mapsto 1) }\\
p_0\tuplet{x,p} &= p(*\mapsto 0)\\
r(x) &= \tuplet{x,*\mapsto f(x)}
\end{align*}

The morphism $r$ is not necessarily a cofibration, but factors as an acyclic fibration $g\of W\to Y/f$ following an cofibration $h\of X\to W$ by proposition \ref{factor1}. The morphism $h$ is an acyclic cofibration and the composition $p_0\circ g$ is a fibration for the following reasons.


%h is ac
There is a morphism $p_1\of Y/f\to X$ that satisfies $p_1\tuplet{x,p}=x$. Let $h'=p_1\circ h$, so $h'\circ h = \id_X$.
There is a homotopy $\phi$ between $\id_{W}$ and $h\circ h'$ by lemma \ref{triple lift} and the following equations. %introduce triple lift more gently
\begin{align*}
(\id_W,h\circ h')\circ(h+h)&=(h,h)= (h\circ\pi_1)\circ (c\times \id_X)\\
h'\circ h\circ \pi_1&=\pi_1=(h'\circ\pi_1)\circ(\id_{\simplex[1]}\times h)\\
h'\circ(\id_W,h\circ h')&=(h',h')= (h'\circ\pi_1)\circ (c\times \id_W)
\end{align*}
\[\xymatrix{
X+X\ar[d]_{c\times \id}\ar[r]^{h+h} & W+W\ar[d]_(.3){c\times \id}\ar[r]^(.6){(\id,h\circ h')} & W\ar[d]^{h'}\\
\simplex[1]\times X\ar[r]_{\id\times h} \ar[urr]^(.3){h\circ\pi_1}  & \simplex[1]\times W\ar[r]_(.6){h'\circ\pi_1} \ar@{.>}[ur]_\phi & X
}\]
Because $\phi\circ(\id_{\simplex[1]\times h}) = h\circ \pi_1$, the cofibration $h$ is acyclic by definition \ref{acyclic cofibration}. 

%p_0\circ g is fib
Since fibrations are closed under composition and since $g$ is an acyclic fibration, $p_0\circ g$ is a fibration if $p_0$ is. 

Let $d\of A\to B$ be an acyclic cofibration and let $a\of A\to Y/f$ and $b\of B\to Y$ satisfy $p_0\circ a = b\circ d$. There is a morphism $c_0\of B\to X$ such that $c_0\circ d = p_1\circ a$ because $X$ is fibrant. Let $e_0$ be one of the horn inclusions $1\to \simplex[1]$. There is a morphism $c_1\of\simplex[1]\times B\to Y$ such that $c_1\circ{(\id_{\simplex[1]}\times d)}$ is the transpose of $p_0\circ a$ and $c_0\circ (e_0\times \id_B) = f\circ c_1$ because $Y$ is fibrant and because of lemma \ref{triple lift}.
\[\xy
(0,20)*+{A}="AC",(25,20)*+{\simplex[1]\times A}="BC",(50,20)*+{Y}="Y",
(0,0)*+{B}="AD",(25,0)*+{\simplex[1]\times B}="BD",(50,0)*+{1}="one"
\ar^(.4){e_0\times\id} "AC";"BC"
\ar_{d} "AC";"AD"
\ar_(.4){e_0\times\id} "AD";"BD"
\ar^(.3){f\circ c_0} "AD";"Y"
\ar|(.3){\id\times d} "BC";"BD"
\ar^(.6){a^t} "BC";"Y"
\ar@{.>}_{c_1} "BD";"Y"
\ar_(.6){\bang} "BD";"one"
\ar^{\bang} "Y";"one"
\endxy\]
The transpose $c_1^t\of B\to Y^{\simplex[1]}$ of $c_1$ and $c_0$ together factor as a morphism $c\of B \to Y/f$ which is a filler for $p_0\circ a = b\circ d$. By generalization, $p_0$ is a fibration.
\end{proof}



\section{Model structure}
For a definition of model categories see [\cite{Hovey99, GJSHT}]. The simplicial homotopy of Kan complexes is valid in the internal ELCCC $\ambient$ in the following sense.%give the definition here

\begin{definition} In $\ambient\s\f$ a weak equivalence is a compositions of an acyclic fibration following an acyclic cofibration. \end{definition}

%maybe we need to ague that we+f = af and we+c=ac
%maybe that simplifies the proofs below

\begin{theorem}[Model category]
With fibrations, weak equivalences and cofibrations defined as above $\ambient\s\f$ is a model category.
\label{model category}
\end{theorem}

\begin{proof}
Lemma \ref{factor1} shows that cofibrations and acyclic fibrations form a weak factorization system, considering that they satisfy a lifting property by definition \ref{Kan}. Lemma \ref{factor2} tells the same thing about fibrations and acyclic cofibrations. Lemma \ref{toot} below demonstrates that if two of $f$, $g$ and $f\circ g$ are weak equivalences, then all three are. These three requirements define a model structure.
\end{proof}

\begin{lemma}[2-out-of-3] Let $f\of X\to Y$ and $g\of Y\to Z$ be morphisms of $\ambient\s\f$. If any two of $f,g$ or $g\circ f$ are weak equivalences, then all three are. \label{toot}\end{lemma}

\begin{proof} Weak equivalences are closed under composition by lemma \ref{composition of weak equivalences}.

Let $g$ and $g\circ f$ be arbitrary weak equivalences. The morphism $f$ factors as an acyclic fibration $h\of W\to Y$ following a cofibration $k\of X\to W$ by proposition \ref{factor2}. Because weak equivalences are closed under composition, $g\circ h$ is a weak equivalence. The morphism $k$ is acyclic for the following reasons. Factor both $g\circ f$ and $g\circ h$ as acyclic fibrations following acyclic cofibrations, so $g\circ f = a\circ b$ and $g\circ h = c\circ d$. The lifting properties induce a morphism $l$ such that $l\circ b = d\circ k$ and $c\circ l = a$. Lemma \ref{shared retract 2} says that $l$ is a weak equivalence because $a$ and $c$ are acyclic fibrations. 
Because of closure under composition, the morphism $l\circ b = d\circ k$ is both a weak equivalence and a cofibration and hence an acyclic cofibration. Since $d$ and $d\circ k$ are an acyclic cofibrations, so is $k$ by lemma \ref{left cancellation}.
\[\xymatrix{
X\ar[r]_k\ar@/^2ex/[rr]^f\ar[d]_b & W\ar[r]_h\ar[d]^d & Y\ar[d]^g \\
\bullet\ar@/_2ex/[rr]_a\ar@{.>}[r]^l & \bullet\ar[r]^c & Z
}\]
Since $f = h\circ k$, $f$ is a weak equivalence.

The case where $f$ and $g\circ f$ are weak equivalences is dual to the case above and the reasoning is the same. Acyclic cofibrations satisfy lemma \ref{shared retract} where acyclic fibrations satisfy lemma \ref{shared retract 2}. Acyclic fibrations satisfy lemma \ref{right cancellation} where acyclic cofibrations satisfy lemma \ref{left cancellation}.

This means that weak equivalences indeed satisfy 2-out-of-3.
\end{proof}

\begin{lemma} Weak equivalences are closed under composition. \label{composition of weak equivalences}\end{lemma}

\begin{proof} Compositions of acyclic fibrations are acyclic fibrations and the same holds for acyclic cofibrations. \hide{last part is no longer obvious}
All compositions of weak equivalences are weak equivalences if $g\circ f$ factors as an acyclic fibration following an acyclic cofibration, whenever $g$ is an acyclic cofibration and $f$ is an acyclic fibration.

%transport of acyclics
By proposition \ref{factor1} $g\circ f=h\circ k$ for some acyclic fibration $h\of W\to Z$ and a cofibration $k\of X\to W$. Let $g'$ be the left inverse of $g$. Since $f \circ \id = g'\circ g\circ f= (g'\circ h)\circ k$ there is a morphism $k'$ such that $f\circ k' = g'\circ h$ and $k'\circ k = \id$, so $k$ has its own left inverse.
\[\xymatrix{
X\ar[d]_f \ar[r]_{k} \ar@/^2ex/[rr]^{\id} & W\ar[d]^h \ar[r]_{k'} & X\ar[d]^f\\
Y \ar[r]^{g} \ar@/_2ex/[rr]_{\id} & Z \ar[r]^{g'} & Y
}\]

Let $\phi$ be a homotopy between $\id_Z$ and $g\circ g'$ such that $\phi\circ (\id\times g)=g\circ\pi_1$.

There is a homotopy $\chi$ between $\id_W$ and $k\circ k'$ because of lemma \ref{triple lift}.
\begin{align*}
(\id, k\circ k')\circ (k+k) &= (k,k) = k\circ \pi_1\circ(c\times\id_X)\\
h\circ (k \circ \pi_1) &= (\phi\circ (\id_W\times h))\circ (\id_{\simplex[1]} \times k)\\
h\circ (\id, k\circ k') &= (\phi\circ (\id_W\times h))\circ (c\times \id_W)
\end{align*}
\[\xymatrix{
X+X\ar[d]_{c\times \id}\ar[r]^{k+k} & W+W\ar[d]_(.3){c\times \id}\ar[r]^(.6){(\id,k\circ k')} & W\ar[d]^h\\
\simplex[1]\times X\ar[r]_{\id\times k} \ar[urr]^(.3){k\circ \pi_1}  & \simplex[1]\times W\ar[r]_(.6){\phi\circ (\id\times h)} \ar@{.>}[ur]_\chi & Z
}\]
Because the homotopy satisfies $\chi\circ(\id_{\simplex[1]}\times k) = k\circ \pi_1$, definition \ref{acyclic cofibration} makes $k$ an acyclic cofibration.

\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $g$ and $g\circ f$ are acyclic cofibrations, then $f$ is an acyclic cofibration \label{left cancellation} \end{lemma}

\begin{proof} Let $k\of A\to B$ be a fibration and let $a\of X\to A$ and $b\of Y\to B$ satisfy $k\circ a=b\circ f$. Because $B$ is fibrant, there is a $b'\of Z\to B$ such that $b'\circ g = b$. Lifting properties also imply that there is an $a'\of Z\to A$ such that $a'\circ g\circ f = a$ and $k\circ a'= b'$. So $b'\circ g$ is a filler for $k\circ a=b\circ f$. By abstraction, there is a filler operator that lifts $f$ against all fibrations, and that makes it n acyclic cofibration.
\[\xy
(0,28)*+{X}="x",(14\halfrootthree,21)*+{A}="a",(0,14)*+{Y}="y",(14\halfrootthree,7)*+{B}="b",(0,0)*+{Z}="z"
\ar^a "x";"a" \ar_f "x";"y" \ar^k "a";"b" \ar|(.33)b "y";"b" \ar_g "y";"z"
\ar@{.>}_{b'} "z";"b" \ar@{.>}|(.67){a'} "z";"a"
\endxy\]
\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $f$ and $g\circ f$ are acyclic cofibrations, then $g$ is an acyclic fibration. \label{right cancellation}\end{lemma}

\begin{proof} This is the dual of of lemma \ref{left cancellation} and dual reasoning gives $g$ the right lifting property for all cofibrations. That makes $g$ an acyclic fibration. \hide{Next assume that $f$ and $g\circ f$ are acyclic fibrations. Let $k\of\cycle[n]\to\simplex[n]$ be the cycle inclusion. Let $a\of\cycle[n]\to Y$ and $b\of\simplex[n]\to Y$ satisfy $b\circ k = g \circ a$. Because $\cycle[n]$ is cofibrant, there is an $a'\of \cycle[n]\to X$ such that $f\circ a' = a$ and hence $(g\circ f)\circ a' = b\circ c$. There is a filler $b'\of\simplex[n]\to X$ for this commutative square. The morphism $f\circ b'$ is a filler for the square $b\circ k = g \circ a$. This proves $g$ is an acyclic fibration.

\[\xy
(14\halfrootthree,28)*+{X}="x", (0,21)*+{\cycle[n]}="v", (14\halfrootthree,14)*+{Y}="y", (0,7)*+{\simplex[n]}="w", (14\halfrootthree,0)*+{Z}="z"
\ar@{.>}^{a'} "v";"x" \ar|(.67)a "v";"y" \ar_k "v";"w"
\ar@{.>}|(.33){b'} "w";"x" \ar_b "w";"z"
\ar "x";"y" \ar "y";"z"
\endxy\]}
\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $g$ and $g\circ f$ are acyclic fibrations, then $f$ is a weak equivalence.\label{shared retract 2} \end{lemma}

\begin{proof} By proposition \ref{factor1}, $f$ factors as an acyclic fibration $h\of W\to Y$ following a cofibration $k\of X\to W$. Because $(g\circ f)\circ \id = (g\circ h)\circ k$ and $g\circ f$ is an acyclic fibration, $k$ has a left inverse $k'\of X\to W$ which satisfies $g\circ f\circ k' = g\circ h$. 
\[\xymatrix{
X\ar[d]_k \ar[r]^\id & X\ar[d]^{g\circ f}\\
W\ar[r]_{g\circ h} \ar@{.>}[ur]^{k'} & Z
}\]

Let $c\of 1+1\to\simplex[1]$ be the same cycle as above. There is homotopy $\phi$ between $\id_W$ and $k\circ k'$ because of lemma \ref{triple lift} and the following equations.
\begin{align*}
(\id,k\circ k')\circ(k+k) &= (k,k) = (k\circ\pi_1)\circ (c\times\id_X)\\
(g\circ h)\circ (k\circ \pi_1) &= (g\circ h\circ \pi_1)\circ(\id\times k)\\
(g\circ h)\circ (\id,k\circ k') &= (g\circ h\circ \pi_1)\circ(c\times\id_W)
\end{align*}
\[\xymatrix{
X+X \ar[d]_{c\times \id}\ar[r]^{k+k} & W+W\ar[d]_(.3){c\times\id}\ar[r]^(.6){(\id,k\circ k')} & W\ar[d]^{g\circ h}\\
\simplex[1]\times X \ar[r]_{\id\times k}\ar[urr]^(.3){k\circ\pi_1}& \simplex[1]\times W\ar[r]_{g\circ h\circ \pi_1}\ar@{.>}[ur]_\phi & Z
}\]
Because $\phi\circ (\id_{\simplex[1]}\times k)=k\circ \pi_1$, definition \ref{acyclic cofibration} says that $k$ is an acyclic cofibration. Therefore $f$ is a weak equivalence.\end{proof}

\begin{lemma} If $f\of X\to Y$, $g\of X\to Y$ and if $f$ and $g\circ f$ are acyclic cofibrations, then $g$ is a weak equivalence.\label{shared retract} \end{lemma}

\begin{proof} \hide{The morphism $g$ factors as a fibration $h\of W\to Z$ following an acyclic cofibration $k\of Y\to W$ by lemma \ref{factor2}. Lifting properties give $h$ a right inverse $h'$.
\[\xymatrix{
X\ar[r]^{k\circ f}\ar[d]_{g\circ f} & W\ar[d]^h\\
Z\ar[r]_\id \ar[ur]^{h'} & Z
}\]
Lemma \ref{triple lift} provides a homotopy $\phi$ between $\id_W$ and $h'\circ h$, because the following equations hold.
\begin{align*}
(\id,h'\circ h)\circ(k\circ f+k\circ f)&= (k\circ f,k\circ f) = (k\circ f\circ \pi_1)\circ(c\times \id_Y)\\
h\circ(k\circ f\circ\pi_1) &= g\circ f\circ\pi_1 = (h\circ\pi_1)\circ(\id_{\simplex[1]}\times (k\circ f))\\
h\circ(\id_W,h'\circ h) &= (h,h) = (h\circ\pi_1)\circ(c\times\id_W)
\end{align*}

\[\xymatrix{
X+X\ar[r]^{k\circ f+k\circ f}\ar[d]_{c\times \id} & W+W\ar[r]^(.6){(\id,h'\circ h)}\ar[d]_(.3){c\times\id} & W\ar[d]^h\\
\simplex[1]\times X\ar[r]_{\id\times (k\circ f)}\ar[urr]^(.3){k\circ f\circ\pi_1} & \simplex[1]\times W\ar[r]_(.6){h\circ \pi_1}\ar@{.>}[ur]_{\phi} & Y
}\]}

This lemma is dual to lemma \ref{shared retract 2}. The morphism $g$ factors as a fibration $h\of W\to Z$ following an acyclic cofibration $k\of Y\to W$ by lemma \ref{factor2}. The dual of the proof of lemma \ref{shared retract 2} doesn't show that $h$ is an acyclic fibration directly, but it does show that $h$ has a right inverse $h'\of Z\to W$ and that there is a homotopy $\phi\of\simplex[1]\times W\to W$ between $\id_W$ and $h'\circ h$.

Let $a\of I\to J$ be an arbitrary cofibration and let $i\of I\to W$ and $j\of J\to Z$ satisfy $j\circ a=h\circ i$. Lemma \ref{triple lift} deforms $h'\circ j$ into a filler. Let $c_i$ be the morphisms $1\to \simplex[0]$.
\begin{align*}
\phi\circ(\id\times i)\circ (c_1\times \id) &= h'\circ h\circ i = h'\circ j\circ a \\
h\circ h' \circ j &= j = j\circ \pi_1\circ(c_1\times\id) \\
j\circ \pi_1\circ (\id\times a) &= j\circ a\circ \pi_1 = h\circ i \circ \pi_1\\
h\circ \phi\circ(\id\times i) &= h \circ \pi_1 \circ (\id\times i) = h\circ i \circ \pi_1
\end{align*}

\[\xymatrix{
I\ar[r]^{a}\ar[d]_{c_1\times \id} & J\ar[r]^(.6){h'\circ j}\ar[d]_(.3){c_1\times\id} & W\ar[d]^h\\
\simplex[1]\times I\ar[r]_{\id\times a}\ar[urr]^(.3){\phi\circ(\id\times i)} & \simplex[1]\times J\ar[r]_(.6){j\circ \pi_1}\ar@{.>}[ur]_{\psi} & Z
}\]
The filler is $\psi\circ c_0$. By generalization, $h$ is an acyclic fibration and $f$ is a weak equivalence.
\end{proof}



\subfile{cshdescent}

\section{Closing}

\subsection*{Acknowledgments} 
I am grateful to the Warsaw Center of Mathematics and Computer Science for the opportunity to write this paper. I am also grateful for discussions with Marek Zawadowski and the seminars on simplicial homotopy theory he organized during my stay at Warsaw University. Richard Garner, Peter LeFanu Lumsdaine and Thomas Streicher made invaluable comments on early drafts of this paper.



\printbibliography

\end{document}

