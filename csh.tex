% LaTeX 2e document, TAC style, 36 pp, Xy-pic ver ?, MikTeX version ?

\documentclass{tac}
\usepackage{amssymb, amsmath}
\usepackage[backend=bibtex,citestyle=authoryear-icomp]{biblatex}
\usepackage[all]{xy}
%\usepackage{cite}
\usepackage{url}
%\usepackage{graphicx}

%\renewcommand*\ttdefault{pcr}

\title{Realizable Simplicial Homotopy}
\author{Wouter Pieter Stekelenburg}\copyrightyear{2015}
\address{Faculty of Mathematics, Informatics and Mechanics\\
University of Warsaw\\
Banacha 2\\
02-097 Warszawa\\
Poland}
\eaddress{w.p.stekelenburg@gmail.com}
\keywords{realizability, simplicial homotopy, Kan complexes}
\amsclass{03D80, 18G30, 18G55}

\newcommand\hide[1]{}
\newcommand\cat\mathcal
\newcommand\set[1]{\left\{#1\right\}}
\mathrmdef{id}
\mathrmdef{dom}
\mathrmdef{cod}
\newcommand\ri{^*}
\newcommand\N{\mathbb N}
\mathbfdef[nno]{N}
\newcommand\dual{^{\mathrm{op}}}
\newcommand\disc{_{\mathrm{disc}}}
\mathbfdef[simCat]\Delta
\newcommand\s{^{\simCat\dual}}
\mathbfdef[pow]{P}
\mathssbxdef{Asm}
\newcommand\bang{!}
\newcommand\of{:}
%\renewcommand\to{\mathord\rightarrow}
\newcommand\simplex\Delta
\newcommand\cycle{\partial\Delta}
\newcommand\horn\Lambda
\newcommand\f{_f}
\newcommand\db[1]{{[\![}#1{]\!]}}
\newcommand\gen\gamma
\newcommand\dsum{\Sigma_}
\newcommand\dprod{\Pi_}
\newcommand\tuplet[1]{\left\langle #1 \right\rangle}
\newcommand\true{\mathtt{true}}
\newcommand\false{\mathtt{false}}
\newcommand\bool{\mathtt{bool}}
\newcommand\ttif{\mathtt{if}}
\mathssbxdef{cof}
\mathrmdef{nat}
\mathssbxdef{Ar}
\mathssbxdef{Ob}
\mathssbxdef{Core}
\mathssbxdef[LDMC]{II}
\newcommand\pe[1]{^{\diamond #1}}
\newcommand\pp{\mathbin\diamond}
\newcommand\norm[1]{\Vert #1 \Vert}
\newcommand\ka\kappa
\newcommand\la\lambda
\newcommand\depprod{\Pi_}
\newcommand\depsum{\Sigma_}
\newcommand\face\delta
\mathrmdef{colim}
\newcommand\U{U}
\newcommand\A{M}
\newcommand\W{W}
\newcommand\di{_*}
\mathrmdef{hcg}
\newcommand\ex{_{\textrm{ex}}}
\newcommand\citep[1]{[\cite{#1}]}

\newcommand\code\mathtt
\mathssbxdef{Func}
\mathssbxdef[igen]{gen}

\addbibresource{realizability}

\begin{document}

\begin{abstract} The paper show how to develop simplicial homotopy inside realizability categories like the category of assemblies, where the small object argument and minimal fibrations are unavailable. This way simplicial assemblies are a suitable model for homotopy type theory.\end{abstract}

\maketitle

\section{Introduction}
This paper grew out of an attempt to build a \emph{recursive realizability} model for \emph{homotopy type theory}. The intention is to interpret types as the homotopy types of the simplicial objects in the \emph{category of assemblies}. What makes this challenging, is that this category lacks some of the structure of the category of sets that \emph{classical homotopy theory} is build on. In the internal logic the principle of the excluded middle and the axiom of choice are false. The category of assemblies is not exact and lacks infinite limits and colimits. While there are \emph{generic monomorphisms}, they are not subobject classifiers. I deal with these issues in the following ways.
\begin{enumerate}
\item I look at simplicial objects of suitable internal categories. The advantage is that a realizer for being a simplicial object is available for any construction we need to make in the proofs.
\item I limit the class of cofibrations. In classical simplicial homotopy theory every monomorphism is a cofibration. In this paper's version, we demand that certain properties of the monomorphism are decidable.
\item The class of fibration also changes. Fibration come equipped with a \emph{fill operator} that realizes.
\item I build the homotopy category out of the fibrant objects only. The small object argument that supplies fibrant replacements in classical homotopy requires infinite colimits that are unavailable.
\end{enumerate}
Out of interest in using the constructions in other contexts than the category of assemblies, this paper works with a generic \emph{extensive locally Cartesian closed category} with a \emph{natural number object} instead of the category of assemblies itself.


\hide{In the right place?}
\subsection{Internalization}
The following methods help me to reason internally in extensive locally Cartesian closed categories that have little internal logic or their own. 

Extensive means that the categories have finite coproducts and that pullbacks preserve them. Every extensive category $\cat E$ becomes an \emph{extensive site} $(\cat E, E)$ by adding the \emph{extensive topology} $E$, the least topology that contains the empty covers of initial objects and the binary covers $\set{ A\to A+B, B\to A+B}$ of binary coproducts. The topos $\cat T$ of sheaves over this site has a rich internal language, and the Yoneda embedding $\cat E\to \cat T$ includes $\cat E$ as the full subcategory of \emph{compact projectives}--the projective objects for which any covering family has a finite subcover.

A truth value of $\cat T$ is a sieve on $\cat E$. Every `compact' proposition $p$ in the internal language of $\cat T$ has an object $P$ of witnesses or \emph{realizers} in $\cat E$. An object $U$ of $\cat E$ forces the proposition $p$ if there exists a morphism $U\to P$. So the focus of this paper is to show that morphisms exists between suitable objects object of locally Cartesian closed categories.

\hide{proofs? citations?

Note that the Yoneda embedding cannot preserve the natural number object, because the natural number object of $\cat T$ is not compact. The properties of the image of the NNO except compactness are a mystery.

Is this so outlandish that Thomas couldn't figure it out himself?

Would it be better as a theory of the simplicial homotopy of compacts in toposes?

}

\subsection{Related literature}
Simplicial homotopy is the homotopy of simplicial sets. It is equivalent to the homotopy of CW complexes which are a category of topological spaces \citep{Hovey99,GJSHT}.

\section{Preliminaries}
This section surveys the categorical logic required to understand the rest of this paper.

\subsection{Set up}
We work in a category $\cat A$. The intended model is the category of assemblies defined in \citep{MR1097022,MR1023803,MR2479466}, but in this paper we only use the following properties so that the theory applies to many examples.
\begin{enumerate}
\item The category $\cat A$ is \emph{locally Cartesian closed}. This means that for each object $X$ of $\cat A$ each slice $\cat A/X$ is Cartesian closed.
\item The category $\cat A$ is extensive, which means that is has finite coproducts and that $\cat A/(X+Y)$ is equivalent to $(\cat A/X)\times(\cat A/Y)$ for each pair of objects $X$ and $Y$ of $\cat A$.
\item The category $\cat A$ is extensive and has a \emph{natural number object} $\nno$.
\item There is an internal category $\cat S$ that is extensive and locally Cartesian closed.% terminal object = $X^0$
\end{enumerate}

\newcommand\icat{\mathfrak}

That $\cat S$ is locally Cartesian closed and extensive means that is has the same properties as $\icat A$ in an internalized way. This internalization is possible because of the structure that $\icat A$ has. Local Cartesian closure implies that all pullbacks exist, since those are the Cartesian products of the slice categories. Since $\icat A$ has a terminal object, is has all finite limits. In this paper we assume that there is a function that chooses a limit for each diagram. This means that systems of equations between morphisms of $\icat A$ define isomorphism classes of objects of $\icat A$.  Now a systems of equations of morphism are an object declaration or specification language for $\icat A$. Thanks to the local exponentials, this language is part of an \emph{extensional type theory} that allows the definition of more complicated structures like internal locally Cartesian closed Categories. Extensibility adds finitary sums to the type theory. %hate this. don't know how to improve.

The category of small assemblies serves the following purpose. There is an internal category of simplices $\simCat$ in $\icat A$, so there is a internal category of small simplicial objects $\cat S\s = \Func(\simCat\dual,\cat S)$. On one hand this means that morphisms in $\icat A$ can witness--or \emph{realize}--the validity of statements in simplicial homotopy theory and that objects of $\icat A$ can serve as objects of realizers. The simplicial homotopy of this paper is realizable in that sense. One immediate consequence is that we limit the class of simplicial object by looking at the internal ones. The objects of $\cat S\s$ induce functors $\Delta\dual\to\cat A$--here $\Delta$ is the external category of simplices--but the intended model doesn't allow going back even if the functor only hits small assemblies. Hence internal simplicial objects are a stronger kind of simplicial object, and that implies better properties.

Compared to classical homotopy, the structures we mentioned play the following role. The category $\cat A$ replaces the category of large sets and $\cat S$ replaces the category of small sets in the background of a classical homotopy theory. The members of $S$ are functions of large sets with small fibres, and $\gen(S)$ stands for the bundle of all small sets.


%here
\hide{What is below this line has not been adapted yet}
\subsection{Basic concepts} This last subsection introduces explains the notation used this paper. 

There is an ambient category and several internal categories. Some of the notational overlaps: the codomain, domain and identity operators are always called $\cod$, $\dom$ and $\id$ and $[n]$ always refers to the initial segment of the natural number object, even if that natural number object lives inside an internal category. When not talking about numbers, $0$, $1$, $+$ and $\times$ refer to initial and terminal objects and binary coproduct and product operators of either the ambient category or one of its internal categories. The unique map to the terminal object is $\bang$ and projection maps from products to factors are $\pi_i$ for $i\in \N$.

Every object $I$ of the ambient category has an internal discrete category $I\disc$. For this category $\Ob(I\disc)=\Ar(I\disc)=I$ and $\cod=\dom=\id=\id(I)$.

The \emph{set} of natural numbers is $\N$, and since it is a set, $i\in \N$ indicates membership. Other natural number objects are $\nno$, and $i\of\nno$ means that $i$ is a morphism whose codomain is $\nno$.

Let $\cat C$ be an internal category. Its object of objects is $\Ob(\cat C)$ and its object of arrows is $\Ar(\cat C)$, so in this case $\cod$ and $\dom$ are morphisms $\Ar(\cat C)\to\Ob(\cat C)$ and $\id\of\Ob(\cat C)\to\Ar(\cat C)$. Let $\cat D$ be another internal category. The internal category of functors $\cat C\to\cat D$ is $\Func(\cat C,\cat D)$ or $\cat D^{\cat C}$.

\hide{removed ELCCCs}

\subsection{Dependent types}
The atomic sentences of a type theory are type assignments $t\of T$ and equations $t=u$. Types are interpreted as objects of a category $\cat C$, while terms are interpreted as global sections. A proposition $t\of T$ is valid if the interpretation $\db t$ of $t$ is a global section of the interpretation $\db T$ of $T$ in $\cat C$. A proposition $t=u\of T$ is valid if $\db u=\db t$. 

The rules explain the interpretation of closed types and terms. This interpretation extend to dependent types an terms--i.e.\ types and terms that contain free variables--in the following manner. For each type $T_0$ a type $T_1$ that depends on $T_0$ is interpreted as an object of $\cat C/\db{T_0}$. A term $t_1\of T_1$ that depends on $T_0$ is a section of $\db{T_1}$. A further type $T_2$ that depends on both $T_0$ and $T_1$ is interpreted as an object $\db{T_2}\of(\cat C/\db{T_0})/\db{T_1}$ and a term $t_2\of T_2$ as a global section.
\hide{\[\xymatrix{
& \bullet\ar[dl]^{\db{T_2}}\ar[d]\\ 
\bullet\ar[r]_{\db{T_1}}\ar@/^/[ur]^{\db{t_2}} & \db{T_0}
}\]}
\[\xy
(0,12)*+{\bullet} = "top left",(24,12)*+{\bullet} = "top right",(12,0)*+{\db{T_0}} = "bottom"
\ar "top right";"bottom" \ar_{\db{T_1}} "top left";"bottom" 
\ar@/^/@{->}^{\db{T_2}} "top right";"top left"
\ar@/^/@{->}^{\db{t_2}} "top left";"top right"
\endxy\]
So types and terms dependent on $T_0$ and $T_1$ are interpreted as the objects and global sections of the double slice category $(\cat C/\db{T_0})/\db{T_1}$.

We deal with higher numbers of free variables by repetition. A context $\Gamma$ is a list $x_0\of T_0,x_1\of T_1,x_2\of T_2,\dots$ of type assignment to variables in which each type depends on the ones before it. The types that depend on the context are objects of the repeated slice category $\cat C/\db{T_0}/\db{T_1}/\db{T_2}/\dotsm$ and the terms are interpreted as its objects. 

The purpose of the variables is to clarify the dependencies. There are functors $\db T\ri\of\cat C\to \cat C/\db T$ which sends each object $X$ to the projection $\pi_0\of(\db T\times X)\to \db T$. By default the context dependent interpretation $\db{x\of T\vdash U}$ of a type $U$ equal $\db T\ri(\db U)$ (and assume that $\db U$ is an object of $\cat C$) unless $U$ explicitly depends on $T$. The same convention applies to terms.

\subsection{Dependent sums and products}
This subsection discusses two constructions of types that this paper uses regularly.

%dependent sums

For each object $X$, $\dsum X\of\cat C/X\to \cat C$ is the functor that sends each morphism $f\of Y\to X$ to its domain $Y$.

Dependent sum type look like $\Sigma x\of T.U$. The elements are pairs $\tuplet{x,y}$ such that $x\of T$ and $y\of U$. For arbitrary terms $t\of(\Sigma x\of T)$, $\pi_0(t)$ and $\pi_1(t)$ represent two values in the tuple $t$. The context dependent interpretation satisfies:
\[ \db{\Gamma\vdash\Sigma x\of T.U} = \dsum {\db T}(\db{\Gamma,x\of T\vdash U}) \]
The unit and counit induces a families of morphisms between the following families of objects.
\begin{align*}
\db{\Gamma\vdash t\of T}\times\db{\Gamma\vdash u\of U[t/x]} &\to \db{\Gamma\vdash \tuplet{t, u}\of(\Sigma x\of T.U)}\\
\db{\Gamma\vdash t\of (\Sigma x\of T.V)}&\to \db{\Gamma\vdash \pi_1(t) \of V}
\end{align*}
Here $u[t/x]$ is the result of replacing every free occurrence of $x$ in $u$ with $t$; the type $V$ cannot contain $x$ as a free variable. Unit and co-units satisfy equations that ensure that $\pi_0\tuplet{t,u}=t$ and $\pi_1\tuplet{t,u}=u$ are valid for all terms $t$ and $u$.


Let $\cat C$ be finitely complete and Cartesian closed. The functor $\dprod X\of\cat C/X\to \cat C$ sends each morphism $f\of Y\to X$ is the object $\set{g\of X\to Y| f\circ g = \id_X }$ of sections of $f$. It is the right adjoint of $X\ri$.

Product types look like $\Pi x\of T.U$. The elements are $\lambda$-terms $\lambda x\of T.u$, such that $u[t/x]\of U[t/x]$ whenever $t\of T$. A $\lambda$-term $\lambda x\of T.u$ and a term $t\of T$ have an \emph{application} $(\lambda x\of T.u)(t)$. The context dependent interpretation satisfies:
\[ \db{\Gamma\vdash\Pi x\of T.U} = \dprod {\db T}(\db{\Gamma,x\of T\vdash U}) \]
The unit and the counit induce the following families of morphism:
\begin{align*}
\db{\Gamma\vdash t\of T}\times\db{\Gamma\vdash u\of(\Pi y\of T.U)}&\to\db{\Gamma\vdash u(t)\of U[u/y]}\\
\db{\Gamma\vdash u\of V}&\to\db{\Gamma\vdash (\lambda x\of T.u)\of(\Pi x\of T.V)}
\end{align*}
Here $V$ cannot depend on $x$. Unit and co-units satisfy equations that ensure that $(\lambda x\of T.u)(t) = u[t/x]$ and $(\lambda x\of T.u(x))=u$.

Extensiveness means that $\cat C$ has coproducts, that $\cat C/0$ is equivalent to the terminal category and that $\cat C/(X+Y)\cong (\cat C/X)\times(\cat C/Y)$. In the presence of dependent coproducts, a type $\bool$ that stands for the object $1+1$ and a way to introduce types and terms that dependent on $\bool$ suffice to add all binary coproducts.
\[ \db{\Gamma\vdash t\of T}\times\db{\Gamma\vdash u\of U}\to\db{\Gamma,b\of\bool\vdash \ttif(b,t,u)\of\ttif(b,T,U)} \]
The constants $\true$ and $\false$ denote the two global section of $1+1$. The function $\ttif$ is interpreted to satisfy the following equations.
\[ \ttif(\true,t,u)=t\qquad\ttif(\false,t,u) = u\]

\subsection{Predicates} Traditional simplicial homotopy works with \emph{classes} of fibrations, cofibrations and weak equivalences which. The counterpart for internal categories is a functor that is monic on objects. This type of functors doesn't keep track of witnesses for membership, however, which is why we replace classes by a more general type of functor: discrete isofibrations. These generalized classes are automatically closed under isomorphism like the classes of fibrations, cofibrations an weak equivalences are supposed to be. 

\begin{definition}
A functor $F\of \cat C\to\cat D$ is a \emph{discrete isofibration} if it is a fully faithful functor and has the following lifting property. For each isomorphism $g\of X\to FY$ in $\cat D$ there is a unique $h\of X'\to Y$ in $\cat C$ such that $Fh=g$. 

An internal functor $F\of \cat C\to\cat D$ is a \emph{discrete isofibration} if there are witnesses to the properties in the last paragraph. The first witness is the inverse of the natural transformation $g\mapsto Fg\of \cat C(X,Y)\to\cat C(FX,FY)$. Let $\cat I$ be the indiscrete category of $2$ objects and let $T:1\to \cat I$ be the functor that points to one of the objects. There is a functor $\tuplet{F^{\cat I},\cat C^T}$ from $\cat C^{\cat I}$ into the pullback of $F$ and $\cat D^T\of \cat D^{\cat I}\to \cat D$. The second witness is an inverse of this functor.
\[\xy
(34,20)*+{\cat C}="top",(0,10)*+{\cat C^{\cat I}}="left",(24,10)*+{\bullet}="middle",(44,10)*+{\cat D}="right",(34,0)*+{\cat D^{\cat I}}="bottom"
\ar^{\cat C^T} "left";"top" \ar@{.>}|(.6){\tuplet{F^{\cat I},\cat C^T}} "left";"middle" \ar_{F^{\cat I}} "left";"bottom" \ar "middle";"bottom"
\ar "middle";"top" \ar^(.6){F} "top";"right" \ar_(.6){\cat D^T} "bottom";"right"
\endxy\]
\end{definition}

The category of discrete isofibrations with the same codomain is an ELCCC. This category replaces the poset of subcategories.

\section{Internal simplicial homotopy}
This section develops the homotopy theory of Kan complexes internally in ELCCCs. 

The situation is as follows. The ambient category is an ELCCC $\cat A$ that has a natural number object $\nno$. The category $\cat A$ has a class $S$ of `small' maps which has a generic morphism $\gen(S)$. The internal category $\cat S = \cof(\gen(\cat S))$ of fibres of $\gen(S)$ is an internal ELCCC and therefore has a category of simplicial objects $\cat S\s$. The internal version $\simCat$ of the category of simplicial sets comes from $\nno$.

\begin{proposition} Every ELCCC with natural number object has an internal category of simplices.\end{proposition}

\begin{proof} A natural number object allows the definition of predicates by recursion, so the order relation of $\nno$ is a recursive function $\mathord\leq\of\nno\times \nno \to \bool$. This is all we need to define the internal category of simplices.
\begin{align*}
[n] &= \set{x\of\nno\middle| x\leq n}\\
\simCat([m],[n]) &= \set{f\of[m]\to[n]\middle|\forall x,y\of [m].x\leq y\to f(x)\leq f(y)}
\end{align*}
Universal quantification over $[m]$ reduces to a finite conjunction because $[m]$ is a finite object, which is why it is allowed above. 
\end{proof}

\subsection{Filler operators}
Kan fibrations are morphisms of simplicial sets that have the lifting property relative to the family of horn inclusions. This subsection focuses on the lifting properties. Extensional type theory offers no existential quantification to express the idea that `there is a lifting'. Extensional type theory requires a lifting operator that witnesses this fact.

\begin{definition} Let $\nat\of(\cat S\s)\dual\times \cat S\s \to \cat S^{\nno\disc}$ be the functor which sends each pair of simplicial objects $X,Y$ to the object $\nat(X,Y)$ of morphisms between them--the object $\nat(X,Y)$ lives in $\cat S^{\nno\disc}$ because natural transformations are families of morphisms and $\cat S$ has exponentials.

A morphism $f\of X\to Y$ of $\cat S\s$ has the \emph{global right lifting property} with respect to a morphism $g\of I\to J$--and $g$ has the global \emph{left} lifting property with respect to $f$--if the morphism $\tuplet{f_!,g\ri} = \tuplet{\nat(\id_J,f),\nat(g,\id_X))}$ 
which is the factorization of the span $\nat(\id_J,f)$, $\nat(g,\id_X)$ through the pullback cone of $\nat(\id_I,f)$ and $\nat(g,\id_Y)$
is a \emph{split} epimorphism.
\[\xy
(34,20)*+{\nat(I,X)}="top",(0,10)*+{\nat(J,X)}="left",(24,10)*+{\bullet}="middle",(44,10)*+{\nat(I,Y)}="right",(34,0)*+{\nat(J,Y)}="bottom"
\ar^{\nat(g,\id_X)} "left";"top" \ar@{.>}|(.6){\tuplet{f_!,g\ri}} "left";"middle" \ar_{\nat(\id_J,f)} "left";"bottom" \ar "middle";"bottom"
\ar "middle";"top" \ar^(.6){\nat(\id_I,f)} "top";"right" \ar_(.6){\nat(g,\id_Y)} "bottom";"right"
\endxy\]
A section of $\tuplet{f_\bang,g\ri}$ is a \emph{filler operator}.\label{lifting}
\end{definition}

The ordinary right lifting property only says that composition with $\tuplet{f_\bang,g\ri}$ induces a surjective function on global sections, while the \emph{local} right lifting property only requires that $\tuplet{f_\bang,g\ri}$ is a regular epimorphism. The global version formulated above is stronger than either of those.

A morphism can have a lifting property relative to a family or class of morphisms.

%here
\begin{definition}[Injective] Let $\code{sections}$ be the discrete isofibration of sections. %more information needed?
An $I$-indexed-family of morphisms in $\cat S\s$ a morphism $a\of D\to E$ in $(\cat S\s)^{I\disc}$. Let $I\ri\of\cat S\s\to (\cat S\s)^{I\disc}$ be the diagonal functor. A morphism $f\of X\to Y$ is \emph{$a$-injective} if $I\ri f$ has the global right lifting property with respect to $a$.

\[ a\code{-injective}(f)=\code{sections}(I\ri(f)_\bang,a\ri) \]

Let $a\code{-injective}$ be the functor $\Core(\Func([1],\cat S))\to\Func(\nno\disc,\cat S)$ which sends each morphism $f$ to $\code{sections}(I\ri(f)_\bang,a\ri)$.
\end{definition}

\hide{Add?: These injectives satisfy the usual properties of closure under products, composition and pullback, thanks to specific constructions on filler operators.}

Internal languages only quantify over objects and $\cat S$ does not have an object of $a$-injectives does not exist inside $\cat S$. The definition of $a$-anodynes therefore requires the ambient category $\cat A$.

\begin{definition}
Since $\cat S$ may have too small products, the property of being $a$-anodyne for an $I$-indexed family of morphisms $a$ is represented by a functor valued in the following ELCCC.
\[ \cat S'= \Func(\Core(\Func([1]\times\simCat\dual,\cat S)),\Func(\nno\disc,\cat S)) \]

For each $f$ and $g$ of $\Core(\Func([1]\times\simCat\dual,\cat S))$, $a\code{-anodyne}(f)(g)$ is the object of morphisms that takes lifting operators for $a$ against $g$ to lifting operators for $f$ against $g$ as shown here below.
\[ a\code{-anodyne}(f)(g) = \Pi s\of \code{sections}(a_!,(I\ri g)\ri).\code{sections}(f_!,g\ri) \]

A morphism $f$ is \emph{$a$-anodyne} if $a\code{-anodyne}(f)$ has a global section inside $\cat S'$.
\end{definition}

The global sections that witness that a morphism $f$ reduce the problem of lifting $f$ to the problem of lifting the member of the family $a$ using whatever constructions are available in $\cat S$.

\subsection{Kan fibrations}
The subsection completes the definition of Kan fibrations.

ELCCCs like $\cat S$ have all the finite objects: $0$, $1$, $1+1$, $1+1+1$, etc. Hence $\simCat$ is enriched over $\cat S$ and there exists a Yoneda embedding $\Delta\of \simCat \to \cat S^{\simCat \dual}$. 

\begin{definition} For each $n\of \nno$ the \emph{cycle} $\cycle[n]$ is the sieve of non surjective functions that is a subobject of $\simplex[n]$. For each $n$ and $k\of\nno$ the \emph{horn} $\horn_k[n]$ is the sieve of the non decreasing maps $[m]\to [n]$ that are not onto the set $[n]-\set{k}$. These sieves are definable because being surjective is a decidable property of morphisms $[m]\to[n]$. 
\end{definition}

\begin{definition} Cycles and horns form families of morphisms indexed over $\nno$ and over $\set{(n,k)\in\nno\times\nno| k\leq n }$ respectively.
\begin{align*} 
\code{cycles}&\of\bullet\to \nno\\
 \code{horns}&\of\bullet\to\set{(n,k)\in\nno\times\nno| k\leq n }
\end{align*}
\begin{itemize}
\item A \emph{Kan fibration} is an injective morphism relative to the family of all horn inclusions.
\[ \code{fibration}(f) = \code{horns-injective}(f) \]
\item An \emph{acyclic Kan fibration} is an injective morphism relative to the family of cycle inclusions.
\[ \code{acyclic-fibration}(f) = \code{cycles-injective}(f) \]
\item A \emph{Kan complex} or \emph{Kan fibrant object} is a simplicial object $X$ for which the unique morphism $X\to 1$ is a fibration.
\[ \code{fibrant}(X) = \code{horns-injective}(\bang_X) \]
\item A \emph{cofibration} is an anodyne morphism relative to the family of cycle inclusions.
\[ \code{cofibration}(f) = \code{cycles-anodyne}(f) \]
\item A \emph{cofibrant object} is a simplicial object $X$ for which the unique morphism $0\to X$ is a cofibration.
\[ \code{cofibrant}(X) = \code{cycles-anodyne}(\bang_X) \]
\item An \emph{acyclic cofibration} is an anodyne morphism relative to the family of horn inclusions.
\[ \code{acyclic-cofibration}(f) = \code{horns-anodyne}(f) \]
\item A \emph{weak equivalence} is a morphism which factors as an acyclic fibration following an acyclic cofibration.
\end{itemize}\label{Kan}

The category of Kan complexes and morphisms of simplicial object is $\cat S\s\f$. Its objects are pairs $(X,\xi)$ where $X$ is an object of $\cat S$ and $\xi$ is a filler operator for $\bang_X\of X\to 1$. The filler operator merely serves as a witness of fibrancy and is \emph{not} preserves by morphisms $(X,\xi)\to(Y,\xi')$ which are arbitrary morphisms $X\to Y$.
\end{definition}
This paper usually leaves out `Kan' and simply talk about fibrations and complexes. 

A witness for weak equivalence has to include a factorization of a morphism. An object of witnesses that considers all possible factorizations is a huge coproduct, which is hard to find a suitable internal ELCCC to contain it. Fortunately, this paper shows a couple of ways to factorize morphisms (propositions \ref{factor1} and \ref{factor2}). A witness for weak equivalence only has to show that one of these is an acyclic fibration following an acyclic cofibration. The groupoid of factorized morphisms is $\Core(\Func([2]\times\simCat\dual,\cat S))$ and the functor that represents the class of weak equivalences simply combines the functors that represent the classes of acyclics.

\begin{remark}[Saturation] Injectives are closed under various constructions, notably compositions, finitary products and pullbacks. Every isomorphism is injective. Moreover, the filler operators for the new injectives are functions of the existing filler operators, which are represented by natural transformations of internal functors.
\[
\xy
(0,12)*+{\bullet}="a",(12,12)*+{\bullet}="b",(24,12)*+{\bullet}="c",
(0,0)*+{\bullet}="d",(12,0)*+{\bullet}="e",(24,0)*+{\bullet}="f",
\ar "a";"b" \ar "b";"c" \ar "a";"d" \ar^(.6){g\ri(f)} "b";"e" \ar^f "c";"f" \ar "d";"e" \ar_g "e";"f"
\ar@{.>} "d";"c" \ar@{.>} "d";"b"
\endxy
\xy
(0,12)*+{\bullet}="a",(12,12)*+{\bullet}="b",(12,6)*+{\bullet}="c",(0,0)*+{\bullet}="d",(12,0)*+{\bullet}="e"
\ar "a";"b" \ar "a";"d" \ar "b";"c" \ar "c";"e" \ar "d";"e" \ar@{.>} "d";"b" \ar@{.>} "d";"c"
\endxy
\]

Anodynes have dual closure properties. Besides composition, they are closed under finitary coproducts and pushouts. Isomorphisms are anodynes and all morphisms that are both injective and anodyne are isomorphisms. Moreover, for each adjoint pair of functors $F\dashv G$ between two categories that have their own classes of anodynes and injectives, the left adjoint $F$ preserves anodynes if an only if the right adjoint $G$ preserves injectives.

A consequence of these closure properties, is that horn inclusions are cofibrations, therefore that acyclic fibrations are fibrations and therefore all acyclic cofibrations are cofibrations.
\end{remark}

The next section demonstrates that the morphisms of definition \ref{Kan} form a model structure on $\cat S\s$ (theorem \ref{model category}).

\section{Model structure}%class functors not mentioned in the sections below--"characteristic functors"
Simplicial homotopy theory has been robbed of the comforts of classical foundations: the axiom of choice, the principle of the excluded middle, infinite limits and colimits etc. Yet the standard model structure of simplicial sets survives in the category of Kan complexes. This section runs through of the simplicial homotopy of Kan complexes \citep{Hovey99,GJSHT} in order to demonstrate that the familiar theory is constructive.

\subsection{Cofibrations}
This subsection characterizes the cofibrations of $\cat S\s$. It also proves that arbitrary morphisms factor as acyclic fibrations following cofibrations. The characteristic property is that a certain relation between the morphism and morphisms in the codomain is decidable.

\begin{definition} A $y\of Y[n]$ is called an \emph{$n$-simplex} of $Y$. An $n$-simplex is \emph{degenerate} if there is an $s\of [n]\to [n]$ different from $\id_{[n]}$ such that $Y(s)(y)=y$. If there are no such $s$ and $x$, then $y$ is \emph{nondegenerate} and also called a \emph{face} of $Y$.\end{definition}

While $\cat S$ may lack the structure required to soundly interpret existential quantification over arbitrary objects, this is not a problem with the set of morphisms $s\of [n]\to [n]$ different from $\id_{[n]}$ as it is finite.

\begin{definition} A monomorphism is a \emph{free cofibration} if for each $i\in \nno$, there is an object $S_i$ of $i$-dimensional faces of $Y$ which are not in the image of $X$. This means that there are $s_i:Y[i]\to\bool$ such that all $S_i$ are pullbacks of $\true:1\to\bool$.
\end{definition}

Internally the representation of a free cofibration is much simpler than that of a cofibration, since the family of morphisms $s_i$--which is unique if it exists--already witnesses membership.%hold that thought...

\begin{lemma} Every free cofibration is a cofibration. \label{Reedy}
\end{lemma}

\begin{proof} Suppose $f\of X\to Y$ is a free cofibration and $i\of\nno\mapsto S_i$ is the family of faces outside the image of $f$. 
For each $i\of\nno$ let $Y_i$ be the sieve of $Y$ which omits the simplices in $S_j$ for $j>i$.
Let $\simCat\ri\of \cat S\to\cat S\s$ be the constant simplicial assembly functor. 
Each $y\in S_i$ corresponds to a monomorphism $\simplex[i]\to Y$ which does not factor through $f$ by the Yoneda lemma.

Cofibrations are closed under pushouts, finite and $\cat S$-indexed coproducts and transfinite compositions for all the usual reasons.
The inclusion $X\to Y_0 = X+\simCat\ri(A_0)$ is a pushout of $A_0$ copies of the cofibration $0\to 1$ and hence a cofibration.
For $i>0$, if $y\of S_i$ then $Y_i\cap y$ is the boundary of $y$, hence $Y_{i-1}\to Y_i$ is a pushout of $S_i$ copies of the cofibration $\cycle[j]\to\simplex[j]$ and hence a cofibration. Because $f\of X\to Y$ is the colimit of the inclusions $X\to Y_j$ and those inclusions are compositions of cofibrations, $f$ is a cofibration.
\end{proof}

\begin{remark} The thoroughly rigorous proof is the definition of a natural transformation between the characteristic functor of free cofibration $\Core(\Func([1],\cat S))\to \Func(\nno\disc,\cat S)$ and the characteristic functor of cofibrations $\Core(\Func([1],\cat S))\to \cat S'$. There is a canonical faithful functor $\Func(\nno\disc,\cat S)\to\cat S'$ that evens out the codomains. The witness of cofibrancy is the result of glueing lifting operators for cycle inclusions along the colimit inclusions. The proof above only mentions the most relevant parts of the construction instead. This is the default approach in the rest of this paper.\end{remark}

\hide{ But it may be a lemma worth working out somewhere in this paper, if only in an appendix? }

The rest of this subsection shows the converse, i.e.\ every cofibration is free, by factoring every morphism as an acyclic fibration following a free cofibration. The factorization requires objects of cofibrations constructed from a classifier of locally decidable subobjects as described below.

\begin{definition} A monomorphism $m\of X\to Y$ of $\cat S\s$ is \emph{locally decidable} if for each $i\of\nno$ monomorphism $m[i]\of X[i]\to Y[i]$ is \emph{decidable}, i.e.\ isomorphic to a coproduct inclusion, in $\cat S$. \end{definition}

\begin{lemma} The category $\cat S\s$ has a locally decidable monomorphism $t\of 1\to \LDMC$ such that every morphism is a locally decidable monomorphism if and only if it is a pullback of $t$. \end{lemma}

\begin{proof} The morphism $t$ is defined in such a way that a witness that a morphism $f\of X\to Y$ is locally decidable is essentially already a pullback square $f\to t$. For any object $X$ of $\cat S\s$ let a \emph{decidable sieve} be a $p\of(\Sigma i\of\nno.X[i])\to\bool$ such that $p(x)=\true$ implies $p(x\circ X(f))=\true$ for each morphism $f\of [m]\to [n]$ of $\simCat$ and $x\in X[n]$. For each $i\in\nno$, $\LDMC[i]$ is the object of \emph{decidable sieves} of $\simplex[i]$. The Yoneda lemma takes care of the rest. \end{proof}

\begin{proposition} Every morphism $f\of X\to Y$ of $\cat S\s$ factors as an acyclic fibration following a free cofibration. \label{factor1} \end{proposition}

\begin{proof}
Let $Z$ be the following object of $\cat S$. For each $n\of\nno$, $Z[n]$ consist of quadruples $\tuplet{a,b,c,d}$ where 
 $a\of[n]\to [p]$ is an epimorphism of $\simCat$ (so $p\leq n$),
 $b\of\LDMC[p]$ satisfies $b(\id_{[p]})=\true$ if an only if $a=\id_{[n]}$,
 $c\of \set{b}\to X$, where $\set{b}$ is the pullback of $t\of 1\to\LDMC$ along $b$ and 
 $d\of \simplex[p]\to Y$ satisfies $f\circ c = d\circ b\ri(t)$.

\[\xymatrix{
1\ar[d]_t & \set b\ar[l]\ar[d]_{b\ri(t)}\ar[r]^{c} & X\ar[d]^f \\
\LDMC & \simplex[p]\ar[l]^b\ar[r]_d & Y
}\]

In $\simCat$ every morphism $\phi\of [m]\to[n]$ factors uniquely as a monomorphism $m(\phi)$ following an epimorphism $e(\phi)$. For every $\phi\of [m]\to [n]$ and $\tuplet{a,b,c,d}\of Z[n]$ let
\[ Z(\phi)\tuplet{a,b,c,d} = \left\{\begin{array}{cc}
\tuplet{\id_{[n]},\top,a\circ\phi,Y(\phi)(d)} & b(\phi)=\true \\
\tuplet{\begin{array}{c} e(a\circ \phi)\\ b\circ \simplex(m(a\circ \phi))\\ c \circ t\ri(\simplex(m(a\circ \phi)))\\ d\circ\simplex(m(a\circ \phi))\end{array}} & b(\phi)=\false
\end{array}\right.
\]
Here $\top\of \simplex[p]\to\LDMC$ is the characteristic morphism of $\id\of\simplex[p]\to\simplex[p]$.

There is a morphism $g\of X\to Z$ which satisfies $g[n](x) = \tuplet{\id_{[n]},\top,\xi,f[n](x)}$ if $\xi\of\simplex[n] \to X$ is the morphism that satisfies $\xi(\id_{[n]})=x$. The morphism $g$ is a cofibration by lemma \ref{Reedy}.

There is a morphism $h\of Z\to Y$ satisfying $h[n]\tuplet{a,b,c,d} = Y(a)(d)$ and this map is an acyclic fibration for the following reasons.
Let $z\of\cycle[n]\to Z$, $y\of\simplex[n]\to Y$ and let $h\circ z = y\circ k_n$ where $k_n\of\cycle[n]\to \simplex[n]$ is the inclusion of the boundary.
\[\xymatrix{
\cycle[n]\ar[d]_{k_n}\ar[r]^z & Z\ar[d]^h\\
\simplex[n]\ar[r]_{y} & Y
}\]
The morphism $z\of\cycle[n]\to Z$ assigns a simplex $z(\xi) = \tuplet{a_\xi,b_\xi,c_\xi,d_\xi}$ to every non surjective morphism $\xi\of [m]\to[n]$.
A filler corresponds to a simplex $w=\tuplet{a,b,c,d}\of Z[n]$ for which $Y(a,d) = y(\id_{\simplex[n]})\of Y[n]$ and where $Z(\xi)(w)=z_\xi$ for all non surjective $\xi\of [m]\to[n]$.
\begin{itemize}
\item If $a_\xi=\id$ for all monomorphisms $\xi$, then $a=\id$. Let the morphism $b\of \simplex[n]\to \LDMC$ send all surjective $\xi\of[m]\to[n]$ to $\false$. For every other morphism $\phi\of [i]\to [j]$, let $b(\phi) = b_{m(\phi)}(e(\phi))$. If $b(\phi)=\true$, then $c(\phi) = c_{m(\phi)}(e(\phi))$. Finally $d$ is $y$ and $w=\tuplet{a,b,c,d}$.
\item If $a_\xi\neq \id$ for some monomorphisms $\xi$, then there is a greatest monomorphism $\mu\of [m]\to[n]$ such that $\mu\neq \id$ but $a_\mu=\id$. The reason is that there are finitely many monomorphisms to $[n]$ and the subcategory of those monomorphisms $\xi$ for which $a(\xi)=\id$ is closed under pushouts. In this case $a$ is the unique inverse of $\mu$ for which $e(a\circ \xi) = a_\xi$ for all monomorphisms. Let $w = Y(a)(z_\mu)$.
\end{itemize}

These two cases cover all possible commutative squares with the cycle inclusion $k_n$, because there are finitely many monomorphisms $\xi\of [m]\to [n]$ and $a_\xi = \id$ is a decidable property. For this reason, $h$ has the global right lifting property which respect to the family of all cycle inclusions. Therefore $h$ is an acyclic cofibration.
\end{proof} %yeah!

The factorization in the proof above turns the implication in lemma \ref{Reedy} into an equivalence.

\begin{proposition} A morphism $f\of X\to Y$ is a cofibration if and only if it is a free cofibration. \label{cofibration characterization} \end{proposition}

\begin{proof} Lemma \ref{Reedy} shows the `if' direction. For `only if' factor $f\of X\to Y$ as in the proof of lemma \ref{factor1} to get a free cofibration $g\of X\to Z$ and an acyclic fibration $h\of Z\to Y$. Because $\id_Y\circ f = h\circ g$ there is a $k\of Y\to Z$ such that $h\circ k = \id_Y$ and $k\circ f = g$ by the global lifting property. 
\[
\xymatrix{
X\ar[d]_f \ar[r]^g & Z\ar[d]^h\\
Y\ar[r]_\id \ar[ur]^k & Y
}
\]
For each simplex $y$ of $Y$, $k(y)=\tuplet{a,b,c,d}$. The simplex $y$ is in the image of $f$ if and only if $b=\top$ and this is decidable. A simplex $y$ for which $b\neq \top$ is nondegenerate if and only if $a=\id$ for the following reasons. The morphisms $k$ is a section of $h$ and hence a monomorphism. Monomorphisms preserve faces because faces are monomorphisms. The morphism $k$ commutes with the actions of morphisms in $\simCat$ and degenerates of $Z$ outside of the image of $g$ have $a\neq\id$.
\end{proof}

The equivalence means that one of the factorization systems that the model structure requires is already present. It also means that the simpler functor that represent the free cofibrations also represents the class of cofibrations.

\subsection{Pullback exponentials}
Kan complexes add additional structure that permits the factorization of morphisms of simplicial objects into Kan fibrations and acyclic cofibrations. Pullback exponentials and their duals, pushout products, are at the core of this argument.

\begin{definition} For each pair of morphisms $f\of W\to X$ and $g\of Y\to Z$ the \emph{pullback exponential} $g\pe f$ is the unique factorization of the span of the span $(Y^f, g^X)$ though the pullback of $Z^f$ and $g^W$. 
\hide{\[\xymatrix{
Y^X \ar@/^2ex/[rr]^{Y^f} \ar[dr]_{g^X} \ar@{.>}[r]_(.6){g\pe f}
& \bullet \ar[r]\ar[d] & Y^W \ar[d]^{g^W} \\
& Z^X \ar[r]_{Z^f} & Z^W
}\]}

For each pair of morphisms $f\of W\to X$ and $g\of Y\to Z$ the \emph{pushout product} $f\pp g$ is the unique factorization of the cospan $(f\times \id_Z , \id_X\times g)$ though the pushout of $f\times \id_Y$ and $\id_W\times g$. 
\hide{\[\xymatrix{
W\times Y \ar[r]^{f\times \id} \ar[d]_{\id\times g} \po & X\times Y \ar[d] \ar[dr]^{\id\times g} \\
W\times Z \ar[r] \ar@/_2ex/[rr]_{f\times\id} & \bullet \ar[r]^(.4){f\pp g} & X\times Z
}\]}
\[\xy
(0,10)*+{Y^X}="left",(20,10)*+{\bullet}="middle",(30,20)*+{Y^W}="top",(30,0)*+{Z^X}="bottom",(40,10)*+{Z^W}="right"
\ar^{Y^f} "left";"top" \ar_{g^X} "left";"bottom" \ar@{.>}|(.6){g\pe f} "left";"middle" 
\ar "middle";"top" \ar "middle";"bottom" \ar^{g^W} "top";"right" \ar_{Z^f} "bottom";"right"
\endxy\xy
(0,10)*+{W\times Y}="left",(20,10)*+{\bullet}="middle",(10,20)*+{X\times Y}="top",(10,0)*+{W\times Z}="bottom",(40,10)*+{X\times Z}="right"
\ar^(.4){f\times \id} "left";"top" \ar_{\id\times g} "left";"bottom" \ar "top";"middle" \ar "bottom";"middle"
\ar@{.>}|(.3){g\pp f} "middle";"right" \ar^{\id\times g} "top";"right" \ar_{f\times\id} "bottom";"right"
\endxy\]

\end{definition}

Although $\cat S$ may omit some pushouts, the following lemma show that pushout products of cofibrations always exist.

\begin{lemma} Pushout products of pairs of locally decidable monomorphisms exist and are locally decidable monomorphisms. \end{lemma}

\begin{proof} Let $f\of W\to X$ and $g\of Y\to Z$ be a pair of locally decidable monomorphisms. A pair $\tuplet{x,y}\of X\times Z$ belongs to the image of $f\pp g$ if either $x$ belong to the image of $f$ or $y$ belong to the image of $g$. This is a decidable property.
\end{proof}

The following fundamental lemma of simplicial homotopy has a constructive proof and therefore holds in $\cat S\s$.

\begin{lemma}[Pushout product] If $f$ and $g$ are cofibrations, then so is $f\pp g$. Moreover, if either $f$ or $g$ is acyclic then so is $f\pp g$. \label{pushout product} \end{lemma}

\begin{proof} Reasoning internally, a simplex $\tuplet{x,z}$ of $X\times Z$ is outside of the image $f\pp g$ and nondegenerate if and only if both $x$ is outside of the image of $f$ and nondegenerate and $z$ is outside of the image of $g$ and nondegenerate. This is a decidable property of simplices of $X\times Z$ and hence $f\pp g$ is a cofibration by proposition \ref{cofibration characterization}. 

Assume $f$ is an acyclic cofibration. Let $e$ be an arbitrary fibration. The problem of filling a commutative square with $f\pp g$ opposite to $e$ reduces to the problem of filling all commutative squares with the pushout product $h\pp k$ of a cycle inclusion $k\of \cycle[m]\to \simplex[m]$ and a horn inclusion $h\of \horn_k[n]\to\simplex[n]$ opposite to $e$. By standard simplicial homotopy, $h\pp k$ is an acyclic cofibration (see \cite{Hovey99} section 3.3, \cite{GJSHT} section I.5).

For each horn inclusion $h\of \horn_k[n]\to \simplex[n]$ the pullback exponential $e\pe h$ is an acyclic fibration, because the problem of lifting a cycle inclusion $k\of \cycle[m]\to \simplex[m]$ reduces to the problem of lifting the acyclic cofibration $h\pp k$. Since $h\pp g$ has the global left lifting property with respect to all fibrations, it is an acyclic fibration. For the fibration $e$ this implies that $e\pe g$ is a fibration, because the problem of lifting a horn $h$ against $e\pe g$ reduces the the problem of lifting $g$ against the acyclic fibration $e\pe h$. This means that $f$ has the left lifting property with respect to $e\pe g$. By generalization $f\pp g$ has the left lifting property with respect to all fibrations, which means it is an acyclic cofibration.
\end{proof}

Lemma \ref{pushout product} has a counterpart for pullback exponentials.

\begin{corollary} If $e\of U\to V$ is a fibration and $f\of W\to X$ is a cofibration, then $e\pe f$ is a fibration. Moreover, if either $f$ or $e$ are acyclic, then $e\pe f$ is acyclic. \label{pullback exponential}
\end{corollary}

The following corollary gives a lifted morphism without constructing a pushout product or pullback exponential.

\begin{corollary} Let $f\of A\to B$ and $g\of C\to D$ be cofibrations and let $h\of X\to Y$ be a fibration. Let $a\of A\times D\to X$, $b\of B\times C\to X$ and $c\of B \times D\to Y$ satisfy $a\circ(\id_A\times g) = b\circ(f\times \id_C)$, $h\circ a=c\circ(f\times \id_D)$ and $h\circ b=c\circ(\id_B\times g)$. If one of $f$, $g$ or $h$ is acyclic, then there is a $d\of B\times D\to X$ such that $d\circ(f\times\id_D)=a$, $d\circ(\id_B\times g)=b$ and $h\circ d = c$.
\hide{\[\xymatrix{
A\times C\ar[r]^{f\times \id}\ar[d]_{\id\times g} & B\times C\ar[r]^b\ar[d]_(.3){\id\times g} & X\ar[d]^h\\
A\times D\ar[r]_{f\times \id} \ar[urr]^(.3){a} & B\times D \ar[r]_c \ar@{.>}[ur]_{d} & Y
}\]}
\[\xy
(0,20)*+{A\times C}="AC",(25,20)*+{B\times C}="BC",(40,20)*+{X}="X",
(0,0)*+{A\times D}="AD",(25,0)*+{B\times D}="BD",(40,0)*+{Y}="Y"
\ar^{f\times\id} "AC";"BC"
\ar_{\id\times g} "AC";"AD"
\ar_{f\times\id} "AD";"BD"
\ar^{a} "AD";"X"
\ar|(.6){\id\times g} "BC";"BD"
\ar^(.6){b} "BC";"X"
\ar@{.>}_{d} "BD";"X"
\ar_(.6){c} "BD";"Y"
\ar^{h} "X";"Y"
\endxy\]

\hide{Transposed view:
\[\xymatrix{
A\ar[r]^{a^t}\ar[d]_f & X^D\ar[r]^{X^g}\ar[d]^(.7){h^D} & X^C\ar[d]^{h^C}\\
B\ar[r]_{c^t} \ar[urr]_(.7){b^t} \ar@{.>}[ur]^{d^t} & Y^D \ar[r]_{Y^g} & Y^C
}\]}\label{triple lift}
\end{corollary}


\subsection{Deformation retracts}
In the classical situation, acyclic cofibrations between Kan complexes are deformation retracts. These still play an important role in the model structure on $\cat S\s\f$.

\begin{definition} A \emph{deformation retract} is a morphism $f\of X\to Y$ with a left inverse $g\of Y\to X$ and a homotopy $h\of \simplex[1]\times Y\to Y$ between $\id_Y$ and $f\circ g$, i.e.\ $h\circ (\Delta(\delta^1_0)\times \id_Y) = \id_Y$ and $h\circ (\Delta(\delta^1_1)\times \id_Y) = f\circ g$, where $\Delta(\delta^1_i)\of 1\to \simplex[1]$ are the points of $\simplex[1]$.
\end{definition}

The following two lemmas explain how certain homotopies induce filler operators for fibrations and cofibrations. 

\begin{lemma} Let $f\of X\to Y$ be a deformation retract with left inverse $g$ and homotopy $h$. If $f$ is a cofibration and $h\circ(\id_{\simplex[1]}\times f) = f\circ \pi_1$, then $f$ an acyclic cofibration.  \label{retract is acyclic}
\[\xymatrix{
\simplex[1]\times X \ar[r]^(.6){\pi_1}\ar[d]_{\id\times f} & X\ar[d]^f\\
\simplex[1]\times Y \ar[r]_(.6)h & Y
}\]
\end{lemma}

\begin{proof} 
Let $k\of A\to B$ be a fibration and let $k\circ a = b\circ f$ for some $a\of X\to A$ and $b\of Y\to B$. 

Corollary \ref{triple lift} helps out. The cofibrations are $f$ and $\simplex(\delta^1_1)$ and the latter of these is acyclic; the fibration is $k$; the the morphisms $a\circ g$, $a\circ \pi_1$ and $b\circ h$--where $\pi_1$ is the projection $\simplex[1]\times A\to A$--satisfy the following equations.
\begin{align*} 
	(a\circ \pi_1)\circ (\simplex(\delta^1_0)\times\id_X) &= a = (a\circ g)\circ f\\
	(b\circ h)\circ (\simplex(\delta^1_0)\times\id_Y) &= b\circ f\circ g = k\circ (a\circ g)\\
	(b\circ h)\circ (\id_{\simplex[1]}\times f) &= b\circ f\circ \pi_1 = k\circ (a\circ \pi_1)
\end{align*}
\hide{\[\xymatrix{
X\ar[d]_f\ar@/^3ex/[rrr]^{\simplex(\delta^1_0)\times\id} &X\ar[d]_f \ar[rr]|(.4){\simplex(\delta^1_1)\times \id} && \simplex[1]\times X \ar[d]|(.6){\id\times f}\ar[r]|(.6){a\circ \pi_1} & A\ar[d]^k\\
Y\ar@/_3ex/[rrr]_{\simplex(\delta^1_0)\times\id}&Y \ar[rr]|(.4){\simplex(\delta^1_1)\times \id}\ar[urrr]^(.3){a\circ g} && \simplex[1]\times Y\ar[r]|(.6){b\circ h}\ar@{.>}[ur]_d & B
}\]}
\[\xy
(0,20)*+{X}="X1",(30,20)*+{\simplex[1]\times X}="X01",(50,20)*+{A}="A",(57,27)*+{X}="X0",
(0,0)*+{Y}="Y1",(30,0)*+{\simplex[1]\times Y}="Y01",(50,0)*+{B}="B",(57,7)*+{Y}="Y0"
\ar^f "X0";"Y0" \ar_(.4){\simplex(\delta^1_0)\times\id} "X0";"X01" \ar^a "X0";"A"
\ar_f "X1";"Y1" \ar^(.4){\simplex(\delta^1_1)\times\id} "X1";"X01" 
\ar_(.7){\id\times f} "X01";"Y01" \ar|(.6){a\circ\pi_0} "X01";"A"
\ar_(.4)k "A";"B"
\ar "Y0";"Y01" \ar^b "Y0";"B" \ar@{.>} "Y0";"A"
\ar_(.4){\simplex(\delta^1_1)\times\id} "Y1";"Y01"
\ar^(.3){a\circ g} "Y1";"A"
\ar_(.6){b\circ h} "Y01";"B"
\ar@{.>}|d "Y01";"A"
\endxy\]

The composition $A^{\simplex(\delta^1_0)}\circ d$ is filler for the square $k\circ a = b\circ f$. By abstraction there is a function that provides fillers for arbitrary commutative squares $f\to k$ where $k$ is a fibration. This proves $f$ is an acyclic cofibration.
\end{proof}

\begin{lemma} Let $\pi\of \simplex[1]\times Y\to Y$ be the projection and let $c\of 1+1\to\simplex[1]$ be the cycle inclusion. Let $g\of Y\to X$ be a fibration, let $f\of X\to Y$ be a right inverse and let $h\of \simplex[1]\times Y \to Y$ be a homotopy that satisfies $g\circ h = g\circ \pi_1$. Then $f$ is an acyclic fibration. \label{deformation is acyclic}
\hide{\[\xymatrix{
Y+Y\ar[rr]^{(\id,f\circ g)}\ar[d]_{c\times \id} && Y\ar[d]^g \\
\simplex[1]\times Y \ar[rr]_{g\circ\pi}\ar[urr]^h && X
}\]}
\[\xy
(0,14)*+{Y+Y}="up left",(21,14)*+{Y}="up right",
(0,0)*+{\simplex[1]\times Y}="down left",(21,0)*+{X}="down right"
\ar^(.6){(\id,f\circ g)} "up left";"up right" \ar_{c\times \id} "up left";"down left"
\ar^g "up right";"down right"
\ar_(.6){g\circ\pi_1} "down left";"down right" \ar^h "down left";"up right"
\endxy\]
\end{lemma}

\begin{proof}
Thanks to the transpose $h^t\of Y\to Y^{\simplex[1]}$ of $h$, $g$ is a retract of $g\pe{\simplex(\delta^1_1)}$.
\hide{\[\xymatrix{
Y\ar[d]_g \ar[r]^{h^t} & Y^{\simplex[1]} \ar[d]_{g\pe{\simplex(\delta^1_1)}} \ar[dr]^{Y^{\simplex(\delta^1_1)}} \ar[rr]^{Y^{\simplex(\delta^1_0)}}&& Y \ar[d]^g\\
X \ar[r]^{(X^\bang,f)} \ar[dr]_{X^\bang} \ar@/_3ex/[rr]_(.6)f & \bullet\ar[r]\ar[d] & Y \ar[d]_(.4)g & X \\
& X^{\simplex[1]} \ar[r]_{X^{\simplex(\delta_1^1)}} \ar@/_2ex/[urr]_(.7){X^{\simplex(\delta^1_0)}}& X
}\]}
\[\xy
(0,21)*+{Y}="Y0",(14,28)*+{Y^{\simplex[1]}}="Y1",(35,21)*+{Y}="Y2",(42,28)*+{Y}="Y3",
(21,14)*+{\bullet}="center",
(7,7)*+{X}="X0",(28,0)*+{X^{\simplex[1]}}="X1",(42,7)*+{X}="X2",(56,0)*+{X}="X3"
\ar_g "Y0";"X0" \ar^{h^t} "Y0";"Y1"
\ar_{g\pe{\simplex(\delta^1_1)}} "Y1";"center" \ar|{Y^{\simplex(\delta^1_1)}} "Y1";"Y2" \ar^{Y^{\simplex(\delta^1_0)}} "Y1";"Y3"
\ar^g "Y2";"X2"\ar^g "Y3";"X3"
\ar "center";"X1" \ar "center";"Y2"
\ar^{(X^\bang,f)} "X0";"center" \ar_{X^\bang} "X0";"X1" \ar@/_2ex/_(.6)f "X0";"Y2"
\ar^(.6){X^{\simplex(\delta_1^1)}} "X1";"X2" \ar_{X^{\simplex(\delta_0^1)}} "X1";"X3"
\endxy\]
Because $\simplex(\delta^1_1)$ is an acyclic cofibration, $g\pe{\simplex(\delta^1_1)}$ is an acyclic fibration by corollary \ref{pullback exponential}. Hence $f$ is an acyclic fibration if it is a fibration.
\end{proof}

\subsection{Fibrant replacements}
There is a conventional method for factoring morphisms between Kan complexes as fibrations following deformation retracts, which helps to prove the following proposition.

\begin{proposition} Every morphism $f\of X\to Y$ between Kan complexes factors as a fibration following an acyclic cofibration. \label{factor2} \end{proposition}

\begin{proof} Because $\bang_Y\of Y\to 1$ is a fibration, the morphism $(d_0,d_1)\of Y^{\simplex[1]} \to Y\times Y$ defined by composition with the cycle inclusion $1+1\to \simplex[1]$ is a fibration and the components $d_i\of Y^{\simplex[1]}\to Y$ are acyclic fibrations by corollary \ref{pullback exponential}. Pulling back $(d_0,d_1)$ along $f\times \id_Y$ produces the \emph{homotopy graph} $Y/f$ of $f$ together with projections $f_0\of Y/f\to X$ and $f_1\of Y/f\to Y$ where $f_0$ is an acyclic fibration because it is the pullback of $d_0$ and $f_1$ is a fibration because it is the composition of the fibrations $(f_0,f_1)$ and $\pi_1\of X\times Y\to Y$.
\[\xymatrix{
Y/f \ar[r]\ar[d]_{(f_0,f_1)} & Y^{\simplex[1]} \ar[d]^{(d_0,d_1)} \\
X\times Y \ar[r]_{f\times\id} & Y\times Y
}\]

There is a deformation retract $r=(\id_X,Y^\bang\circ f)\of X\to Y/f$ with $f_1$ as left inverse. The retract factors as an acyclic fibration $g\of W\to Y/f$ following a cofibration $h\of X\to W$. This cofibration has a left inverse $h' = f_0\circ g$, which is an acyclic fibration. There is a homotopy $\phi$ between $\id_{W}$ and $h\circ h'$ by lemma \ref{triple lift} and the following equations.
\begin{align*}
(\id_W,h\circ h')\circ(h+h)&=(h,h)= (h\circ\pi_1)\circ (c\times \id_X)\\
h'\circ h\circ \pi_1&=\pi_1=(h'\circ\pi_1)\circ(\id_{\simplex[1]}\times h)\\
h'\circ(\id_W,h\circ h')&=(h',h')= (h'\circ\pi_1)\circ (c\times \id_W)
\end{align*}
\[\xymatrix{
X+X\ar[d]_{c\times \id}\ar[r]^{h+h} & W+W\ar[d]_(.3){c\times \id}\ar[r]^(.6){(\id,h\circ h')} & W\ar[d]^{h'}\\
\simplex[1]\times X\ar[r]_{\id\times h} \ar[urr]^(.3){h\circ\pi_1}  & \simplex[1]\times W\ar[r]_(.6){h'\circ\pi_1} \ar@{.>}[ur]_\phi & X
}\]
Because $\phi\circ(\id_{\simplex[1]\times h}) = h\circ \pi_1$, the cofibration $h$ is acyclic by lemma \ref{retract is acyclic}. 

As promised the morphism $f$ factors as the fibration $f_1\circ g$ following the acyclic cofibration $h$.
\end{proof}

\subsection{Two-out-of-three}
The category $\cat S\s$ has the two weak factorization systems that a model structure requires. This subsection demonstrates that the weak equivalences satisfy the 2-out-of-3 property and completes the proof that $\cat S\s\f$ is a model category.

\begin{lemma}[2-out-of-3] Let $f\of X\to Y$ and $g\of Y\to Z$ be morphisms of $\cat S\s\f$. If any two of $f,g$ or $g\circ f$ are weak equivalences, then all three are. \label{toot}\end{lemma}

\begin{proof}
Compositions of acyclic fibrations are acyclic fibrations and the same holds for acyclic cofibrations. All compositions of weak equivalences are weak equivalences if $g\circ f$ factors as an acyclic fibration following an acyclic cofibration, whenever $g$ is an acyclic cofibration and $f$ is an acyclic fibration.

By proposition \ref{factor1} $g\circ f=h\circ k$ for some acyclic fibration $h\of W\to Z$ and a cofibration $k\of X\to W$. Since $Y$ is fibrant, $g$ has a left inverse $g'$ by the lifting property. Since $f \circ \id = g'\circ g\circ f= (g'\circ h)\circ k$ there is a morphism $k'$ such that $f\circ k' = g'\circ h$ and $k'\circ k = \id$, so $k$ has its own left inverse.
\[\xymatrix{
X\ar[d]_f \ar[r]_{k} \ar@/^2ex/[rr]^{\id} & W\ar[d]^h \ar[r]_{k'} & X\ar[d]^f\\
Y \ar[r]^{g} \ar@/_2ex/[rr]_{\id} & Z \ar[r]^{g'} & Y
}\]

Let $c$ be the cycle $1+1\to\simplex[1]$. The fibrancy of $Z$ induces a homotopy between $\id_Z$ and $g\circ g'$, using lemma \ref{triple lift}.
\[\xymatrix{
Y+Y\ar[r]^{g+g}\ar[d]_{c\times\id} & Z+Z\ar[r]^(.6){(\id,g\circ g')}\ar[d]_(.3){c\times\id} & Z\\
\simplex[1]\times Y\ar[r]_{\id\times g}\ar[urr]^(.3){g\circ\pi_1} & \simplex[1]\times Z\ar@{.>}[ur]_{\phi}
}\]

There is a homotopy $\chi$ between $\id_W$ and $k\circ k'$ because of lemma \ref{triple lift}.
\begin{align*}
(\id, k\circ k')\circ (k+k) &= (k,k) = k\circ \pi_1\circ(c\times\id_X)\\
h\circ (k \circ \pi_1) &= (\phi\circ (\id_W\times h))\circ (\id_{\simplex[1]} \times k)\\
h\circ (\id, k\circ k') &= (\phi\circ (\id_W\times h))\circ (c\times \id_W)
\end{align*}
\[\xymatrix{
X+X\ar[d]_{c\times \id}\ar[r]^{k+k} & W+W\ar[d]_(.3){c\times \id}\ar[r]^(.6){(\id,k\circ k')} & W\ar[d]^h\\
\simplex[1]\times X\ar[r]_{\id\times k} \ar[urr]^(.3){k\circ \pi_1}  & \simplex[1]\times W\ar[r]_(.6){\phi\circ (\id\times h)} \ar@{.>}[ur]_\chi & Z
}\]
Because the homotopy satisfies $\chi\circ(\id_{\simplex[1]}\times k) = k\circ \pi_1$, lemma \ref{retract is acyclic} makes $k$ an acyclic cofibration.

Let $g$ and $g\circ f$ be weak equivalences now.

First assume that $g$ and $g\circ f$ are acyclic fibrations. By proposition \ref{factor1}, $f$ factors as an acyclic fibration $h\of W\to Y$ following a cofibration $k\of X\to W$. Because $(g\circ f)\circ \id = (g\circ h)\circ k$ and $g\circ f$ is an acyclic fibration, $k$ has a left inverse $k'\of X\to W$ which satisfies $g\circ f\circ k' = g\circ h$. 
\[\xymatrix{
X\ar[d]_k \ar[r]^\id & X\ar[d]^{g\circ f}\\
W\ar[r]_{g\circ h} \ar@{.>}[ur]^{k'} & Z
}\]

Let $c\of 1+1\to\simplex[1]$ be the same cycle as above. There is homotopy $\phi$ between $\id_W$ and $k\circ k'$ because of lemma \ref{triple lift} and the following equations.
\begin{align*}
(\id,k\circ k')\circ(k+k) &= (k,k) = (k\circ\pi_1)\circ (c\times\id_X)\\
(g\circ h)\circ (k\circ \pi_1) &= (g\circ h\circ \pi_1)\circ(\id\times k)\\
(g\circ h)\circ (\id,k\circ k') &= (g\circ h\circ \pi_1)\circ(c\times\id_W)
\end{align*}
\[\xymatrix{
X+X \ar[d]_{c\times \id}\ar[r]^{k+k} & W+W\ar[d]_(.3){c\times\id}\ar[r]^(.6){(\id,k\circ k')} & W\ar[d]^{g\circ h}\\
\simplex[1]\times X \ar[r]_{\id\times k}\ar[urr]^(.3){k\circ\pi_1}& \simplex[1]\times W\ar[r]_{g\circ h\circ \pi_1}\ar@{.>}[ur]_\phi & Z
}\]
Because $\phi\circ (\id_{\simplex[1]}\times k)=k\circ \pi_1$, lemma \ref{retract is acyclic} says that $k$ is an acyclic cofibration.

Next assume that $g$ and $g\circ f$ are acyclic cofibrations. Let $k\of A\to B$ be a fibration and let $a\of X\to A$ and $b\of Y\to B$ satisfy $k\circ a=b\circ f$. Because $B$ is fibrant, there is a $b'\of Z\to B$ such that $b'\circ g = b$. Lifting properties also imply that there is an $a'\of Z\to A$ such that $a'\circ g\circ f = a$ and $k\circ a'= b'$. So $b'\circ g$ is a filler for $k\circ a=b\circ f$. By abstraction, there is a filler operator that lifts $f$ against all fibrations.
\[\xy
(0,28)*+{X}="x",(14\halfrootthree,21)*+{A}="a",(0,14)*+{Y}="y",(14\halfrootthree,7)*+{B}="b",(0,0)*+{Z}="z"
\ar^a "x";"a" \ar_f "x";"y" \ar^k "a";"b" \ar|(.33)b "y";"b" \ar_g "y";"z"
\ar@{.>}_{b'} "z";"b" \ar@{.>}|(.67){a'} "z";"a"
\endxy\]

Let $g$ and $g\circ f$ be arbitrary weak equivalences. The morphism $f$ factors as an acyclic fibration $h\of W\to Y$ following a cofibration $k\of X\to W$. Because weak equivalences are closed under composition, $g\circ h$ is a weak equivalence. The morphism $k$ is acyclic for the following reasons. Factor both $g\circ f$ and $g\circ h$ as acyclic fibrations following acyclic cofibrations, so $g\circ f = a\circ b$ and $g\circ h = c\circ d$. The lifting properties induce a morphism $l$ such that $l\circ b = d\circ k$ and $c\circ l = a$. The morphism $l$ is a weak equivalence because $a$ and $c$ are acyclic fibrations. Because of closure under composition, the morphism $l\circ b = d\circ k$ is both a weak equivalence and a cofibration and hence an acyclic cofibration. Since $d$ is an acyclic cofibration, so is $k$.
\[\xymatrix{
X\ar[r]_k\ar@/^2ex/[rr]^f\ar[d]_b & W\ar[r]_h\ar[d]^d & Y\ar[d]^g \\
\bullet\ar@/_2ex/[rr]_a\ar@{.>}[r]^l & \bullet\ar[r]^c & Z
}\]
Since $f = h\circ k$, $f$ is a weak equivalence.

The remaining case is where $f$ and $g\circ f$ are weak equivalences.

First assume that $f$ and $g\circ f$ are acyclic cofibrations. The morphism $g$ factors as a fibration $h\of W\to Z$ following an acyclic cofibration $k\of Y\to W$ by lemma \ref{factor2}. Lifting properties give $h$ a right inverse $h'$.
\[\xymatrix{
X\ar[r]^{k\circ f}\ar[d]_{g\circ f} & W\ar[d]^h\\
Z\ar[r]_\id \ar[ur]^{h'} & Z
}\]
Lemma \ref{triple lift} provides a homotopy $\phi$ between $\id_W$ and $h'\circ h$, because the following equations hold.
\begin{align*}
(\id,h'\circ h)\circ(k\circ f+k\circ f)&= (k\circ f,k\circ f) = (k\circ f\circ \pi_1)\circ(c\times \id_Y)\\
h\circ(k\circ f\circ\pi_1) &= g\circ f\circ\pi_1 = (h\circ\pi_1)\circ(\id_{\simplex[1]}\times (k\circ f))\\
h\circ(\id_W,h'\circ h) &= (h,h) = (h\circ\pi_1)\circ(c\times\id_W)
\end{align*}

\[\xymatrix{
X+X\ar[r]^{k\circ f+k\circ f}\ar[d]_{c\times \id} & W+W\ar[r]^(.6){(\id,h'\circ h)}\ar[d]_(.3){c\times\id} & W\ar[d]^h\\
\simplex[1]\times X\ar[r]_{\id\times k\circ f}\ar[urr]^(.3){k\circ f\circ\pi_1} & \simplex[1]\times W\ar[r]_(.6){h\circ \pi_1}\ar@{.>}[ur]_{\phi} & Y
}\]
Because $h\circ \phi = h\circ \pi_1$, lemma \ref{deformation is acyclic} says that $h$ is an acyclic fibration.

Next assume that $f$ and $g\circ f$ are acyclic fibrations. Let $k\of\cycle[n]\to\simplex[n]$ be the cycle inclusion. Let $a\of\cycle[n]\to Y$ and $b\of\simplex[n]\to Y$ satisfy $b\circ k = g \circ a$. Because $\cycle[n]$ is cofibrant, there is an $a'\of \cycle[n]\to X$ such that $f\circ a' = a$ and hence $(g\circ f)\circ a' = b\circ c$. There is a filler $b'\of\simplex[n]\to X$ for this commutative square. The morphism $f\circ b'$ is a filler for the square $b\circ k = g \circ a$. This proves $g$ is an acyclic fibration.

\[\xy
(14\halfrootthree,28)*+{X}="x", (0,21)*+{\cycle[n]}="v", (14\halfrootthree,14)*+{Y}="y", (0,7)*+{\simplex[n]}="w", (14\halfrootthree,0)*+{Z}="z"
\ar@{.>}^{a'} "v";"x" \ar|(.67)a "v";"y" \ar_k "v";"w"
\ar@{.>}|(.33){b'} "w";"x" \ar_b "w";"z"
\ar "x";"y" \ar "y";"z"
\endxy\]

The general case where $f$ and $g\circ f$ are weak equivalences is now dual to the case where $g$ and $g\circ f$ are weak equivalences. By lemma \ref{factor1} $g=k\circ h$ with $k$ a fibration and $h$ an acyclic cofibration. Because weak equivalences compose, $h\circ f = a\circ b$ with $a$ and acyclic fibration and $b$ and acyclic cofibration. 
Also $g\circ f = c\circ d$ with $c$ an acyclic fibration and $d$ and acyclic cofibration. 
Lifting $b$ against $c$ gives a morphism $l$ that is a weak equivalence because $c\circ l = a$. That means that the cofibration $d\circ f = l\circ b$ is a weak equivalence and hence acyclic. Since $f$ is wedged between the acyclic cofibrations $d\circ f$ and $d$, it is a weak equivalence. 
\[\xymatrix{
X\ar[r]^f\ar[d]_b & Y\ar[r]^h\ar[d]^d\ar[dr]^g & \bullet\ar[d]^k\\
\bullet\ar@/_2ex/[rr]_a\ar@{.>}[r]^l & \bullet\ar[r]^c & Z
}\]

This means that weak equivalences indeed satisfy 2-out-of-3.
\end{proof}

\begin{remark} At this point we finally have worked out enough structure to introduce a characteristic functor of the weak equivalences. Pick one the factorizations into a fibration following a cofibration form propositions \ref{factor1} or \ref{factor2}. The characteristic functor $\code{weak-equivalence}$ presents witnesses that the members of the chosen factorization are acyclic. The closure of this new class under 2-out-of-3 is a natural transformations of the functor $\code{weak-equivalence}$ and other functors constructed form it. The proof above has the elements of its construction. \end{remark}

\subsection{Conclusion}
For a definition of model categories see [\cite{Hovey99, GJSHT}]. The simplicial homotopy of Kan complexes is valid in the internal ELCCC $\cat S$ in the following sense.

\begin{theorem}[Model category]
With fibrations, weak equivalences and cofibrations defined as above $\cat S\s\f$ is a model category.
\label{model category}
\end{theorem}

\begin{proof}
Lemma \ref{factor1} shows that cofibrations and acyclic fibrations form a weak factorization system, considering that they satisfy a lifting property by definition \ref{Kan}. Lemma \ref{factor2} tells the same thing about fibrations and acyclic cofibrations. Lemma \ref{toot} demonstrates that if two of $f$, $g$ and $f\circ g$ are weak equivalences, then all three are. These three requirements define a model structure.
\end{proof}

\section{Descent} %hoort dit er nog bij?
This section shows how lifting properties \emph{descend} along the horn inclusions $H(n,k)\of \horn_k[n]\to\simplex[n]$. This means that each fibration $f\of X\to\horn_k[n]$ is the pullback of a fibration $g\of Y\to\simplex[n]$ along $H(n,k)$.

\subsection{Higher dimensional case}
This subsection introduces a construction that works for dimensions $n>1$. For each fibration $f\of X\to \horn_k[n]$ each simplex in the descended fibration $Df\of DX\to \simplex[n]$ is the face of a filler for an acyclic cofibration which factors through $f$. This extends the range of the filler operator of $f$ while keeping it a pullback of $Df$ along $H(n,k)$. The following equivalence simplifies dealing with $\cat S\s/\simplex[n]$.

\begin{lemma} The categories $\cat S\s/\simplex[n]$ and $\cat S^{(\simCat/[n])\dual}$ are equivalent. \label{slice equivalence} \end{lemma}

\begin{proof} For $\xi\of[m]\to[n]$ in $\simCat$ let $[\xi]$ to denote the corresponding object of $\simCat/[n]$ and let $\simplex[\xi]$ be the representable functor generated by the Yoneda embedding. The equivalence links $\simplex[\xi]$ of $\cat S^{(\simCat/[n])\dual}$ to $\Delta\xi\of \simplex[m]\to \simplex[n]$ of $\cat S\s/\simplex[n]$.

In the direction $\cat S\s/\simplex[n]\to \cat S^{(\simCat/[n])\dual}$ the equivalence sends a $f\of X\to \simplex[n]$ to the presheaf $g$ which for all $\xi$ of $\simCat/[n]$ satisfies:
\[ g[\xi] = \set{ x\of X(\dom(\xi)) | f(\dom(\xi))(x)=\xi } \]
Here $\dom(\xi)$ is the domain of $\xi$.
In the direction $\cat S\s/\simplex[n]\to \cat S^{(\simCat/[n])\dual}$ the equivalence sends a presheaf $g$ to the morphism $f$ which for each $m\of\nno$ represent the family of objects:
\[ \xi\of\simCat([m],[n])\mapsto g(\xi) \]
\end{proof}

%the factorization is a functor $\cat S\s/\simplex[n]\to \cat S\s/\simplex[n]$ mind you!

The dependent product along $H(n,k)\of \horn_k[n]\to\simplex[n]$ is the first half of the descent functor. It constructs fillers for a limited set of acyclic cofibrations. The following functor $K$ sends each $\simplex[n]$-indexed family of simplices to the family of simplices it will be a face of.

\begin{definition}
The following defines the functor $K\of\simCat/[n]\to\simCat/[n]$.
\begin{enumerate}
\item A function $\xi\of[m]\to[n]$ cuts $[m]$ into $n+1$ posets $\xi_j = \set{i\of[m]|\xi(i)=j}$. 
\item Let $\norm \xi$ be the number of elements of the product: \[\Pi i\of ([n]-\set k).\xi_i\] 
\item Define $K(\xi)\of [m+\norm\xi]\to [n]$ as follows.
\[ 
	K\xi(i) = \left\{
		\begin{array}{cc}
			\xi(i) & \xi(i)<k \\
			k & \xi(i-\norm\xi)\leq k \leq \xi(i)\\
			\xi(i-\norm\xi) & k<\xi(i-\norm\xi)
		\end{array}
	\right.
\]
\item Let $\ka(\xi)\of\Pi i\of([n]-\set k).\xi_i \to [m+\norm\xi]$ be the \emph{nondecreasing} injection $\ka$ which sends the lexical product $\Pi i\of([n]-\set k).\xi_i$ to the interval in $[m+\norm\xi]$ which starts at the least $i$ such that $K\xi(i)=k$.

The lexical product means that $\Pi i\of([n]-\set k).\xi_i$ get the lexical ordering. %more?

\item Let $\la(\xi)\of[m]\to[m+\norm\xi]$ be the nondecreasing injection which skips the image of $\ka$. This means $\la(i)=i$ if $\xi(i)<k$ and $\la(i)=i+\norm\xi$ if $\xi(i)\geq k$. Moreover $K(\xi)\circ\la(\xi) = \xi$.
\item For each function $\phi\of\xi\to\xi'$ in $\simCat/[n]$ let $\phi_i\of\xi_i\to\xi'_i$ be the fibrewise morphism and let $\Pi i\of([n]-\set k).\phi_i$ be the corresponding map of the (lexical) products $\Pi i\of([n]-\set k).\xi_i\to\Pi i\of([n]-\set k).\xi'_i$.
\item Let $K(\phi)\of K(\xi)\to K(\xi')$ be the nondecreasing function which satisfies $K(\phi)\circ \ka(\xi) = \ka(\xi')\circ \Pi i\of([n]-\set k).\phi_i$ and $K(\phi)\circ \la(\xi) = \la(\xi')\circ \phi$.
\end{enumerate}
\end{definition}

The norm $\norm\xi$ equals the number of ways the injection $\delta^n_k\of[n-1]\to[n]$ factors through $\xi$. Here $\delta^n_k(i)=i$ if $i<k$ and $i+1$ if $i\geq k$. The functor $K$ gives each such factorization $\phi\of[n-1]\to [m]$ a unique anchor point in $K(\xi)_k$. Now $K(\phi)\of K(\delta^n_k)\to \xi$ is a full simplex. Pulling back along $H(n,k)$ preserves the homotopy type of $\Delta(K(\phi))$ and that is the point of the construction.

The second half of the descent functor is the endofunctor of $\cat S\s/\simplex[n]$ that is equivalent to the endofunctor $K\ri$ of $\cat S^{\simCat/[n]\dual}$ that satisfies $K\ri X[\xi] = X[K\xi]$.

\begin{lemma} Let $Df = K\ri\depprod{H[n,k]}f\of K\ri\depprod{H[n,k]}X\to\simplex[n]$. Each $f\of X\to\horn_k[n]$ is a pullback of $Df$ along $H(n,k)$. \end{lemma}

\begin{proof} If $\xi\of [m]\to[n]$ is of $(\horn_k[n])[m]$, then $\norm\xi=0$ and $K\xi = \xi$. Lemma \ref{slice equivalence} and the Yoneda lemma imply that $f$ and the pullback of $K\ri\depprod{H[n,k]}f$ have isomorphic objects of simplices. \label{descent pullback}
\end{proof}

\subsection{Fibrancy}
This subsection shows that $Df$ is a fibration by reducing the following lifting problems (for all $l\leq m\of\nno$) to ones that involves $f$ directly.
\begin{equation}
	\xymatrix{
		\horn_l[m]\ar[r]\ar[d]_{H(m,l)} & DX\ar[d]^{Df} \\
		\simplex[m]\ar[r]_{\Delta\xi} \ar@{.>}[ur] & \simplex[n]
	}
	\label{descent lifting problem}
\end{equation}

The reduction is composed of two parts like the descent functor itself. The second part uses the adjunction between pulling back and dependent products. The first part fattens the horn up to help it survive the pullback. Some new notation helps to describe the constructions involved in the first part.


\begin{definition} For each $\xi\of[m]\to[n]$ and $p\of[m]\to\bool$ let $\face^\xi(p)$ be the object of $\cat S^{\simCat/[n]\dual}$ which satisfies: 
\[ \face^\xi(p)[\alpha] = \set{\psi\of [\alpha]\to[\xi] | (\forall i\of \dom\alpha)(p(\xi(i))=\true)} \]
\end{definition}

Although the \emph{face} $\face^\xi(p)$ is either the initial object or isomorphic to some $\simplex[\alpha]$, it comes with a canonical monomorphism into $\simplex[\xi]$ which allows us to treat it as a subobject and describe other subobjects of simplices as unions of faces. For example, the horn inclusion in (\ref{descent lifting problem}) \emph{is} $\bigcup_{i\of [m]-\set k} \face^\xi([m]-\set i)$ if we read $[m]-\set i$ as both a type and as a substitute for its characteristic map $[m]\to\bool$.


\begin{proposition} Let
\begin{align*}
H(m,l)&=\bigcup_{i\of [m]-\set l} \face^\xi([m]-\set i)\\
\depsum KH(m,l)&=\bigcup_{i\of [m]-\set l} \face^{K\xi}(\depsum K([m]-\set i))
\end{align*}
Let $\depsum K(p)\of [m+\norm\xi]\to \bool$ satisfy the following morphism--here $\mathord\land$ is the conjunction function of Booleans.
\[ \depsum K(p)(\la(i))=p(i)\quad\depsum K(p)(\ka(\vec i)) = p(i_0)\land\dotsm\land p(i_n) \] 
There is a natural isomorphism between
\[ \cat S^{\simCat/[n]\dual}(H(m,l),K\ri -) \] and 
\[ \cat S^{\simCat/[n]\dual}(\depsum KH(m,l),-) \] \label{K-universal}
\end{proposition}


\begin{proof} The union $H(m,l)$ is the finite colimit of all the $\face^\xi(p)$, where $p\of[m]\to\bool$ satisfies $p(i)=\false$ for some $i\in [m]$. The Yoneda lemma induces an equivalence $\cat S^{\simCat/[n]\dual}(\face^\xi(p),K\ri X)\simeq X[K\face^\xi(p)]\simeq \cat S^{\simCat/[n]\dual}(\face^{K\xi}(\depsum K p),X)$ which is natural in $X$ for all such $p$. The morphism $\depsum KH(m,l)$ is the colimit of those $\face^{K\xi}(\depsum K p)$ for the following reasons.

The operator $\depsum K$ satisfies $\depsum K(p\land q)=\depsum K(p)\land \depsum K(q)$ and $\face^{K\xi}$ sends conjunctions to intersections. Hence:
\[ \face^{K\xi}(\depsum K(p\land q)) = \face^{K\xi}(\depsum K(p)\land \depsum K(q)) = \face^{K\xi}(\depsum K(p))\cap \face^{K\xi}(\depsum K(q)) \]
For each $r\of[m+\norm\xi]\to \bool$ such that $\face^{K\xi}(r)$ is a face of the union $\depsum KH(m,l)$ the intersection $r'$ of all $p\of[m]\to \bool$ such that $\face^\xi(r)\subseteq\face^\xi(\depsum K(p))$ therefore satisfies $\face^\xi(r)\subseteq \face^{K\xi}(\depsum K(r'))$. For this reason $\depsum KH(m,l)=\colim_{\face^\xi(p)\subseteq H(m,l)}\face^{K\xi}(\depsum K p)$. Facewise natural equivalences therefore join into a single natural equivalence:
\[ \cat S^{\simCat/[n]\dual}(H(m,l),K\ri -)\simeq\cat S^{\simCat/[n]\dual}(\depsum K H(m,l), -) \]
\end{proof}

As noted in lemma \ref{slice equivalence} $\depsum K H(m,l)$ has a counterpart in $\cat S/\simplex[n]$ which has a pullback $H(n,k)\ri \depsum K H(m,l)$ in $\cat S/\horn_k[n]$. The following examples of acyclic cofibrations helps to prove that this is an acyclic cofibration.

\begin{lemma}[Face completion] Let $F$ be an inhabited decidable set of faces of $\simplex[p]$ which all have an edge $e$ in common. The inclusion $\bigcup F\to \simplex[p]$ is an acyclic cofibration. \label{face completion} \end{lemma}

\begin{proof} For all $j\of[p]$ let $F_j$ be the union of $F$ with the set of $j$-dimensional faces of $\simplex[p]$ which contain the edge $e$. Because $F$ is inhabited, $\bigcup F$ contains $e$ and therefore $F_0=F$. Because $\simplex[p]$ is a $p$-dimensional face of $\simplex[p]$ which contains $e$, $\bigcup F_p = \simplex[p]$. For $j>0$ let $S_j$ be the set of $j$-dimensional faces of $\bigcup F_j$ which are not already contained in $\bigcup F_{j-1}$. If a $j$-dimensional face $\face(\Sigma)$ of $\bigcup F_j$ opposes $e$, it is part of a higher dimensional face which is a member of $F$. Therefore each face $\face(\Sigma)\of S_j$ contains $e$. For this reason $\face(\Sigma)\cap \bigcup F_{j-1}$ is the horn whose central edge is $e$. The inclusion $\bigcup F_{j-1}\to\bigcup F_j$ is therefore the pushout of a coproduct of horn inclusions indexed over $S_j$ and therefore an acyclic cofibration. Because acyclic cofibrations are closed under composition, $\bigcup F = F_0\to F_p = \simplex[p]$ is an acyclic cofibration. 
\end{proof}

\begin{lemma} The object $H(n,k)\ri \depsum K H(m,l)$ is a subobject of $H(n,l)\ri\simplex[K\xi]$ in $\cat S/\horn_k[n]$. The inclusion of their domains in $\cat S$, $H(n,k)\ri \depsum K H(m,l)$ is an acyclic cofibration. \label{acyclic cofibrancy} 
\[\xymatrix{
\bullet \ar@{.>}[rr]^{H(n,k)\ri \depsum K H(m,l)} \ar[d] && \bullet\ar[rr]^{H(n,k)\ri\simplex(K\xi)}\ar[d] && \horn_k[n]\ar[d]^{H(n,k)}\\
\bullet\ar[rr]_(.4){\depsum K H(m,l)} && \simplex[m+\norm\xi]\ar[rr]_(.6){\simplex(K\xi)} && \simplex[n]
}\]
\end{lemma}


\begin{proof} 
Both $H(n,l)\ri\simplex[K\xi]$ and $H(n,l)\ri \depsum K H(m,l)$ have descriptions in terms of unions of faces. For $i\in [n]-\set k$ let $\U(i) = [m+\norm\xi]-\set{\la(j)|\xi(j)=i}$ and for $j\in [m]-\set k$ let $\A(j) = \depsum K([m]-\set j)$.
\begin{align*}
H(n,l)\ri\simplex[K\xi] &= \bigcup_{i\of([n]-\set{k})} \face^{K\xi}(\U(i))\\
H(n,l)\ri \depsum K H(m,l)&= \bigcup_{\substack{i\of([n]-\set{k})\\j\of([m]-\set l)}} \face^{K\xi}(\U(i)\cap \A(j))
\end{align*}

Let's get the simple cases out of the way first. If $\norm\xi = 0$, then the inclusion is $H(m,l)$ because $\depsum K$ and $H(n,k)\ri$ preserve it. Hence the inclusion is an acyclic cofibration. Assume $\norm\xi>0$ for the rest of this proof.

The following paragraphs show that the following inclusions are acyclic cofibrations:
\begin{equation} \bigcup_{p\in[m]-\set l} \face^{K\xi}(\A(p)\cap\U(i))\to \face^{K\xi}(\U(i)) \label{facewise} \end{equation}
The case where $i=\xi(l)$ must be saved for last.

Because $n>1$, there are always $i\of[n]$ such that $i\neq k$, $i\neq \xi(l)$. The set $F = \set{\face^{K\xi}(\A(p)\cap\U(i))}$ is inhabited and decidable. Each face in $F$ contains the edge $\la(l)$. By lemma \ref{face completion} the inclusion \ref{facewise} is an acyclic cofibration for all $i\in [n]-\set{k,\xi(l)}$.

Now join the proven acyclic cofibration of \ref{facewise} together. Let
\[ L=H(n,l)\ri \depsum K H(m,l)\cup\bigcup_{i\of([n]-\set{k,\xi(l)})}\face^{K\xi}(\U(i)) \]
The map $H(n,l)\ri \depsum K H(m,l)\to L$ is an acyclic cofibration because it is a pushout of the coproduct of these simpler face inclusions. If $\xi(l)=k$, then $L=H(n,k)\ri \simplex[K\xi]$ and the proof is done. Otherwise the face $\face^{K\xi}(\U(\xi(l)))$ is left.


For $\vec p \of\prod_{i\of([n]-\set k)}\xi_i$ let $\W(\vec p) = \U(\xi(l))-\set{ \la(q) | p_{\xi(q)} < q }$. For all $j\of\nno$ let $L_j = L\cup \bigcup_{ \ka(\vec p) < j } \face^{K\xi}(\W(\vec p))$. By this definition $L_0=L$ and $L_{m+\norm\xi+1} = H(n,k)\ri\simplex[K\xi]$ because if $p_i$ are the maximal elements of $\xi_i$ for each $i\of[n]-\set k$, then $\set{ \la(q) | p_{\xi(q)} < q }$ is empty and therefore $\W(\vec p) = \U(\xi(l))$.

For every $j\of\nno$ the inclusion $L_j\to L_{j+1}$ is an acyclic cofibration for the following reasons.

As long as $K\xi(j)<k$, $L_j = L$ because $j<\kappa(\vec p)$ for all $\vec p \of\prod_{i\of([n]-\set k)}\xi_i$. If $K\xi(j+1)<k$ too, then $L_j\to L_{j+1}$ is an acyclic cofibration because it is an identity. If $K\xi(j+1) = k$ then $j+1=\kappa(\vec p)$ or $j+1 = \la(p)$ for $p\of\xi_k$. First consider the case that $j+1=\ka(\vec p)$. 

If $\vec p,\vec q\of\prod_{i\neq k} \xi_i$ and $p_i\leq q_i$ for all $i\of[n]-k$, then $\vec p \leq \vec q$ in the lexicographical order of the ordinal product and hence $\ka(\vec p)\leq \ka(\vec q)$. Therefore $\face^{K\xi}(\W(\vec p))\subseteq L_{\ka(\vec q)}$. For that reason, the intersection of $L_j$ and $\face^{K\xi}(\W(\vec p))$ is the union of the following families of faces.
\begin{align*}
\U(i)\cap \W(\vec p) &\textrm{ for $i\of[n]-\set{k,\xi(l)}$}\\
\A(q)\cap\U(\xi(l))\cap \W(\vec p) &\textrm{ for $q\of[m]-\set l$}\\
\W(\vec r)\cap \W(\vec p) &\textrm{ if $\kappa(\vec r)<\kappa(\vec p)$ }
\end{align*}
Define $\vec p[l]\of\prod_{i\neq k} \xi_i$ to satisfy $\vec p[l]_i = l$ if $i=\xi(l)$ and $\vec p[l]_i = p_i$ if $i\neq \xi(l)$. The intersection of $L_j$ and $\face^{K\xi}(\W(\vec p))$ is a union of faces which contain the supporting point $\kappa(\vec p[l])$ for the following reasons. 

The supporting edge $\kappa(\vec p[l])\in\U(i)$ and $\W(\vec p)$ because those faces contain all edges in the image of $\ka$. The edge $\kappa(\vec p[l])$ is a member of $\A(q)$ when $\xi(q)=k$ or $\vec p[l]_{\xi(q)}=q$ by definition of $M(q)$. In other cases $\A(q)\cap\U(\xi(l))\cap \W(\vec p)$ is a subobject of one of the faces that do contain $\kappa(\vec p[l])$. If $q$ is the least element of $\xi_{\xi(q)}$, then $\A(q)\cap\W(\vec p)\subseteq \U(\xi(q))$. If $\xi(q-1)=\xi(q)$, then $\A(q)\cap \W(\vec p) \subseteq \W(\vec p[q-1])$ and $\kappa(\vec p[q-1])<\kappa(\vec p)$. Therefore $L_j\cap \face^{K\xi}(\W(\vec p))$ is a union of faces which contain the supporting edge $\ka(\vec p[l])$. By lemma \ref{face completion} $L_j\cap \face^{K\xi}(\W(\vec p))\to \face^{K\xi}(\W(\vec p))$ is an acyclic cofibration. Since it is a pushout of that map, $L_j\to L_{j+1} = L_j\cup \face^{K\xi}(\W(\vec p))$ too.

By the time $j+1 = \la(p)$ for some $p\of \xi_k$, $L_j = H(n,k)\ri \simplex[K\xi]$ and $L_j\to L_{j+1}$ is the identity. The same holds for all $L_j\to L_{j+1}$ where $K\xi(j+1)>k$ and where $j+1>m+\norm\xi$. Since acyclic cofibrations are closed under composition, both $L\to H(n,k)\ri \simplex[K\xi]$ and $H(n,k)\ri \depsum K H(m,l) \to H(n,k)\ri \simplex[K\xi]$ are acyclic cofibrations.
\end{proof}

\subsection{Conclusion}
The only thing a proof of the descent theorem still needs are fillers for the horns $H(n,k)$ where $n\leq 1$. There is no $H(n,k)$ for $n=0$. For $n=1$ there are two maps $H(1,i)\of 1\to \simplex[1]$ for which a simple construction exists.

\begin{lemma} If $f\of X\to 1$ is a fibration--i.e.\ if $X$ is a complex--then $\id_{\simplex[1]}\times f\of\simplex[1]\times X\to \simplex[1]$ is a fibration. \end{lemma}

\begin{proof} The morphism $\id\times f$ is a pullback of $f$ along $\bang\of X\to 1$ and fibrations are closed under pullbacks. \end{proof}

\begin{theorem} For each fibration $f\of X\to\horn_k[n]$, $Df=K\ri\depprod{H(n,k)}f$ is a fibration. \label{descent} \end{theorem}


\begin{proof} Let $\simplex\xi\of \simplex[m]\to\simplex[n]$ and $g\of \horn_l[m]\to DX$ such that $Df\circ g = \simplex\xi\circ H(m,l)$. 
\[
	\xymatrix{
		\horn_l[m]\ar[r]^g\ar[d]_{H(m,l)} & DX\ar[d]^{Df} \\
		\simplex[m]\ar[r]_{\simplex\xi} & \simplex[n]
	}	
\]
Because $\depprod{H(n,k)}$ is right adjoint to $H(n,k)\ri$ and because of lemma \ref{K-universal}, $g$ has a transpose $g^t$ and $f\circ g^t = \simplex(K\xi)\circ (H(n,k)\ri \depsum{K} H(m,l))$.
\[
	\xymatrix{
		\bullet\ar[r]^{g^t}\ar[d]_{H(n,k)\ri \depsum K H(m,l)} & X\ar[d]^{f} \\
		\simplex[m+\norm\xi]\ar[r]_(.6){\simplex(K\xi)} & \simplex[n]
	}	
\]
Lemma \ref{acyclic cofibrancy} means that there is a filler $h\of \simplex[m+\norm\xi]\to X$ for the second commutative square, whose transpose fills the first.
By generalization there is a filler for each square with a horn inclusion $H(m,l)$ in it and by abstraction there is a filler operator that makes $Df$ a fibration in the sense of definition \ref{lifting}.
\end{proof}

\section{Closing}

\subsection*{Acknowledgments} 
I am grateful to the Warsaw Center of Mathematics and Computer Science for the opportunity to write this paper. I am also grateful for discussions with Marek Zawadowski and the seminars on simplicial homotopy theory he organized during my stay at Warsaw University. Richard Garner, Peter LeFanu Lumsdaine and Thomas Streicher made invaluable comments on early drafts of this paper.



\printbibliography

\end{document}

